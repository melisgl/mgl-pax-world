<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
<head>
<title>Try Manual
</title>
<link type='text/css' href='style.css' rel='stylesheet'>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width">
   <script src="jquery.min.js"></script>
<script src="toc.min.js"></script>
<script type="text/x-mathjax-config">
     MathJax.Hub.Config({
       tex2jax: {
         inlineMath: [['$','$']],
         processEscapes: true
       }
     });
   </script>
   <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
   </script>
   
</head>
<body>
<div id="content-container">
<div id="toc">
<div id="toc-header"><ul><li><a href="index.html">PAX World</a></li></ul></div>
<div id="page-toc">
</div>
<div id="toc-footer"><ul><li><a href="https://github.com/melisgl/mgl-pax">[generated by MGL-PAX]</a></li></ul></div>
</div>
<div id="content">
<p><a id="x-28TRY-3A-40TRY-MANUAL-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY-MANUAL%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#%22try%22%20ASDF%2FSYSTEM:SYSTEM" title="&quot;try&quot; ASDF/SYSTEM:SYSTEM">&#8594;</a> <a href="try-manual.html" title="Try Manual">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/manual.lisp#L5">&#955;</a></span></span></p>
<h1><a href="try-manual.html">Try Manual</a></h1>
<h2>Table of Contents</h2>
<ul>
<li><a href="#%22try%22%20ASDF%2FSYSTEM:SYSTEM" title="&quot;try&quot; ASDF/SYSTEM:SYSTEM">1 The try ASDF System</a></li>
<li><a href="#TRY:@TRY%2FLINKS%20MGL-PAX:SECTION" title="Links">2 Links</a></li>
<li><a href="#TRY:@TRY%2FTUTORIAL%20MGL-PAX:SECTION" title="Tutorial">3 Tutorial</a></li>
<li><a href="#TRY:@TRY%2FEMACS%20MGL-PAX:SECTION" title="Emacs Integration">4 Emacs Integration</a>

<ul>
<li><a href="#TRY:@TRY%2FEMACS-SETUP%20MGL-PAX:SECTION" title="Emacs Setup">4.1 Emacs Setup</a></li>
</ul></li>
<li><a href="#TRY:@TRY%2FEVENTS%20MGL-PAX:SECTION" title="Events">5 Events</a>

<ul>
<li><a href="#TRY:@TRY%2FMIDDLE-LAYER-OF-EVENTS%20MGL-PAX:SECTION" title="Middle Layer of Events">5.1 Middle Layer of Events</a></li>
<li><a href="#TRY:@TRY%2FCONCRETE-EVENTS%20MGL-PAX:SECTION" title="Concrete Events">5.2 Concrete Events</a></li>
<li><a href="#TRY:@TRY%2FEVENT-GLUE%20MGL-PAX:SECTION" title="Event Glue">5.3 Event Glue</a></li>
<li><a href="#TRY:@TRY%2FPRINTING-EVENTS%20MGL-PAX:SECTION" title="Printing Events">5.4 Printing Events</a></li>
<li><a href="#TRY:@TRY%2FEVENT-RESTARTS%20MGL-PAX:SECTION" title="Event Restarts">5.5 Event Restarts</a></li>
<li><a href="#TRY:@TRY%2FOUTCOMES%20MGL-PAX:SECTION" title="Outcomes">5.6 Outcomes</a>

<ul>
<li><a href="#TRY:@TRY%2FOUTCOME-RESTARTS%20MGL-PAX:SECTION" title="Outcome Restarts">5.6.1 Outcome Restarts</a></li>
<li><a href="#TRY:@TRY%2FCHECKS%20MGL-PAX:SECTION" title="Checks">5.6.2 Checks</a></li>
<li><a href="#TRY:@TRY%2FTRIALS%20MGL-PAX:SECTION" title="Trials">5.6.3 Trials</a></li>
</ul></li>
<li><a href="#TRY:@TRY%2FERRORS%20MGL-PAX:SECTION" title="Errors">5.7 Errors</a></li>
<li><a href="#TRY:@TRY%2FCATEGORIES%20MGL-PAX:SECTION" title="Categories">5.8 Categories</a></li>
</ul></li>
<li><a href="#TRY:@TRY%2FIS%20MGL-PAX:SECTION" title="The `is` Macro">6 The <code>is</code> Macro</a>

<ul>
<li><a href="#TRY:@TRY%2FFORMAT-SPECIFIER-FORMS%20MGL-PAX:SECTION" title="Format Specifier Forms">6.1 Format Specifier Forms</a></li>
<li><a href="#TRY:@TRY%2FCAPTURES%20MGL-PAX:SECTION" title="Captures">6.2 Captures</a>

<ul>
<li><a href="#TRY:@TRY%2FAUTOMATIC-CAPTURES%20MGL-PAX:SECTION" title="Automatic Captures">6.2.1 Automatic Captures</a></li>
<li><a href="#TRY:@TRY%2FEXPLICIT-CAPTURES%20MGL-PAX:SECTION" title="Explicit Captures">6.2.2 Explicit Captures</a></li>
</ul></li>
</ul></li>
<li><a href="#TRY:@TRY%2FCHECK-LIBRARY%20MGL-PAX:SECTION" title="Check Library">7 Check Library</a>

<ul>
<li><a href="#TRY:@TRY%2FCHECKING-CONDITIONS%20MGL-PAX:SECTION" title="Checking Conditions">7.1 Checking Conditions</a></li>
<li><a href="#TRY:@TRY%2FMISC-CHECKS%20MGL-PAX:SECTION" title="Miscellaneous Checks">7.2 Miscellaneous Checks</a></li>
<li><a href="#TRY:@TRY%2FCHECK-UTILITIES%20MGL-PAX:SECTION" title="Check Utilities">7.3 Check Utilities</a>

<ul>
<li><a href="#TRY:@TRY%2FCOMPARING-FLOATS%20MGL-PAX:SECTION" title="Comparing Floats">7.3.1 Comparing Floats</a></li>
</ul></li>
</ul></li>
<li><a href="#TRY:@TRY%2FTESTS%20MGL-PAX:SECTION" title="Tests">8 Tests</a>

<ul>
<li><a href="#TRY:@TRY%2FIMPLICIT-TRY%20MGL-PAX:SECTION" title="Calling Test Functions">8.1 Calling Test Functions</a></li>
<li><a href="#TRY:@TRY%2FEXPLICIT-TRY%20MGL-PAX:SECTION" title="Explicit `try`">8.2 Explicit <code>try</code></a>

<ul>
<li><a href="#TRY:@TRY%2FTESTABLES%20MGL-PAX:SECTION" title="Testables">8.2.1 Testables</a></li>
<li><a href="#TRY:@TRY%2FIMPLICIT-TRY-IMPLEMENTATION%20MGL-PAX:SECTION" title="Implementation of Implicit `try`">8.2.2 Implementation of Implicit <code>try</code></a></li>
</ul></li>
<li><a href="#TRY:@TRY%2FPRINT%20MGL-PAX:SECTION" title="Printing Events">8.3 Printing Events</a></li>
<li><a href="#TRY:@TRY%2FCOUNT%20MGL-PAX:SECTION" title="Counting Events">8.4 Counting Events</a></li>
<li><a href="#TRY:@TRY%2FCOLLECT%20MGL-PAX:SECTION" title="Collecting Events">8.5 Collecting Events</a></li>
<li><a href="#TRY:@TRY%2FRERUN%20MGL-PAX:SECTION" title="Rerunning Trials">8.6 Rerunning Trials</a></li>
<li><a href="#TRY:@TRY%2FREPLAY%20MGL-PAX:SECTION" title="Reprocessing Trials">8.7 Reprocessing Trials</a></li>
</ul></li>
<li><a href="#TRY:@TRY%2FIMPLEMENTATION-NOTES%20MGL-PAX:SECTION" title="Implementation Notes">9 Implementation Notes</a></li>
<li><a href="#TRY:@TRY%2FGLOSSARY%20MGL-PAX:SECTION" title="Glossary">10 Glossary</a></li>
</ul>
<h6>[in package TRY]</h6>
<p><a id="x-28-22try-22-20ASDF-2FSYSTEM-3ASYSTEM-29"></a>
<a id="%22try%22%20ASDF%2FSYSTEM:SYSTEM"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="try-manual.html" title="Try Manual">&#8592;</a> <a href="try-manual.html" title="Try Manual">&#8593;</a> <a href="#TRY:@TRY%2FLINKS%20MGL-PAX:SECTION" title="Links">&#8594;</a> <a href="#%22try%22%20ASDF%2FSYSTEM:SYSTEM" title="&quot;try&quot; ASDF/SYSTEM:SYSTEM">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/try.asd#L1">&#955;</a></span></span></p>
<h2><a href="#%22try%22%20ASDF%2FSYSTEM:SYSTEM">1 The try ASDF System</a></h2>
<ul>
<li>Version: 0.0.1</li>
<li>Description: Try is an extensible test framework with equal support
  for interactive and non-interactive workflows.</li>
<li>Long Description: Try stays as close to normal Lisp evaulation
  rules as possible. Tests are functions that record the checks they
  perform as events. These events provide the means of customization
  of what to debug, print, rerun. There is a single fundamental check,
  the extensible <a href="#TRY:IS%20MGL-PAX:MACRO" title="TRY:IS MGL-PAX:MACRO"><code>is</code></a> macro. Everything else is built on top.</li>
<li>Licence: MIT, see COPYING.</li>
<li>Author: Gábor Melis</li>
<li>Mailto: <a href="mailto:mega@retes.hu" >mega@retes.hu</a></li>
<li>Homepage: <a href="http://melisgl.github.io/try" >http://melisgl.github.io/try</a></li>
<li>Bug tracker: <a href="https://github.com/melisgl/try/issues" >https://github.com/melisgl/try/issues</a></li>
<li>Source control: <a href="https://github.com/melisgl/try.git" >GIT</a></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FLINKS-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FLINKS%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#%22try%22%20ASDF%2FSYSTEM:SYSTEM" title="&quot;try&quot; ASDF/SYSTEM:SYSTEM">&#8592;</a> <a href="try-manual.html" title="Try Manual">&#8593;</a> <a href="#TRY:@TRY%2FTUTORIAL%20MGL-PAX:SECTION" title="Tutorial">&#8594;</a> <a href="#TRY:@TRY%2FLINKS%20MGL-PAX:SECTION" title="Links">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/manual.lisp#L17">&#955;</a></span></span></p>
<h2><a href="#TRY:@TRY%2FLINKS%20MGL-PAX:SECTION">2 Links</a></h2>
<p>Here is the <a href="https://github.com/melisgl/try" >official repository</a>
and the <a href="http://melisgl.github.io/mgl-pax-world/try-manual.html" >HTML
documentation</a>
for the latest version.</p>
<p><a id="x-28TRY-3A-40TRY-2FTUTORIAL-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FTUTORIAL%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FLINKS%20MGL-PAX:SECTION" title="Links">&#8592;</a> <a href="try-manual.html" title="Try Manual">&#8593;</a> <a href="#TRY:@TRY%2FEMACS%20MGL-PAX:SECTION" title="Emacs Integration">&#8594;</a> <a href="#TRY:@TRY%2FTUTORIAL%20MGL-PAX:SECTION" title="Tutorial">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/manual.lisp#L23">&#955;</a></span></span></p>
<h2><a href="#TRY:@TRY%2FTUTORIAL%20MGL-PAX:SECTION">3 Tutorial</a></h2>
<p>Try is a library for unit testing with equal support for
interactive and non-interactive workflows. Tests are functions, and
almost everything else is a condition, whose types feature
prominently in parameterization.</p>
<p>Try is is what we get if we make tests functions and build a test
framework on top of the condition system as
<a href="https://common-lisp.net/project/stefil/index-old.shtml" >Stefil</a> did
but also address the issue of rerunning and replaying, make the
<a href="#TRY:IS%20MGL-PAX:MACRO" title="TRY:IS MGL-PAX:MACRO"><code>is</code></a> check more capable, use the types of the condition hierarchy
to parameterize what to debug, print, rerun, and finally document
the whole thing.</p>
<h5>Looking for Truth</h5>
<p><a href="#TRY:@TRY%2FIS%20MGL-PAX:SECTION" title="The `is` Macro">The <code>is</code> Macro</a> is a replacement for <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_assert.htm" title="ASSERT (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>cl:assert</code></a>, that can capture values of
subforms to provide context to failures:</p>
<pre><code><span class="code"><span class="paren1">(<span class="code">is <span class="paren2">(<span class="code">= <span class="paren3">(<span class="code">1+ 5</span>)</span> 0</span>)</span></span>)</span>
.. debugger invoked on UNEXPECTED-RESULT-FAILURE:
..   UNEXPECTED-FAILURE in check:
..     <span class="paren1">(<span class="code">IS <span class="paren2">(<span class="code">= #1=<span class="paren3">(<span class="code">1+ 5</span>)</span> 0</span>)</span></span>)</span>
..   where
..     #1# = 6</span></code></pre>
<p>This is a <a href="pax-manual.html" title="PAX Manual">PAX</a> <a href="pax-manual.html#MGL-PAX:@TRANSCRIPTS%20MGL-PAX:SECTION" title="Transcripts">transcript</a>,
output is prefixed with <code>..</code>. Readable and unreadable return values
are prefixed with <code>=&gt;</code> and <code>==&gt;</code>, respectively.</p>
<p>Note the <code>#n#</code> syntax due to <a href="http://www.lispworks.com/documentation/HyperSpec/Body/v_pr_cir.htm" title="*PRINT-CIRCLE* (MGL-PAX:CLHS VARIABLE)"><code>*print-circle*</code></a>.</p>
<h5>Checking Multiple Values</h5>
<p><code>is</code> <a href="#TRY:@TRY%2FAUTOMATIC-CAPTURES%20MGL-PAX:SECTION" title="Automatic Captures">automatically captures</a> values of
arguments to functions like <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_1pl_1_.htm" title="1+ (MGL-PAX:CLHS FUNCTION)"><code>1+</code></a> in the above example. Values of
other interesting subforms can be <a href="#TRY:@TRY%2FEXPLICIT-CAPTURES%20MGL-PAX:SECTION" title="Explicit Captures">explicitly
captured</a>. <code>is</code> supports capturing multiple
values and can be taught <a href="#TRY:@TRY%2FWRITING-AUTOMATIC-CAPTURE-RULES%20MGL-PAX:SECTION" title="Writing Automatic Capture Rules">how to deal with macros</a>. The combination of these
features allows <a href="#TRY:MATCH-VALUES%20MGL-PAX:MACRO" title="TRY:MATCH-VALUES MGL-PAX:MACRO"><code>match-values</code></a> to be implementable as tiny extension:</p>
<pre><code><span class="code"><span class="paren1">(<span class="code">is <span class="paren2">(<span class="code">match-values <span class="paren3">(<span class="code">values <span class="paren4">(<span class="code">1+ 5</span>)</span> <span class="string">"sdf"</span></span>)</span>
      <span class="paren3">(<span class="code">= * 0</span>)</span>
      <span class="paren3">(<span class="code">string= * <span class="string">"sdf"</span></span>)</span></span>)</span></span>)</span>
.. debugger invoked on UNEXPECTED-RESULT-FAILURE:
..   UNEXPECTED-FAILURE in check:
..     <span class="paren1">(<span class="code">IS
..      <span class="paren2">(<span class="code">MATCH-VALUES #1=<span class="paren3">(<span class="code">VALUES <span class="paren4">(<span class="code">1+ 5</span>)</span> #2=<span class="string">"sdf"</span></span>)</span>
..        <span class="paren3">(<span class="code">= * 0</span>)</span>
..        <span class="paren3">(<span class="code">STRING= * <span class="string">"sdf"</span></span>)</span></span>)</span></span>)</span>
..   where
..     #1# == 6
..            #2#</span></code></pre>
<p>In the body of <code>match-values</code>, <code>*</code> is bound to
successive return values of some form, here <code>(values (1+ 5) &quot;sdf&quot;)</code>.
<code>match-values</code> comes with an automatic rewrite rule that captures the
values of this form, which are printed above as <code>#1# == 6 #2#</code>. <code>is</code>
is flexible enough that all other checks (<a href="#TRY:SIGNALS%20MGL-PAX:MACRO" title="TRY:SIGNALS MGL-PAX:MACRO"><code>signals</code></a>, <a href="#TRY:SIGNALS-NOT%20MGL-PAX:MACRO" title="TRY:SIGNALS-NOT MGL-PAX:MACRO"><code>signals-not</code></a>,
<a href="#TRY:INVOKES-DEBUGGER%20MGL-PAX:MACRO" title="TRY:INVOKES-DEBUGGER MGL-PAX:MACRO"><code>invokes-debugger</code></a>, <a href="#TRY:INVOKES-DEBUGGER-NOT%20MGL-PAX:MACRO" title="TRY:INVOKES-DEBUGGER-NOT MGL-PAX:MACRO"><code>invokes-debugger-not</code></a>, <a href="#TRY:FAILS%20MGL-PAX:MACRO" title="TRY:FAILS MGL-PAX:MACRO"><code>fails</code></a>, and <a href="#TRY:IN-TIME%20MGL-PAX:MACRO" title="TRY:IN-TIME MGL-PAX:MACRO"><code>in-time</code></a> are built
on top of it.</p>
<h5>Writing Tests</h5>
<p>Beyond <code>is</code>, a fancy <code>assert</code>, Try provides tests, which are Lisp
functions that record their execution in <a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a> objects. Let's define
a test and run it:</p>
<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">deftest</span></i> should-work <span class="paren2">(<span class="code"></span>)</span>
  <span class="paren2">(<span class="code">is t</span>)</span></span>)</span>

<span class="paren1">(<span class="code">should-work</span>)</span>
.. SHOULD-WORK            <span class="comment">; TRIAL-START
</span>..   ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>             <span class="comment">; EXPECTED-RESULT-SUCCESS
</span>.. ⋅ SHOULD-WORK ⋅1       <span class="comment">; EXPECTED-VERDICT-SUCCESS
</span>..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code">SHOULD-WORK</span>)</span> EXPECTED-SUCCESS 0.000s ⋅1&gt;</span></code></pre>
<p>Try is driven by conditions, and the comments to the right give the
type of the condition that is printed on that line. The <code>⋅</code>
character marks successes.</p>
<p>We could have run our test with <code>(try 'should-work)</code> as well, which
does pretty much the same thing except it defaults to never entering
the debugger, whereas calling a test function directly enters the
debugger on events whose type matches the type in the variable
<a href="#TRY:*DEBUG*%20VARIABLE" title="TRY:*DEBUG* VARIABLE"><code>*debug*</code></a>.</p>
<pre><code><span class="code"><span class="paren1">(<span class="code">try 'should-work</span>)</span>
.. SHOULD-WORK
..   ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
.. ⋅ SHOULD-WORK ⋅1
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code">SHOULD-WORK</span>)</span> EXPECTED-SUCCESS 0.000s ⋅1&gt;</span></code></pre>
<h5>Test Suites</h5>
<p>Test suites are just tests that call other tests.</p>
<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">deftest</span></i> my-suite <span class="paren2">(<span class="code"></span>)</span>
  <span class="paren2">(<span class="code">should-work</span>)</span>
  <span class="paren2">(<span class="code">is <span class="paren3">(<span class="code">= <span class="paren4">(<span class="code">foo</span>)</span> 5</span>)</span></span>)</span></span>)</span>

<span class="paren1">(<span class="code"><i><span class="symbol">defun</span></i> foo <span class="paren2">(<span class="code"></span>)</span>
  4</span>)</span>

<span class="paren1">(<span class="code">try 'my-suite</span>)</span>
.. MY-SUITE                 <span class="comment">; TRIAL-START
</span>..   SHOULD-WORK            <span class="comment">; TRIAL-START
</span>..     ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>             <span class="comment">; EXPECTED-RESULT-SUCCESS
</span>..   ⋅ SHOULD-WORK ⋅1       <span class="comment">; EXPECTED-VERDICT-SUCCESS
</span>..   ⊠ <span class="paren1">(<span class="code">IS <span class="paren2">(<span class="code">= #1=<span class="paren3">(<span class="code">FOO</span>)</span> 5</span>)</span></span>)</span>  <span class="comment">; UNEXPECTED-RESULT-FAILURE
</span>..     where
..       #1# = 4
.. ⊠ MY-SUITE ⊠1 ⋅1         <span class="comment">; UNEXPECTED-VERDICT-FAILURE
</span>..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code">MY-SUITE</span>)</span> UNEXPECTED-FAILURE 0.000s ⊠1 ⋅1&gt;</span></code></pre>
<p><code>⊠</code> marks <a href="#TRY:UNEXPECTED-FAILURE%20TYPE" title="TRY:UNEXPECTED-FAILURE TYPE"><code>unexpected-failure</code></a>s. Note how the failure of <code>(is (= (foo)
5))</code> caused <code>my-suite</code> to fail as well. Finally, the <code>⊠1</code> and the
<code>⋅1</code> in the <code>trial</code>'s printed representation are the <a href="#TRY:@TRY%2FCOUNT%20MGL-PAX:SECTION" title="Counting Events">event
counts</a>.</p>
<h5>Filtering Output</h5>
<p>To focus on the important bits, we can print only the <a href="#TRY:UNEXPECTED%20CONDITION" title="TRY:UNEXPECTED CONDITION"><code>unexpected</code></a>
events:</p>
<pre><code><span class="code"><span class="paren1">(<span class="code">try 'my-suite <span class="keyword">:print</span> 'unexpected</span>)</span>
.. MY-SUITE
..   ⊠ <span class="paren1">(<span class="code">IS <span class="paren2">(<span class="code">= #1=<span class="paren3">(<span class="code">FOO</span>)</span> 5</span>)</span></span>)</span>
..     where
..       #1# = 4
.. ⊠ MY-SUITE ⊠1 ⋅1
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code">MY-SUITE</span>)</span> UNEXPECTED-FAILURE 0.000s ⊠1 ⋅1&gt;</span></code></pre>
<p>Note that <code>should-work</code> is still run, and its check's success is
counted as evidenced by<code>⋅1</code>. The above effect can also be achieved
without running the tests again with <a href="#TRY:REPLAY-EVENTS%20FUNCTION" title="TRY:REPLAY-EVENTS FUNCTION"><code>replay-events</code></a>.</p>
<h5>Debugging</h5>
<p>Let's figure out what went wrong:</p>
<pre><code><span class="code"><span class="paren1">(<span class="code">my-suite</span>)</span>

<span class="comment">;;; Here the debugger is invoked:
</span>UNEXPECTED-FAILURE in check:
  <span class="paren1">(<span class="code">IS <span class="paren2">(<span class="code">= #1=<span class="paren3">(<span class="code">FOO</span>)</span> 5</span>)</span></span>)</span>
where
  #1# = 4
Restarts:
 0: [RECORD-EVENT] Record the event and continue.
 1: [FORCE-EXPECTED-SUCCESS] Change outcome to TRY:EXPECTED-RESULT-SUCCESS.
 2: [FORCE-UNEXPECTED-SUCCESS] Change outcome to TRY:UNEXPECTED-RESULT-SUCCESS.
 3: [FORCE-EXPECTED-FAILURE] Change outcome to TRY:EXPECTED-RESULT-FAILURE.
 4: [ABORT-CHECK] Change outcome to TRY:RESULT-ABORT*.
 5: [SKIP-CHECK] Change outcome to TRY:RESULT-SKIP.
 6: [RETRY-CHECK] Retry check.
 7: [ABORT-TRIAL] Record the event and abort trial TRY::MY-SUITE.
 8: [SKIP-TRIAL] Record the event and skip trial TRY::MY-SUITE.
 9: [RETRY-TRIAL] Record the event and retry trial TRY::MY-SUITE.
 10: [SET-TRY-DEBUG] Supply a new value for :DEBUG of TRY:TRY.
 11: [RETRY] Retry SLIME interactive evaluation request.</span></code></pre>
<p>In the <a href="https://common-lisp.net/project/slime/doc/html/" >SLIME</a>
debugger, we press <code>v</code> on the frame of the call to <code>my-suite</code> to
navigate to its definition, realize what the problem is and fix
<code>foo</code>:</p>
<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">defun</span></i> foo <span class="paren2">(<span class="code"></span>)</span>
  5</span>)</span></span></code></pre>
<p>Now, we select the <a href="#TRY:RETRY-TRIAL%20FUNCTION" title="TRY:RETRY-TRIAL FUNCTION"><code>retry-trial</code></a> restart, and on the retry
<code>my-suite</code> passes. The full output is:</p>
<pre><code><span class="code">MY-SUITE
  SHOULD-WORK
    ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
  ⋅ SHOULD-WORK ⋅1
WARNING: redefining TRY::FOO in DEFUN
  ⊠ <span class="paren1">(<span class="code">IS <span class="paren2">(<span class="code">= #1=<span class="paren3">(<span class="code">FOO</span>)</span> 5</span>)</span></span>)</span>
    where
      #1# = 4
MY-SUITE retry #1
  SHOULD-WORK
    ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
  ⋅ SHOULD-WORK ⋅1
  ⋅ <span class="paren1">(<span class="code">IS <span class="paren2">(<span class="code">= <span class="paren3">(<span class="code">FOO</span>)</span> 5</span>)</span></span>)</span>
⋅ MY-SUITE ⋅2</span></code></pre>
<h5>Rerunning Stuff</h5>
<p>Instead of working interactively, one can fix the failing test and
rerun it. Now, let's fix <code>my-suite</code> and rerun it:</p>
<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">deftest</span></i> my-suite <span class="paren2">(<span class="code"></span>)</span>
  <span class="paren2">(<span class="code">should-work</span>)</span>
  <span class="paren2">(<span class="code">is nil</span>)</span></span>)</span>

<span class="paren1">(<span class="code">try 'my-suite</span>)</span>
.. MY-SUITE
..   SHOULD-WORK
..     ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
..   ⋅ SHOULD-WORK ⋅1
..   ⊠ <span class="paren1">(<span class="code">IS NIL</span>)</span>
.. ⊠ MY-SUITE ⊠1 ⋅1
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code">MY-SUITE</span>)</span> UNEXPECTED-FAILURE 0.000s ⊠1 ⋅1&gt;

<span class="paren1">(<span class="code"><i><span class="symbol">deftest</span></i> my-suite <span class="paren2">(<span class="code"></span>)</span>
  <span class="paren2">(<span class="code">should-work</span>)</span>
  <span class="paren2">(<span class="code">is t</span>)</span></span>)</span>

<span class="paren1">(<span class="code">try !</span>)</span>
.. MY-SUITE
..   ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
.. ⋅ MY-SUITE ⋅1
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code">MY-SUITE</span>)</span> EXPECTED-SUCCESS 0.004s ⋅1&gt;</span></code></pre>
<p>Here, <a href="#TRY:%21%20VARIABLE" title="TRY:! VARIABLE"><code>!</code></a> refers to the most recent <code>trial</code> returned by <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a>. When a
trial is passed to <code>try</code> or is <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_funcal.htm" title="FUNCALL (MGL-PAX:CLHS FUNCTION)"><code>funcall</code></a>ed, trials in it that match
the type in <code>try</code>'s <code>rerun</code> argument are rerun (here, <code>unexpected</code> by
default). <code>should-work</code> and its check are <a href="#TRY:EXPECTED-SUCCESS%20TYPE" title="TRY:EXPECTED-SUCCESS TYPE"><code>expected-success</code></a>es,
hence they don't match <code>unexpected</code> and are not <a href="#TRY:@TRY%2FRERUN%20MGL-PAX:SECTION" title="Rerunning Trials">rerun</a>.</p>
<h5>Conditional Execution</h5>
<p>Conditional execution can be achieved simply testing the <code>trial</code>
object returned by <a href="#TRY:@TRY%2FTESTS%20MGL-PAX:SECTION" title="Tests">Tests</a>.</p>
<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">deftest</span></i> my-suite <span class="paren2">(<span class="code"></span>)</span>
  <span class="paren2">(<span class="code">when <span class="paren3">(<span class="code">passedp <span class="paren4">(<span class="code">should-work</span>)</span></span>)</span>
    <span class="paren3">(<span class="code">is t <span class="keyword">:msg</span> <span class="string">"a test that depends on SHOULD-WORK"</span></span>)</span>
    <span class="paren3">(<span class="code">when <span class="paren4">(<span class="code">is nil</span>)</span>
      <span class="paren4">(<span class="code">is nil <span class="keyword">:msg</span> <span class="string">"never run"</span></span>)</span></span>)</span></span>)</span></span>)</span></span></code></pre>
<h5>Skipping</h5>
<p>Sometimes, we do not know up front that a test should not be
executed. Calling <a href="#TRY:SKIP-TRIAL%20FUNCTION" title="TRY:SKIP-TRIAL FUNCTION"><code>skip-trial</code></a> unwinds from the <a href="#TRY:CURRENT-TRIAL%20FUNCTION" title="TRY:CURRENT-TRIAL FUNCTION"><code>current-trial</code></a> and sets
it skipped.</p>
<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">deftest</span></i> my-suite <span class="paren2">(<span class="code"></span>)</span>
  <span class="paren2">(<span class="code">is t</span>)</span>
  <span class="paren2">(<span class="code">skip-trial</span>)</span>
  <span class="paren2">(<span class="code">is nil</span>)</span></span>)</span>

<span class="paren1">(<span class="code">my-suite</span>)</span>
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code">MY-SUITE</span>)</span> SKIP 0.000s ⋅1&gt;</span></code></pre>
<p>In the above, <code>(is t)</code> was executed, but <code>(is nil)</code> was not.</p>
<h5>Expecting Outcomes</h5>
<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">deftest</span></i> known-broken <span class="paren2">(<span class="code"></span>)</span>
  <span class="paren2">(<span class="code"><i><span class="symbol">with-failure-expected</span></i> <span class="paren3">(<span class="code">t</span>)</span>
    <span class="paren3">(<span class="code">is nil</span>)</span></span>)</span></span>)</span>

<span class="paren1">(<span class="code">known-broken</span>)</span>
.. KNOWN-BROKEN
..   × <span class="paren1">(<span class="code">IS NIL</span>)</span>
.. ⋅ KNOWN-BROKEN ×1
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code">KNOWN-BROKEN</span>)</span> EXPECTED-SUCCESS 0.000s ×1&gt;</span></code></pre>
<p><code>×</code> marks <a href="#TRY:EXPECTED-FAILURE%20TYPE" title="TRY:EXPECTED-FAILURE TYPE"><code>expected-failure</code></a>s. <code>(with-skip (t) ...)</code> makes all checks
successes and failures <a href="#TRY:EXPECTED%20CONDITION" title="TRY:EXPECTED CONDITION"><code>expected</code></a>, which are counted in their own
<a href="#TRY:*CATEGORIES*%20VARIABLE" title="TRY:*CATEGORIES* VARIABLE"><code>*categories*</code></a> by default but don't make the enclosing tests to fail.
Also see <a href="#TRY:WITH-EXPECTED-OUTCOME%20MGL-PAX:MACRO" title="TRY:WITH-EXPECTED-OUTCOME MGL-PAX:MACRO"><code>with-expected-outcome</code></a>.</p>
<h5>Running Tests on Definition</h5>
<p>With <a href="#TRY:*RUN-DEFTEST-WHEN*%20VARIABLE" title="TRY:*RUN-DEFTEST-WHEN* VARIABLE"><code>*run-deftest-when*</code></a>, tests on in various <a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_eval_w.htm" title="EVAL-WHEN (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>eval-when</code></a> situations.
To run tests on evaluation, as in SLIME <code>C-M-x</code>, <code>slime-eval-defun</code>:</p>
<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">setq</span></i> <span class="special">*run-deftest-when*</span> <span class="keyword">:execute</span></span>)</span>

<span class="paren1">(<span class="code"><i><span class="symbol">deftest</span></i> some-test <span class="paren2">(<span class="code"></span>)</span>
  <span class="paren2">(<span class="code">is t</span>)</span></span>)</span>
.. SOME-TEST
..   ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
.. ⋅ SOME-TEST ⋅1
..
=&gt; SOME-TEST

<span class="paren1">(<span class="code"><i><span class="symbol">setq</span></i> <span class="special">*run-deftest-when*</span> nil</span>)</span></span></code></pre>
<h5>Fixtures</h5>
<p>There is no direct support for fixtures in Try. One can easily write
macros like the following.</p>
<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">defvar</span></i> <span class="special">*server*</span> nil</span>)</span>

<span class="paren1">(<span class="code"><i><span class="symbol">defmacro</span></i> <i><span class="symbol">with-xxx</span></i> <span class="paren2">(<span class="code">&amp;body body</span>)</span>
  `<span class="paren2">(<span class="code"><i><span class="symbol">flet</span></i> <span class="paren3">(<span class="code"><span class="paren4">(<span class="code">,<i><span class="symbol">with-xxx-body</span></i> <span class="paren5">(<span class="code"></span>)</span>
            ,@body</span>)</span></span>)</span>
     <span class="paren3">(<span class="code"><i><span class="symbol">if</span></i> <span class="special">*server*</span>
         <span class="paren4">(<span class="code"><i><span class="symbol">with-xxx-body</span></i></span>)</span>
         <span class="paren4">(<span class="code"><i><span class="symbol">with-server</span></i> <span class="paren5">(<span class="code">make-expensive-server</span>)</span>
           <span class="paren5">(<span class="code"><i><span class="symbol">with-xxx-body</span></i></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span></code></pre>
<p>Plus, with support for selectively <a href="#TRY:@TRY%2FRERUN%20MGL-PAX:SECTION" title="Rerunning Trials">Rerunning Trials</a>, the need for fixtures
is lessened.</p>
<h5>Packages</h5>
<p>The suggested way of writing tests is to call test functions
explicitly:</p>
<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">defpackage</span></i> <span class="keyword">:some-test-package</span>
  <span class="paren2">(<span class="code"><span class="keyword">:use</span> <span class="keyword">#:common-lisp</span> <span class="keyword">#:try</span></span>)</span></span>)</span>
<span class="paren1">(<span class="code">in-package <span class="keyword">:some-test-package</span></span>)</span>

<span class="paren1">(<span class="code"><i><span class="symbol">deftest</span></i> test-all <span class="paren2">(<span class="code"></span>)</span>
  <span class="paren2">(<span class="code">test-this</span>)</span>
  <span class="paren2">(<span class="code">test-that</span>)</span></span>)</span>

<span class="paren1">(<span class="code"><i><span class="symbol">deftest</span></i> test-this <span class="paren2">(<span class="code"></span>)</span>
  <span class="paren2">(<span class="code">test-this/more</span>)</span></span>)</span>

<span class="paren1">(<span class="code"><i><span class="symbol">deftest</span></i> test-this/more <span class="paren2">(<span class="code"></span>)</span>
  <span class="paren2">(<span class="code">is t</span>)</span></span>)</span>

<span class="paren1">(<span class="code"><i><span class="symbol">deftest</span></i> test-that <span class="paren2">(<span class="code"></span>)</span>
  <span class="paren2">(<span class="code">is t</span>)</span></span>)</span>

<span class="paren1">(<span class="code"><i><span class="symbol">deftest</span></i> not-called <span class="paren2">(<span class="code"></span>)</span>
  <span class="paren2">(<span class="code">is t</span>)</span></span>)</span>

<span class="paren1">(<span class="code"><i><span class="symbol">defun</span></i> test <span class="paren2">(<span class="code"></span>)</span>
  <span class="paren2">(<span class="code">warn-on-tests-not-run <span class="paren3">(<span class="code"><span class="paren4">(<span class="code">find-package <span class="keyword">:some-test-package</span></span>)</span></span>)</span>
    <span class="paren3">(<span class="code">try 'test-all</span>)</span></span>)</span></span>)</span>

<span class="paren1">(<span class="code">test</span>)</span>
.. TEST-ALL
..   TEST-THIS
..     TEST-THIS/MORE
..       ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
..     ⋅ TEST-THIS/MORE ⋅1
..   ⋅ TEST-THIS ⋅1
..   TEST-THAT
..     ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
..   ⋅ TEST-THAT ⋅1
.. ⋅ TEST-ALL ⋅2
.. WARNING: Test NOT-CALLED not run.
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code">TEST-ALL</span>)</span> EXPECTED-SUCCESS 0.012s ⋅2&gt;</span></code></pre>
<p>Note how the <code>test</code> function uses <a href="#TRY:WARN-ON-TESTS-NOT-RUN%20MGL-PAX:MACRO" title="TRY:WARN-ON-TESTS-NOT-RUN MGL-PAX:MACRO"><code>warn-on-tests-not-run</code></a> to catch any
tests defined in <code>some-test-package</code> that were not run. Tests can be
deleted by <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_fmakun.htm" title="FMAKUNBOUND (MGL-PAX:CLHS FUNCTION)"><code>fmakunbound</code></a>, <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_uninte.htm" title="UNINTERN (MGL-PAX:CLHS FUNCTION)"><code>unintern</code></a>, or by redefining the function with
<a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_defun.htm" title="DEFUN (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>defun</code></a>. Tests defined in a given package can be listed with
<a href="#TRY:LIST-PACKAGE-TESTS%20FUNCTION" title="TRY:LIST-PACKAGE-TESTS FUNCTION"><code>list-package-tests</code></a>.</p>
<p>This style allows higher level tests to establish the dynamic
environment necessary for lower level tests.</p>
<p><a id="x-28TRY-3A-40TRY-2FEMACS-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FEMACS%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FTUTORIAL%20MGL-PAX:SECTION" title="Tutorial">&#8592;</a> <a href="try-manual.html" title="Try Manual">&#8593;</a> <a href="#TRY:@TRY%2FEMACS-SETUP%20MGL-PAX:SECTION" title="Emacs Setup">&#8594;</a> <a href="#TRY:@TRY%2FEMACS%20MGL-PAX:SECTION" title="Emacs Integration">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/manual.lisp#L418">&#955;</a></span></span></p>
<h2><a href="#TRY:@TRY%2FEMACS%20MGL-PAX:SECTION">4 Emacs Integration</a></h2>
<p>The Elisp <code>mgl-try</code> interactive command runs a Try test and
displays its output in a <code>lisp-mode</code> buffer with minor modes
<code>outline-mode</code> and <code>mgl-try-mode</code>. In the buffer,</p>
<ul>
<li><p>use <code>m-.</code> to visit a test function;</p></li>
<li><p>move between <a href="#TRY:UNEXPECTED%20CONDITION" title="TRY:UNEXPECTED CONDITION"><code>unexpected</code></a> events with keys <code>p</code> and <code>n</code>;</p></li>
<li><p>rerun the most recent trial (<a href="#TRY:%21%20VARIABLE" title="TRY:! VARIABLE"><code>try:!</code></a>) with <code>r</code> (subject to the
  filtering described <a href="#TRY:@TRY%2FRERUN%20MGL-PAX:SECTION" title="Rerunning Trials">Rerunning Trials</a>);</p></li>
<li><p>rerun the most recently finished test with <code>r</code> (and all tests it
  calls);</p></li>
<li><p>run an arbitrary test with <code>t</code> (defaults to symbol under point);</p></li>
<li><p>some low-level outline mode commands are also given convenient
  bindings:</p>

<pre><code>&lt;tab&gt;           outline-cycle
N               outline-next-visible-heading
P               outline-previous-visible-heading
U               outline-up-heading
</code></pre></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FEMACS-SETUP-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FEMACS-SETUP%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FEMACS%20MGL-PAX:SECTION" title="Emacs Integration">&#8592;</a> <a href="#TRY:@TRY%2FEMACS%20MGL-PAX:SECTION" title="Emacs Integration">&#8593;</a> <a href="#TRY:@TRY%2FEVENTS%20MGL-PAX:SECTION" title="Events">&#8594;</a> <a href="#TRY:@TRY%2FEMACS-SETUP%20MGL-PAX:SECTION" title="Emacs Setup">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/manual.lisp#L444">&#955;</a></span></span></p>
<h3><a href="#TRY:@TRY%2FEMACS-SETUP%20MGL-PAX:SECTION">4.1 Emacs Setup</a></h3>
<p>Load <code>src/mgl-try.el</code> in Emacs.</p>
<p>If you installed Try with Quicklisp, the location of <code>mgl-try.el</code>
may change with updates, and you may want to copy the current
version of <code>mgl-try.el</code> to a stable location:</p>
<pre><code>(try:install-try-elisp &quot;~/quicklisp/&quot;)
</code></pre>
<p>Then, assuming the Elisp file is in the quicklisp directory, add
something like this to your <code>.emacs</code>:</p>
<pre><code><span class="code"><span class="paren1">(<span class="code"><a href="http://www.gnu.org/software/emacs/elisp-manual/html_node/elisp_196.html#IDX517" class="symbol">load</a> <span class="string">"~/quicklisp/mgl-try.el"</span></span>)</span></span></code></pre>
<p><a id="x-28TRY-3AINSTALL-TRY-ELISP-20FUNCTION-29"></a>
<a id="TRY:INSTALL-TRY-ELISP%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/manual.lisp#L461">[function]</a></span> <span class="reference-object"><a href="#TRY:INSTALL-TRY-ELISP%20FUNCTION" >install-try-elisp</a></span></span> <span class="locative-args">target-dir</span></span></p>

<p>Copy <code>mgl-try.el</code> distributed with this package to <code>target-dir</code>.</p></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FEVENTS-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FEVENTS%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FEMACS-SETUP%20MGL-PAX:SECTION" title="Emacs Setup">&#8592;</a> <a href="try-manual.html" title="Try Manual">&#8593;</a> <a href="#TRY:@TRY%2FMIDDLE-LAYER-OF-EVENTS%20MGL-PAX:SECTION" title="Middle Layer of Events">&#8594;</a> <a href="#TRY:@TRY%2FEVENTS%20MGL-PAX:SECTION" title="Events">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L5">&#955;</a></span></span></p>
<h2><a href="#TRY:@TRY%2FEVENTS%20MGL-PAX:SECTION">5 Events</a></h2>
<p>Try is built around events implemented as <a href="http://www.lispworks.com/documentation/HyperSpec/Body/e_cnd.htm" title="CONDITION (MGL-PAX:CLHS CONDITION)"><code>condition</code></a>s.
Matching the types of events to <a href="#TRY:*DEBUG*%20VARIABLE" title="TRY:*DEBUG* VARIABLE"><code>*debug*</code></a>, <a href="#TRY:*COUNT*%20VARIABLE" title="TRY:*COUNT* VARIABLE"><code>*count*</code></a>, <a href="#TRY:*COLLECT*%20VARIABLE" title="TRY:*COLLECT* VARIABLE"><code>*collect*</code></a>, <a href="#TRY:*RERUN*%20VARIABLE" title="TRY:*RERUN* VARIABLE"><code>*rerun*</code></a>,
<a href="#TRY:*PRINT*%20VARIABLE" title="TRY:*PRINT* VARIABLE"><code>*print*</code></a>, and <a href="#TRY:*DESCRIBE*%20VARIABLE" title="TRY:*DESCRIBE* VARIABLE"><code>*describe*</code></a> is what gives Try its flexibility.</p>
<p><a id="x-28TRY-3A-40TRY-2FMIDDLE-LAYER-OF-EVENTS-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FMIDDLE-LAYER-OF-EVENTS%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FEVENTS%20MGL-PAX:SECTION" title="Events">&#8592;</a> <a href="#TRY:@TRY%2FEVENTS%20MGL-PAX:SECTION" title="Events">&#8593;</a> <a href="#TRY:@TRY%2FCONCRETE-EVENTS%20MGL-PAX:SECTION" title="Concrete Events">&#8594;</a> <a href="#TRY:@TRY%2FMIDDLE-LAYER-OF-EVENTS%20MGL-PAX:SECTION" title="Middle Layer of Events">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L18">&#955;</a></span></span></p>
<h3><a href="#TRY:@TRY%2FMIDDLE-LAYER-OF-EVENTS%20MGL-PAX:SECTION">5.1 Middle Layer of Events</a></h3>
<p>The event hierarchy is fairly involved, so let's start in the middle.
The condition <a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION"><code>event</code></a> has 4 disjoint subclasses:</p>
<ul>
<li><p><a href="#TRY:TRIAL-START%20CONDITION" title="TRY:TRIAL-START CONDITION"><code>trial-start</code></a>, which corresponds to the entry to a test (see
  <a href="#TRY:@TRY%2FTESTS%20MGL-PAX:SECTION" title="Tests">Tests</a>),</p></li>
<li><p><a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a>, the <a href="#TRY:OUTCOME%20CONDITION" title="TRY:OUTCOME CONDITION"><code>outcome</code></a> of a <a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a>,</p></li>
<li><p><a href="#TRY:RESULT%20CONDITION" title="TRY:RESULT CONDITION"><code>result</code></a>, the <code>outcome</code> of a check (see <a href="#TRY:@TRY%2FCHECKS%20MGL-PAX:SECTION" title="Checks">Checks</a>), and</p></li>
<li><p><a href="#TRY:ERROR*%20CONDITION" title="TRY:ERROR* CONDITION"><code>error*</code></a>, an unexpected <code>cl:error</code>(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/e_error.htm" title="ERROR (MGL-PAX:CLHS CONDITION)"><code>0</code></a> <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_error.htm" title="ERROR (MGL-PAX:CLHS FUNCTION)"><code>1</code></a>) or unadorned <a href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_n.htm#non-local_exit" title="&quot;non-local exit&quot; (MGL-PAX:CLHS MGL-PAX:GLOSSARY-TERM)">non-local exit</a>.</p></li>
</ul>
<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">let</span></i> <span class="paren2">(<span class="code"><span class="comment">;; We don't want to debug nor print a backtrace for the error below.
</span>      <span class="paren3">(<span class="code"><span class="special">*debug*</span> nil</span>)</span>
      <span class="paren3">(<span class="code"><span class="special">*describe*</span> nil</span>)</span></span>)</span>
  <span class="comment">;; signals TRIAL-START / VERDICT-ABORT* on entry / exit
</span>  <span class="paren2">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren3">(<span class="code">demo</span>)</span>
    <span class="comment">;; signals EXPECTED-RESULT-SUCCESS
</span>    <span class="paren3">(<span class="code">is t</span>)</span>
    <span class="comment">;; signals UNHANDLED-ERROR with a nested CL:ERROR
</span>    <span class="paren3">(<span class="code">error <span class="string">"xxx"</span></span>)</span></span>)</span></span>)</span>
.. DEMO                       <span class="comment">; TRIAL-START
</span>..   ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>                 <span class="comment">; EXPECTED-RESULT-SUCCESS (⋅)
</span>..   ⊟ "xxx" <span class="paren1">(<span class="code">SIMPLE-ERROR</span>)</span>   <span class="comment">; UNHANDLED-ERROR (⊟)
</span>.. ⊟ DEMO ⊟1 ⋅1               <span class="comment">; VERDICT-ABORT* (⊟)
</span>..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">DEMO</span>)</span></span>)</span> ABORT* 0.004s ⊟1 ⋅1&gt;</span></code></pre>
<p><a id="x-28TRY-3A-40TRY-2FCONCRETE-EVENTS-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FCONCRETE-EVENTS%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FMIDDLE-LAYER-OF-EVENTS%20MGL-PAX:SECTION" title="Middle Layer of Events">&#8592;</a> <a href="#TRY:@TRY%2FEVENTS%20MGL-PAX:SECTION" title="Events">&#8593;</a> <a href="#TRY:@TRY%2FEVENT-GLUE%20MGL-PAX:SECTION" title="Event Glue">&#8594;</a> <a href="#TRY:@TRY%2FCONCRETE-EVENTS%20MGL-PAX:SECTION" title="Concrete Events">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L50">&#955;</a></span></span></p>
<h3><a href="#TRY:@TRY%2FCONCRETE-EVENTS%20MGL-PAX:SECTION">5.2 Concrete Events</a></h3>
<p>The non-abstract condition classes of events that are actually
signalled are called concrete.</p>
<p><a href="#TRY:TRIAL-START%20CONDITION" title="TRY:TRIAL-START CONDITION"><code>trial-start</code></a> is a concrete event class. <a href="#TRY:RESULT%20CONDITION" title="TRY:RESULT CONDITION"><code>result</code></a>s and <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a>s have six
 concrete subclasses:</p>
<ul>
<li><p><a href="#TRY:EXPECTED-RESULT-SUCCESS%20CONDITION" title="TRY:EXPECTED-RESULT-SUCCESS CONDITION"><code>expected-result-success</code></a>, <a href="#TRY:UNEXPECTED-RESULT-SUCCESS%20CONDITION" title="TRY:UNEXPECTED-RESULT-SUCCESS CONDITION"><code>unexpected-result-success</code></a>,
   <a href="#TRY:EXPECTED-RESULT-FAILURE%20CONDITION" title="TRY:EXPECTED-RESULT-FAILURE CONDITION"><code>expected-result-failure</code></a>, <a href="#TRY:UNEXPECTED-RESULT-FAILURE%20CONDITION" title="TRY:UNEXPECTED-RESULT-FAILURE CONDITION"><code>unexpected-result-failure</code></a>,
   <a href="#TRY:RESULT-SKIP%20CONDITION" title="TRY:RESULT-SKIP CONDITION"><code>result-skip</code></a>, <a href="#TRY:RESULT-ABORT*%20CONDITION" title="TRY:RESULT-ABORT* CONDITION"><code>result-abort*</code></a></p></li>
<li><p><a href="#TRY:EXPECTED-VERDICT-SUCCESS%20CONDITION" title="TRY:EXPECTED-VERDICT-SUCCESS CONDITION"><code>expected-verdict-success</code></a>, <a href="#TRY:UNEXPECTED-VERDICT-SUCCESS%20CONDITION" title="TRY:UNEXPECTED-VERDICT-SUCCESS CONDITION"><code>unexpected-verdict-success</code></a>,
   <a href="#TRY:EXPECTED-VERDICT-FAILURE%20CONDITION" title="TRY:EXPECTED-VERDICT-FAILURE CONDITION"><code>expected-verdict-failure</code></a>, <a href="#TRY:UNEXPECTED-VERDICT-FAILURE%20CONDITION" title="TRY:UNEXPECTED-VERDICT-FAILURE CONDITION"><code>unexpected-verdict-failure</code></a>,
   <a href="#TRY:VERDICT-SKIP%20CONDITION" title="TRY:VERDICT-SKIP CONDITION"><code>verdict-skip</code></a>, <a href="#TRY:VERDICT-ABORT*%20CONDITION" title="TRY:VERDICT-ABORT* CONDITION"><code>verdict-abort*</code></a></p></li>
</ul>
<p><a href="#TRY:ERROR*%20CONDITION" title="TRY:ERROR* CONDITION"><code>error*</code></a> is an abstract class with two concrete subclasses:</p>
<ul>
<li><p><a href="#TRY:UNHANDLED-ERROR%20CONDITION" title="TRY:UNHANDLED-ERROR CONDITION"><code>unhandled-error</code></a>, signalled when a <code>cl:error</code>(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/e_error.htm" title="ERROR (MGL-PAX:CLHS CONDITION)"><code>0</code></a> <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_error.htm" title="ERROR (MGL-PAX:CLHS FUNCTION)"><code>1</code></a>) reaches the handler set
   up by <a href="#TRY:DEFTEST%20MGL-PAX:MACRO" title="TRY:DEFTEST MGL-PAX:MACRO"><code>deftest</code></a> or <a href="#TRY:WITH-TEST%20MGL-PAX:MACRO" title="TRY:WITH-TEST MGL-PAX:MACRO"><code>with-test</code></a>, or when the debugger is invoked.</p></li>
<li><p><a href="#TRY:NLX%20CONDITION" title="TRY:NLX CONDITION"><code>nlx</code></a>, signalled when no error was detected by the handler, but the
   trial finishes with a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_n.htm#non-local_exit" title="&quot;non-local exit&quot; (MGL-PAX:CLHS MGL-PAX:GLOSSARY-TERM)">non-local exit</a>.</p></li>
</ul>
<p>These are the 15 concrete event classes.</p>
<p><a id="x-28TRY-3A-40TRY-2FEVENT-GLUE-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FEVENT-GLUE%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FCONCRETE-EVENTS%20MGL-PAX:SECTION" title="Concrete Events">&#8592;</a> <a href="#TRY:@TRY%2FEVENTS%20MGL-PAX:SECTION" title="Events">&#8593;</a> <a href="#TRY:@TRY%2FPRINTING-EVENTS%20MGL-PAX:SECTION" title="Printing Events">&#8594;</a> <a href="#TRY:@TRY%2FEVENT-GLUE%20MGL-PAX:SECTION" title="Event Glue">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L76">&#955;</a></span></span></p>
<h3><a href="#TRY:@TRY%2FEVENT-GLUE%20MGL-PAX:SECTION">5.3 Event Glue</a></h3>
<p>These condition classes group various bits of the
<a href="#TRY:@TRY%2FCONCRETE-EVENTS%20MGL-PAX:SECTION" title="Concrete Events">Concrete Events</a> and the <a href="#TRY:@TRY%2FMIDDLE-LAYER-OF-EVENTS%20MGL-PAX:SECTION" title="Middle Layer of Events">Middle Layer of Events</a> for ease of
reference.</p>
<p>Concrete event classes except <a href="#TRY:TRIAL-START%20CONDITION" title="TRY:TRIAL-START CONDITION"><code>trial-start</code></a> are subclasses of
hyphen-separated words in their name. For example,
<a href="#TRY:UNEXPECTED-RESULT-FAILURE%20CONDITION" title="TRY:UNEXPECTED-RESULT-FAILURE CONDITION"><code>unexpected-result-failure</code></a> inherits from <a href="#TRY:UNEXPECTED%20CONDITION" title="TRY:UNEXPECTED CONDITION"><code>unexpected</code></a>, <a href="#TRY:RESULT%20CONDITION" title="TRY:RESULT CONDITION"><code>result</code></a>, and
<a href="#TRY:FAILURE%20CONDITION" title="TRY:FAILURE CONDITION"><code>failure</code></a>, so it matches types such as <code>unexpected</code> or <code>(and unexpected
result)</code>.</p>
<p><a id="x-28TRY-3AEVENT-20CONDITION-29"></a>
<a id="TRY:EVENT%20CONDITION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L118">[condition]</a></span> <span class="reference-object"><a href="#TRY:EVENT%20CONDITION" >event</a></span></span></span></p>

<p>Common abstract superclass of all events in Try.</p></li>
</ul>
<p><a id="x-28TRY-3AEXPECTED-20CONDITION-29"></a>
<a id="TRY:EXPECTED%20CONDITION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L124">[condition]</a></span> <span class="reference-object"><a href="#TRY:EXPECTED%20CONDITION" >expected</a></span></span> <span class="locative-args"><a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION">event</a></span></span></p>

<p>Concrete condition classes with <code>expected</code> in their
name are subclasses of <code>expected</code>. <a href="#TRY:SKIP%20CONDITION" title="TRY:SKIP CONDITION"><code>skip</code></a> is also a subclass of
<code>expected</code>.</p></li>
</ul>
<p><a id="x-28TRY-3AUNEXPECTED-20CONDITION-29"></a>
<a id="TRY:UNEXPECTED%20CONDITION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L129">[condition]</a></span> <span class="reference-object"><a href="#TRY:UNEXPECTED%20CONDITION" >unexpected</a></span></span> <span class="locative-args"><a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION">event</a></span></span></p>

<p>Concrete condition classes with <code>unexpected</code> in their
name are subclasses of <code>unexpected</code>. <a href="#TRY:ABORT*%20CONDITION" title="TRY:ABORT* CONDITION"><code>abort*</code></a> is also a subclass of
<code>unexpected</code>.</p></li>
</ul>
<p><a id="x-28TRY-3ASUCCESS-20CONDITION-29"></a>
<a id="TRY:SUCCESS%20CONDITION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L134">[condition]</a></span> <span class="reference-object"><a href="#TRY:SUCCESS%20CONDITION" >success</a></span></span> <span class="locative-args"><a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION">event</a></span></span></p>

<p>See <a href="#TRY:@TRY%2FCHECKS%20MGL-PAX:SECTION" title="Checks">Checks</a> and <a href="#TRY:@TRY%2FTRIAL-VERDICTS%20MGL-PAX:SECTION" title="Trial Verdicts">Trial Verdicts</a> for how
<code>success</code> or <a href="#TRY:FAILURE%20CONDITION" title="TRY:FAILURE CONDITION"><code>failure</code></a> is decided.</p></li>
</ul>
<p><a id="x-28TRY-3AFAILURE-20CONDITION-29"></a>
<a id="TRY:FAILURE%20CONDITION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L138">[condition]</a></span> <span class="reference-object"><a href="#TRY:FAILURE%20CONDITION" >failure</a></span></span> <span class="locative-args"><a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION">event</a></span></span></p>

<p>See <a href="#TRY:SUCCESS%20CONDITION" title="TRY:SUCCESS CONDITION"><code>success</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3ADISMISSAL-20CONDITION-29"></a>
<a id="TRY:DISMISSAL%20CONDITION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L141">[condition]</a></span> <span class="reference-object"><a href="#TRY:DISMISSAL%20CONDITION" >dismissal</a></span></span> <span class="locative-args"><a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION">event</a></span></span></p>

<p>The third possibility after <a href="#TRY:SUCCESS%20CONDITION" title="TRY:SUCCESS CONDITION"><code>success</code></a> and <a href="#TRY:FAILURE%20CONDITION" title="TRY:FAILURE CONDITION"><code>failure</code></a>.
Either <a href="#TRY:SKIP%20CONDITION" title="TRY:SKIP CONDITION"><code>skip</code></a> or <a href="#TRY:ABORT*%20CONDITION" title="TRY:ABORT* CONDITION"><code>abort*</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3AABORT-2A-20CONDITION-29"></a>
<a id="TRY:ABORT*%20CONDITION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L145">[condition]</a></span> <span class="reference-object"><a href="#TRY:ABORT*%20CONDITION" >abort*</a></span></span> <span class="locative-args"><a href="#TRY:UNEXPECTED%20CONDITION" title="TRY:UNEXPECTED CONDITION">unexpected</a></span></span></p>

<p><a href="#TRY:RESULT-ABORT*%20CONDITION" title="TRY:RESULT-ABORT* CONDITION"><code>result-abort*</code></a>, <a href="#TRY:VERDICT-ABORT*%20CONDITION" title="TRY:VERDICT-ABORT* CONDITION"><code>verdict-abort*</code></a> or <a href="#TRY:ERROR*%20CONDITION" title="TRY:ERROR* CONDITION"><code>error*</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3ASKIP-20CONDITION-29"></a>
<a id="TRY:SKIP%20CONDITION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/outcome.lisp#L128">[condition]</a></span> <span class="reference-object"><a href="#TRY:SKIP%20CONDITION" >skip</a></span></span> <span class="locative-args"><a href="#TRY:EXPECTED%20CONDITION" title="TRY:EXPECTED CONDITION">expected</a> <a href="#TRY:DISMISSAL%20CONDITION" title="TRY:DISMISSAL CONDITION">dismissal</a></span></span></p>

<p><a href="#TRY:RESULT-SKIP%20CONDITION" title="TRY:RESULT-SKIP CONDITION"><code>result-skip</code></a> or <a href="#TRY:VERDICT-SKIP%20CONDITION" title="TRY:VERDICT-SKIP CONDITION"><code>verdict-skip</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3ALEAF-20CONDITION-29"></a>
<a id="TRY:LEAF%20CONDITION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L121">[condition]</a></span> <span class="reference-object"><a href="#TRY:LEAF%20CONDITION" >leaf</a></span></span> <span class="locative-args"><a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION">event</a></span></span></p>

<p><a href="#TRY:RESULT%20CONDITION" title="TRY:RESULT CONDITION"><code>result</code></a> or <a href="#TRY:ERROR*%20CONDITION" title="TRY:ERROR* CONDITION"><code>error*</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3AEXPECTED-SUCCESS-20TYPE-29"></a>
<a id="TRY:EXPECTED-SUCCESS%20TYPE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L149">[type]</a></span> <span class="reference-object"><a href="#TRY:EXPECTED-SUCCESS%20TYPE" >expected-success</a></span></span></span></p>

<p>A shorthand for <code>(and expected success)</code>.</p></li>
</ul>
<p><a id="x-28TRY-3AUNEXPECTED-SUCCESS-20TYPE-29"></a>
<a id="TRY:UNEXPECTED-SUCCESS%20TYPE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L152">[type]</a></span> <span class="reference-object"><a href="#TRY:UNEXPECTED-SUCCESS%20TYPE" >unexpected-success</a></span></span></span></p>

<p>A shorthand for <code>(and unexpected success)</code>.</p></li>
</ul>
<p><a id="x-28TRY-3AEXPECTED-FAILURE-20TYPE-29"></a>
<a id="TRY:EXPECTED-FAILURE%20TYPE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L155">[type]</a></span> <span class="reference-object"><a href="#TRY:EXPECTED-FAILURE%20TYPE" >expected-failure</a></span></span></span></p>

<p>A shorthand for <code>(and expected failure)</code>.</p></li>
</ul>
<p><a id="x-28TRY-3AUNEXPECTED-FAILURE-20TYPE-29"></a>
<a id="TRY:UNEXPECTED-FAILURE%20TYPE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L158">[type]</a></span> <span class="reference-object"><a href="#TRY:UNEXPECTED-FAILURE%20TYPE" >unexpected-failure</a></span></span></span></p>

<p>A shorthand for <code>(and unexpected failure)</code>.</p></li>
</ul>
<p><a id="x-28TRY-3APASS-20TYPE-29"></a>
<a id="TRY:PASS%20TYPE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L162">[type]</a></span> <span class="reference-object"><a href="#TRY:PASS%20TYPE" >pass</a></span></span></span></p>

<p>An <a href="#TRY:OUTCOME%20CONDITION" title="TRY:OUTCOME CONDITION"><code>outcome</code></a> that's not an <a href="#TRY:ABORT*%20CONDITION" title="TRY:ABORT* CONDITION"><code>abort*</code></a> or an <a href="#TRY:UNEXPECTED%20CONDITION" title="TRY:UNEXPECTED CONDITION"><code>unexpected</code></a> <a href="#TRY:FAILURE%20CONDITION" title="TRY:FAILURE CONDITION"><code>failure</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3AFAIL-20TYPE-29"></a>
<a id="TRY:FAIL%20TYPE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L165">[type]</a></span> <span class="reference-object"><a href="#TRY:FAIL%20TYPE" >fail</a></span></span></span></p>

<p>An <a href="#TRY:ABORT*%20CONDITION" title="TRY:ABORT* CONDITION"><code>abort*</code></a> or an <a href="#TRY:UNEXPECTED%20CONDITION" title="TRY:UNEXPECTED CONDITION"><code>unexpected</code></a> <a href="#TRY:FAILURE%20CONDITION" title="TRY:FAILURE CONDITION"><code>failure</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FPRINTING-EVENTS-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FPRINTING-EVENTS%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FEVENT-GLUE%20MGL-PAX:SECTION" title="Event Glue">&#8592;</a> <a href="#TRY:@TRY%2FEVENTS%20MGL-PAX:SECTION" title="Events">&#8593;</a> <a href="#TRY:@TRY%2FEVENT-RESTARTS%20MGL-PAX:SECTION" title="Event Restarts">&#8594;</a> <a href="#TRY:@TRY%2FPRINTING-EVENTS%20MGL-PAX:SECTION" title="Printing Events">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L170">&#955;</a></span></span></p>
<h3><a href="#TRY:@TRY%2FPRINTING-EVENTS%20MGL-PAX:SECTION">5.4 Printing Events</a></h3>
<p><a id="x-28TRY-3A-2AEVENT-PRINT-BINDINGS-2A-20VARIABLE-29"></a>
<a id="TRY:*EVENT-PRINT-BINDINGS*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L173">[variable]</a></span> <span class="reference-object"><a href="#TRY:*EVENT-PRINT-BINDINGS*%20VARIABLE" >*event-print-bindings*</a></span></span> <span class="locative-args">((*print-circle* t))</span></span></p>

<p><a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION"><code>event</code></a>s are conditions signalled in code that may change printer
variables such as <a href="http://www.lispworks.com/documentation/HyperSpec/Body/v_pr_cir.htm" title="*PRINT-CIRCLE* (MGL-PAX:CLHS VARIABLE)"><code>*print-circle*</code></a>, <a href="http://www.lispworks.com/documentation/HyperSpec/Body/v_pr_lev.htm" title="*PRINT-LENGTH* (MGL-PAX:CLHS VARIABLE)"><code>*print-length*</code></a>, etc. To control
how events are printed, the list of variable bindings in
<code>*event-print-bindings*</code> is established whenever an <code>event</code> is printed
as if with:</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">progv</span></i> <span class="paren2">(<span class="code">mapcar #'first <span class="special">*event-print-bindings*</span></span>)</span>
       <span class="paren2">(<span class="code">mapcar #'second <span class="special">*event-print-bindings*</span></span>)</span>
  ...</span>)</span></span></code></pre>

<p>The default value ensures that shared structure is recognized (see
<a href="#TRY:@TRY%2FCAPTURES%20MGL-PAX:SECTION" title="Captures">Captures</a>). If the <code>#n#</code> syntax feels cumbersome, then change
this variable.</p></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FEVENT-RESTARTS-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FEVENT-RESTARTS%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FPRINTING-EVENTS%20MGL-PAX:SECTION" title="Printing Events">&#8592;</a> <a href="#TRY:@TRY%2FEVENTS%20MGL-PAX:SECTION" title="Events">&#8593;</a> <a href="#TRY:@TRY%2FOUTCOMES%20MGL-PAX:SECTION" title="Outcomes">&#8594;</a> <a href="#TRY:@TRY%2FEVENT-RESTARTS%20MGL-PAX:SECTION" title="Event Restarts">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L209">&#955;</a></span></span></p>
<h3><a href="#TRY:@TRY%2FEVENT-RESTARTS%20MGL-PAX:SECTION">5.5 Event Restarts</a></h3>
<p>Only <a href="#TRY:RECORD-EVENT%20FUNCTION" title="TRY:RECORD-EVENT FUNCTION"><code>record-event</code></a> is applicable to all <a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION"><code>event</code></a>s. See
<a href="#TRY:@TRY%2FCHECK-RESTARTS%20MGL-PAX:SECTION" title="Check Restarts">Check Restarts</a>, <a href="#TRY:@TRY%2FTRIAL-RESTARTS%20MGL-PAX:SECTION" title="Trial Restarts">Trial Restarts</a> for more.</p>
<p><a id="x-28TRY-3ARECORD-EVENT-20FUNCTION-29"></a>
<a id="TRY:RECORD-EVENT%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L214">[function]</a></span> <span class="reference-object"><a href="#TRY:RECORD-EVENT%20FUNCTION" >record-event</a></span></span> <span class="locative-args">&amp;optional condition</span></span></p>

<p>This restart is always the first restart available when an <a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION"><code>event</code></a> is
signalled running under <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a> (i.e. there is a <a href="#TRY:CURRENT-TRIAL%20FUNCTION" title="TRY:CURRENT-TRIAL FUNCTION"><code>current-trial</code></a>). <code>try</code>
always invokes <code>record-event</code> when handling events.</p></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FOUTCOMES-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FOUTCOMES%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FEVENT-RESTARTS%20MGL-PAX:SECTION" title="Event Restarts">&#8592;</a> <a href="#TRY:@TRY%2FEVENTS%20MGL-PAX:SECTION" title="Events">&#8593;</a> <a href="#TRY:@TRY%2FOUTCOME-RESTARTS%20MGL-PAX:SECTION" title="Outcome Restarts">&#8594;</a> <a href="#TRY:@TRY%2FOUTCOMES%20MGL-PAX:SECTION" title="Outcomes">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/outcome.lisp#L3">&#955;</a></span></span></p>
<h3><a href="#TRY:@TRY%2FOUTCOMES%20MGL-PAX:SECTION">5.6 Outcomes</a></h3>
<p><a id="x-28TRY-3AOUTCOME-20CONDITION-29"></a>
<a id="TRY:OUTCOME%20CONDITION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/outcome.lisp#L12">[condition]</a></span> <span class="reference-object"><a href="#TRY:OUTCOME%20CONDITION" >outcome</a></span></span> <span class="locative-args"><a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION">event</a></span></span></p>

<p>An <code>outcome</code> is the resolution of either a <a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a> or a
check (see <a href="#TRY:@TRY%2FCHECKS%20MGL-PAX:SECTION" title="Checks">Checks</a>), corresponding to subclasses <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a> and
<a href="#TRY:RESULT%20CONDITION" title="TRY:RESULT CONDITION"><code>result</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3AWITH-EXPECTED-OUTCOME-20MGL-PAX-3AMACRO-29"></a>
<a id="TRY:WITH-EXPECTED-OUTCOME%20MGL-PAX:MACRO"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/outcome.lisp#L20">[macro]</a></span> <span class="reference-object"><a href="#TRY:WITH-EXPECTED-OUTCOME%20MGL-PAX:MACRO" >with-expected-outcome</a></span></span> <span class="locative-args">(expected-type) &amp;body body</span></span></p>

<p>When an <a href="#TRY:OUTCOME%20CONDITION" title="TRY:OUTCOME CONDITION"><code>outcome</code></a> is to be signalled, <code>expected-type</code> determines
whether it's going to be <a href="#TRY:EXPECTED%20CONDITION" title="TRY:EXPECTED CONDITION"><code>expected</code></a>. The concrete <code>outcome</code> classes are
<code>{expected,unexpected}-{result,verdict}-{success,failure}</code> (see
<a href="#TRY:@TRY%2FEVENTS%20MGL-PAX:SECTION" title="Events">Events</a>), of which <a href="#TRY:RESULT%20CONDITION" title="TRY:RESULT CONDITION"><code>result</code></a> or <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a> and <a href="#TRY:SUCCESS%20CONDITION" title="TRY:SUCCESS CONDITION"><code>success</code></a> or <a href="#TRY:FAILURE%20CONDITION" title="TRY:FAILURE CONDITION"><code>failure</code></a> are
already known. If a <code>result</code> <code>failure</code> is to be signalled, then the
moral equivalent of <code>(subtypep '(and result failure) expected-type)</code>
is evaluated and depending on whether it's true,
<a href="#TRY:EXPECTED-RESULT-FAILURE%20CONDITION" title="TRY:EXPECTED-RESULT-FAILURE CONDITION"><code>expected-result-failure</code></a> or <a href="#TRY:UNEXPECTED-RESULT-FAILURE%20CONDITION" title="TRY:UNEXPECTED-RESULT-FAILURE CONDITION"><code>unexpected-result-failure</code></a> is signalled.</p>

<p>By default, <code>success</code> is expected. The following example shows how to
expect both <code>success</code> and <code>failure</code> for <code>result</code>s, while requiring
<code>verdict</code>s to succeed:</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">let</span></i> <span class="paren2">(<span class="code"><span class="paren3">(<span class="code"><span class="special">*debug*</span> nil</span>)</span></span>)</span>
  <span class="paren2">(<span class="code"><i><span class="symbol">with-expected-outcome</span></i> <span class="paren3">(<span class="code">'<span class="paren4">(<span class="code">or result <span class="paren5">(<span class="code">and verdict success</span>)</span></span>)</span></span>)</span>
    <span class="paren3">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren4">(<span class="code">t1</span>)</span>
      <span class="paren4">(<span class="code">is nil</span>)</span></span>)</span></span>)</span></span>)</span>
.. T1
..   × <span class="paren1">(<span class="code">IS NIL</span>)</span>
.. ⋅ T1 ×1
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">T1</span>)</span></span>)</span> EXPECTED-SUCCESS 0.000s ×1&gt;</span></code></pre>

<p>This is equivalent to <code>(with-failure-expected () ...)</code>. To make
result failures expected but result successes unexpected:</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">let</span></i> <span class="paren2">(<span class="code"><span class="paren3">(<span class="code"><span class="special">*debug*</span> nil</span>)</span></span>)</span>
  <span class="paren2">(<span class="code"><i><span class="symbol">with-expected-outcome</span></i> <span class="paren3">(<span class="code">'<span class="paren4">(<span class="code">or <span class="paren5">(<span class="code">and result failure</span>)</span> <span class="paren5">(<span class="code">and verdict success</span>)</span></span>)</span></span>)</span>
    <span class="paren3">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren4">(<span class="code">t1</span>)</span>
      <span class="paren4">(<span class="code">is t</span>)</span>
      <span class="paren4">(<span class="code">is nil</span>)</span></span>)</span></span>)</span></span>)</span>
.. T1
..   ⊡ <span class="paren1">(<span class="code">IS T</span>)</span>
..   × <span class="paren1">(<span class="code">IS NIL</span>)</span>
.. ⋅ T1 ⊡1 ×1
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">T1</span>)</span></span>)</span> EXPECTED-SUCCESS 0.000s ⊡1 ×1&gt;</span></code></pre>

<p>This is equivalent to <code>(with-failure-expected ('failure) ...)</code>. The
final example leaves result failures unexpected but makes both
verdict successes and failures expected:</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">let</span></i> <span class="paren2">(<span class="code"><span class="paren3">(<span class="code"><span class="special">*debug*</span> nil</span>)</span></span>)</span>
  <span class="paren2">(<span class="code"><i><span class="symbol">with-expected-outcome</span></i> <span class="paren3">(<span class="code">'<span class="paren4">(<span class="code">or <span class="paren5">(<span class="code">and result success</span>)</span> verdict</span>)</span></span>)</span>
    <span class="paren3">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren4">(<span class="code">t1</span>)</span>
      <span class="paren4">(<span class="code">is nil</span>)</span></span>)</span></span>)</span></span>)</span>
.. T1
..   ⊠ <span class="paren1">(<span class="code">IS NIL</span>)</span>
.. × T1 ⊠1
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">T1</span>)</span></span>)</span> EXPECTED-FAILURE 0.004s ⊠1&gt;</span></code></pre></li>
</ul>
<p><a id="x-28TRY-3AWITH-FAILURE-EXPECTED-20MGL-PAX-3AMACRO-29"></a>
<a id="TRY:WITH-FAILURE-EXPECTED%20MGL-PAX:MACRO"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/outcome.lisp#L81">[macro]</a></span> <span class="reference-object"><a href="#TRY:WITH-FAILURE-EXPECTED%20MGL-PAX:MACRO" >with-failure-expected</a></span></span> <span class="locative-args">(&amp;optional (result-expected-type t) (verdict-expected-type ''success)) &amp;body body</span></span></p>

<p>A convenience macro on top of <a href="#TRY:WITH-EXPECTED-OUTCOME%20MGL-PAX:MACRO" title="TRY:WITH-EXPECTED-OUTCOME MGL-PAX:MACRO"><code>with-expected-outcome</code></a>,
<code>with-failure-expected</code> expects <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a>s to have <code>verdict-expected-type</code>
and <a href="#TRY:RESULT%20CONDITION" title="TRY:RESULT CONDITION"><code>result</code></a>s to have <code>result-expected-type</code>. A simple
<code>(with-failure-expected () ...)</code> makes all <code>result</code> <a href="#TRY:SUCCESS%20CONDITION" title="TRY:SUCCESS CONDITION"><code>success</code></a>es and
<a href="#TRY:FAILURE%20CONDITION" title="TRY:FAILURE CONDITION"><code>failure</code></a>s <a href="#TRY:EXPECTED%20CONDITION" title="TRY:EXPECTED CONDITION"><code>expected</code></a>. <code>(with-failure-expected ('failure) ..)</code> expects
<code>failure</code>s only, and any <code>success</code>es will be <a href="#TRY:UNEXPECTED%20CONDITION" title="TRY:UNEXPECTED CONDITION"><code>unexpected</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3AWITH-SKIP-20MGL-PAX-3AMACRO-29"></a>
<a id="TRY:WITH-SKIP%20MGL-PAX:MACRO"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/outcome.lisp#L131">[macro]</a></span> <span class="reference-object"><a href="#TRY:WITH-SKIP%20MGL-PAX:MACRO" >with-skip</a></span></span> <span class="locative-args">(&amp;optional (skip t)) &amp;body body</span></span></p>

<p><code>with-skip</code> skips checks and trials. It forces an immediate
<a href="#TRY:SKIP-TRIAL%20FUNCTION" title="TRY:SKIP-TRIAL FUNCTION"><code>skip-trial</code></a> whenever a trial is started (which turns into a
<a href="#TRY:VERDICT-SKIP%20CONDITION" title="TRY:VERDICT-SKIP CONDITION"><code>verdict-skip</code></a>) and makes checks (without intervening trials, of
course) evaluate normally but signal <a href="#TRY:RESULT-SKIP%20CONDITION" title="TRY:RESULT-SKIP CONDITION"><code>result-skip</code></a>. <code>skip</code> is <code>nil</code>
cancels the effect of any enclosing <code>with-skip</code> with <code>skip</code> true.</p></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FOUTCOME-RESTARTS-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FOUTCOME-RESTARTS%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FOUTCOMES%20MGL-PAX:SECTION" title="Outcomes">&#8592;</a> <a href="#TRY:@TRY%2FOUTCOMES%20MGL-PAX:SECTION" title="Outcomes">&#8593;</a> <a href="#TRY:@TRY%2FCHECKS%20MGL-PAX:SECTION" title="Checks">&#8594;</a> <a href="#TRY:@TRY%2FOUTCOME-RESTARTS%20MGL-PAX:SECTION" title="Outcome Restarts">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/outcome.lisp#L245">&#955;</a></span></span></p>
<h4><a href="#TRY:@TRY%2FOUTCOME-RESTARTS%20MGL-PAX:SECTION">5.6.1 Outcome Restarts</a></h4>
<p><a id="x-28TRY-3AFORCE-EXPECTED-SUCCESS-20FUNCTION-29"></a>
<a id="TRY:FORCE-EXPECTED-SUCCESS%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/outcome.lisp#L251">[function]</a></span> <span class="reference-object"><a href="#TRY:FORCE-EXPECTED-SUCCESS%20FUNCTION" >force-expected-success</a></span></span> <span class="locative-args">&amp;optional condition</span></span></p>

<p>Change the type of the <a href="#TRY:OUTCOME%20CONDITION" title="TRY:OUTCOME CONDITION"><code>outcome</code></a> being signalled to <a href="#TRY:EXPECTED%20CONDITION" title="TRY:EXPECTED CONDITION"><code>expected</code></a> and
<a href="#TRY:SUCCESS%20CONDITION" title="TRY:SUCCESS CONDITION"><code>success</code></a>. If the original condition is a <a href="#TRY:RESULT%20CONDITION" title="TRY:RESULT CONDITION"><code>result</code></a>, then this will be
<a href="#TRY:EXPECTED-RESULT-SUCCESS%20CONDITION" title="TRY:EXPECTED-RESULT-SUCCESS CONDITION"><code>expected-result-success</code></a>, if it is a <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a>, then
<a href="#TRY:EXPECTED-VERDICT-SUCCESS%20CONDITION" title="TRY:EXPECTED-VERDICT-SUCCESS CONDITION"><code>expected-verdict-success</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3AFORCE-UNEXPECTED-SUCCESS-20FUNCTION-29"></a>
<a id="TRY:FORCE-UNEXPECTED-SUCCESS%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/outcome.lisp#L259">[function]</a></span> <span class="reference-object"><a href="#TRY:FORCE-UNEXPECTED-SUCCESS%20FUNCTION" >force-unexpected-success</a></span></span> <span class="locative-args">&amp;optional condition</span></span></p>

<p>Change the type of <a href="#TRY:OUTCOME%20CONDITION" title="TRY:OUTCOME CONDITION"><code>outcome</code></a> being signalled to <a href="#TRY:UNEXPECTED%20CONDITION" title="TRY:UNEXPECTED CONDITION"><code>unexpected</code></a> and
<a href="#TRY:SUCCESS%20CONDITION" title="TRY:SUCCESS CONDITION"><code>success</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3AFORCE-EXPECTED-FAILURE-20FUNCTION-29"></a>
<a id="TRY:FORCE-EXPECTED-FAILURE%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/outcome.lisp#L265">[function]</a></span> <span class="reference-object"><a href="#TRY:FORCE-EXPECTED-FAILURE%20FUNCTION" >force-expected-failure</a></span></span> <span class="locative-args">&amp;optional condition</span></span></p>

<p>Change the type of <a href="#TRY:OUTCOME%20CONDITION" title="TRY:OUTCOME CONDITION"><code>outcome</code></a> being signalled to <a href="#TRY:EXPECTED%20CONDITION" title="TRY:EXPECTED CONDITION"><code>expected</code></a> and
<a href="#TRY:FAILURE%20CONDITION" title="TRY:FAILURE CONDITION"><code>failure</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3AFORCE-UNEXPECTED-FAILURE-20FUNCTION-29"></a>
<a id="TRY:FORCE-UNEXPECTED-FAILURE%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/outcome.lisp#L271">[function]</a></span> <span class="reference-object"><a href="#TRY:FORCE-UNEXPECTED-FAILURE%20FUNCTION" >force-unexpected-failure</a></span></span> <span class="locative-args">&amp;optional condition</span></span></p>

<p>Change the type of <a href="#TRY:OUTCOME%20CONDITION" title="TRY:OUTCOME CONDITION"><code>outcome</code></a> being signalled to <a href="#TRY:UNEXPECTED%20CONDITION" title="TRY:UNEXPECTED CONDITION"><code>unexpected</code></a> and
<a href="#TRY:FAILURE%20CONDITION" title="TRY:FAILURE CONDITION"><code>failure</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FCHECKS-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FCHECKS%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FOUTCOME-RESTARTS%20MGL-PAX:SECTION" title="Outcome Restarts">&#8592;</a> <a href="#TRY:@TRY%2FOUTCOMES%20MGL-PAX:SECTION" title="Outcomes">&#8593;</a> <a href="#TRY:@TRY%2FCHECK-RESTARTS%20MGL-PAX:SECTION" title="Check Restarts">&#8594;</a> <a href="#TRY:@TRY%2FCHECKS%20MGL-PAX:SECTION" title="Checks">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/outcome.lisp#L278">&#955;</a></span></span></p>
<h4><a href="#TRY:@TRY%2FCHECKS%20MGL-PAX:SECTION">5.6.2 Checks</a></h4>
<p>Checks are like <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_assert.htm" title="ASSERT (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>cl:assert</code></a>s, they check whether some condition holds
and signal an <a href="#TRY:OUTCOME%20CONDITION" title="TRY:OUTCOME CONDITION"><code>outcome</code></a>. The outcome signalled for checks is a
subclass of <a href="#TRY:RESULT%20CONDITION" title="TRY:RESULT CONDITION"><code>result</code></a>.</p>
<p>Take, for example, <code>(is (= x 5))</code>. Depending on whether <code>x</code> is
indeed 5, some kind of <code>result</code> <a href="#TRY:SUCCESS%20CONDITION" title="TRY:SUCCESS CONDITION"><code>success</code></a> or <a href="#TRY:FAILURE%20CONDITION" title="TRY:FAILURE CONDITION"><code>failure</code></a> will be signalled.
<a href="#TRY:WITH-EXPECTED-OUTCOME%20MGL-PAX:MACRO" title="TRY:WITH-EXPECTED-OUTCOME MGL-PAX:MACRO"><code>with-expected-outcome</code></a> determines whether it's <a href="#TRY:EXPECTED%20CONDITION" title="TRY:EXPECTED CONDITION"><code>expected</code></a> or
<a href="#TRY:UNEXPECTED%20CONDITION" title="TRY:UNEXPECTED CONDITION"><code>unexpected</code></a>, and we have one of <a href="#TRY:EXPECTED-RESULT-SUCCESS%20CONDITION" title="TRY:EXPECTED-RESULT-SUCCESS CONDITION"><code>expected-result-success</code></a>,
<a href="#TRY:UNEXPECTED-RESULT-SUCCESS%20CONDITION" title="TRY:UNEXPECTED-RESULT-SUCCESS CONDITION"><code>unexpected-result-success</code></a>, <a href="#TRY:EXPECTED-RESULT-FAILURE%20CONDITION" title="TRY:EXPECTED-RESULT-FAILURE CONDITION"><code>expected-result-failure</code></a>,
<a href="#TRY:UNEXPECTED-RESULT-FAILURE%20CONDITION" title="TRY:UNEXPECTED-RESULT-FAILURE CONDITION"><code>unexpected-result-failure</code></a> to signal. Furthermore, if <a href="#TRY:WITH-SKIP%20MGL-PAX:MACRO" title="TRY:WITH-SKIP MGL-PAX:MACRO"><code>with-skip</code></a> is in
effect, then <a href="#TRY:RESULT-SKIP%20CONDITION" title="TRY:RESULT-SKIP CONDITION"><code>result-skip</code></a> is signalled.</p>
<p>The result is signalled with <code>#'signal</code> if it is a <a href="#TRY:PASS%20TYPE" title="TRY:PASS TYPE"><code>pass</code></a>, else it's
signalled with <code>#'error</code>. This distinction matters only if the event
is not handled, which is never the case in a <a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a>. Standalone
checks though - those that are not enclosed by a trial - invoke the
debugger on <code>result</code>s which are not of type <a href="#TRY:PASS%20TYPE" title="TRY:PASS TYPE"><code>pass</code></a>.</p>
<p>The signalled <code>result</code> is not final until <a href="#TRY:RECORD-EVENT%20FUNCTION" title="TRY:RECORD-EVENT FUNCTION"><code>record-event</code></a> is invoked on
it, and it can be changed with the <a href="#TRY:@TRY%2FOUTCOME-RESTARTS%20MGL-PAX:SECTION" title="Outcome Restarts">Outcome Restarts</a> and the
<a href="#TRY:@TRY%2FCHECK-RESTARTS%20MGL-PAX:SECTION" title="Check Restarts">Check Restarts</a>.</p>
<p><a id="x-28TRY-3ARESULT-20CONDITION-29"></a>
<a id="TRY:RESULT%20CONDITION"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/result.lisp#L3">[condition]</a></span> <span class="reference-object"><a href="#TRY:RESULT%20CONDITION" >result</a></span></span> <span class="locative-args"><a href="#TRY:LEAF%20CONDITION" title="TRY:LEAF CONDITION">leaf</a> <a href="#TRY:OUTCOME%20CONDITION" title="TRY:OUTCOME CONDITION">outcome</a></span></span></li>
</ul>
<p><a id="x-28TRY-3AEXPECTED-RESULT-SUCCESS-20CONDITION-29"></a>
<a id="TRY:EXPECTED-RESULT-SUCCESS%20CONDITION"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/result.lisp#L15">[condition]</a></span> <span class="reference-object"><a href="#TRY:EXPECTED-RESULT-SUCCESS%20CONDITION" >expected-result-success</a></span></span> <span class="locative-args"><a href="#TRY:EXPECTED%20CONDITION" title="TRY:EXPECTED CONDITION">expected</a> <a href="#TRY:RESULT%20CONDITION" title="TRY:RESULT CONDITION">result</a> <a href="#TRY:SUCCESS%20CONDITION" title="TRY:SUCCESS CONDITION">success</a></span></span></li>
</ul>
<p><a id="x-28TRY-3AUNEXPECTED-RESULT-SUCCESS-20CONDITION-29"></a>
<a id="TRY:UNEXPECTED-RESULT-SUCCESS%20CONDITION"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/result.lisp#L16">[condition]</a></span> <span class="reference-object"><a href="#TRY:UNEXPECTED-RESULT-SUCCESS%20CONDITION" >unexpected-result-success</a></span></span> <span class="locative-args"><a href="#TRY:UNEXPECTED%20CONDITION" title="TRY:UNEXPECTED CONDITION">unexpected</a> <a href="#TRY:RESULT%20CONDITION" title="TRY:RESULT CONDITION">result</a> <a href="#TRY:SUCCESS%20CONDITION" title="TRY:SUCCESS CONDITION">success</a></span></span></li>
</ul>
<p><a id="x-28TRY-3AEXPECTED-RESULT-FAILURE-20CONDITION-29"></a>
<a id="TRY:EXPECTED-RESULT-FAILURE%20CONDITION"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/result.lisp#L17">[condition]</a></span> <span class="reference-object"><a href="#TRY:EXPECTED-RESULT-FAILURE%20CONDITION" >expected-result-failure</a></span></span> <span class="locative-args"><a href="#TRY:EXPECTED%20CONDITION" title="TRY:EXPECTED CONDITION">expected</a> <a href="#TRY:RESULT%20CONDITION" title="TRY:RESULT CONDITION">result</a> <a href="#TRY:FAILURE%20CONDITION" title="TRY:FAILURE CONDITION">failure</a></span></span></li>
</ul>
<p><a id="x-28TRY-3AUNEXPECTED-RESULT-FAILURE-20CONDITION-29"></a>
<a id="TRY:UNEXPECTED-RESULT-FAILURE%20CONDITION"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/result.lisp#L18">[condition]</a></span> <span class="reference-object"><a href="#TRY:UNEXPECTED-RESULT-FAILURE%20CONDITION" >unexpected-result-failure</a></span></span> <span class="locative-args"><a href="#TRY:UNEXPECTED%20CONDITION" title="TRY:UNEXPECTED CONDITION">unexpected</a> <a href="#TRY:RESULT%20CONDITION" title="TRY:RESULT CONDITION">result</a> <a href="#TRY:FAILURE%20CONDITION" title="TRY:FAILURE CONDITION">failure</a></span></span></li>
</ul>
<p><a id="x-28TRY-3ARESULT-SKIP-20CONDITION-29"></a>
<a id="TRY:RESULT-SKIP%20CONDITION"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/result.lisp#L19">[condition]</a></span> <span class="reference-object"><a href="#TRY:RESULT-SKIP%20CONDITION" >result-skip</a></span></span> <span class="locative-args"><a href="#TRY:RESULT%20CONDITION" title="TRY:RESULT CONDITION">result</a> <a href="#TRY:SKIP%20CONDITION" title="TRY:SKIP CONDITION">skip</a></span></span></li>
</ul>
<p><a id="x-28TRY-3ARESULT-ABORT-2A-20CONDITION-29"></a>
<a id="TRY:RESULT-ABORT*%20CONDITION"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/result.lisp#L20">[condition]</a></span> <span class="reference-object"><a href="#TRY:RESULT-ABORT*%20CONDITION" >result-abort*</a></span></span> <span class="locative-args"><a href="#TRY:RESULT%20CONDITION" title="TRY:RESULT CONDITION">result</a> <a href="#TRY:ABORT*%20CONDITION" title="TRY:ABORT* CONDITION">abort*</a> <a href="#TRY:DISMISSAL%20CONDITION" title="TRY:DISMISSAL CONDITION">dismissal</a></span></span></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FCHECK-RESTARTS-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FCHECK-RESTARTS%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FCHECKS%20MGL-PAX:SECTION" title="Checks">&#8592;</a> <a href="#TRY:@TRY%2FCHECKS%20MGL-PAX:SECTION" title="Checks">&#8593;</a> <a href="#TRY:@TRY%2FTRIALS%20MGL-PAX:SECTION" title="Trials">&#8594;</a> <a href="#TRY:@TRY%2FCHECK-RESTARTS%20MGL-PAX:SECTION" title="Check Restarts">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/outcome.lisp#L309">&#955;</a></span></span></p>
<h5><a href="#TRY:@TRY%2FCHECK-RESTARTS%20MGL-PAX:SECTION">Check Restarts</a></h5>
<p><a id="x-28TRY-3AABORT-CHECK-20FUNCTION-29"></a>
<a id="TRY:ABORT-CHECK%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/outcome.lisp#L314">[function]</a></span> <span class="reference-object"><a href="#TRY:ABORT-CHECK%20FUNCTION" >abort-check</a></span></span> <span class="locative-args">&amp;optional condition</span></span></p>

<p>Change the <a href="#TRY:OUTCOME%20CONDITION" title="TRY:OUTCOME CONDITION"><code>outcome</code></a> of the check being signalled to <a href="#TRY:RESULT-ABORT*%20CONDITION" title="TRY:RESULT-ABORT* CONDITION"><code>result-abort*</code></a>.
<code>result-abort*</code>, being <code>(not pass)</code>, will cause the check to return
<code>nil</code> if <a href="#TRY:RECORD-EVENT%20FUNCTION" title="TRY:RECORD-EVENT FUNCTION"><code>record-event</code></a> is invoked on it.</p></li>
</ul>
<p><a id="x-28TRY-3ASKIP-CHECK-20FUNCTION-29"></a>
<a id="TRY:SKIP-CHECK%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/outcome.lisp#L321">[function]</a></span> <span class="reference-object"><a href="#TRY:SKIP-CHECK%20FUNCTION" >skip-check</a></span></span> <span class="locative-args">&amp;optional condition</span></span></p>

<p>Change the <a href="#TRY:OUTCOME%20CONDITION" title="TRY:OUTCOME CONDITION"><code>outcome</code></a> of the check being signalled to <a href="#TRY:RESULT-SKIP%20CONDITION" title="TRY:RESULT-SKIP CONDITION"><code>result-skip</code></a>.
<code>result-skip</code>, being a <a href="#TRY:PASS%20TYPE" title="TRY:PASS TYPE"><code>pass</code></a>, will cause the check to return <code>t</code> if
<code>continue</code>(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_abortc.htm" title="CONTINUE (MGL-PAX:CLHS FUNCTION)"><code>0</code></a> <a href="http://www.lispworks.com/documentation/HyperSpec/Body/r_contin.htm" title="CONTINUE (MGL-PAX:CLHS RESTART)"><code>1</code></a>) or <a href="#TRY:RECORD-EVENT%20FUNCTION" title="TRY:RECORD-EVENT FUNCTION"><code>record-event</code></a> is invoked on it.</p></li>
</ul>
<p><a id="x-28TRY-3ARETRY-CHECK-20FUNCTION-29"></a>
<a id="TRY:RETRY-CHECK%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/outcome.lisp#L328">[function]</a></span> <span class="reference-object"><a href="#TRY:RETRY-CHECK%20FUNCTION" >retry-check</a></span></span> <span class="locative-args">&amp;optional condition</span></span></p>

<p>Initiate a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_n.htm#non-local_exit" title="&quot;non-local exit&quot; (MGL-PAX:CLHS MGL-PAX:GLOSSARY-TERM)">non-local exit</a> to go reevaluate the forms
wrapped by the check without signalling an <a href="#TRY:OUTCOME%20CONDITION" title="TRY:OUTCOME CONDITION"><code>outcome</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FTRIALS-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FTRIALS%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FCHECK-RESTARTS%20MGL-PAX:SECTION" title="Check Restarts">&#8592;</a> <a href="#TRY:@TRY%2FOUTCOMES%20MGL-PAX:SECTION" title="Outcomes">&#8593;</a> <a href="#TRY:@TRY%2FTRIAL-EVENTS%20MGL-PAX:SECTION" title="Trial Events">&#8594;</a> <a href="#TRY:@TRY%2FTRIALS%20MGL-PAX:SECTION" title="Trials">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial.lisp#L5">&#955;</a></span></span></p>
<h4><a href="#TRY:@TRY%2FTRIALS%20MGL-PAX:SECTION">5.6.3 Trials</a></h4>
<p><a id="x-28TRY-3ATRIAL-20CLASS-29"></a>
<a id="TRY:TRIAL%20CLASS"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial.lisp#L14">[class]</a></span> <span class="reference-object"><a href="#TRY:TRIAL%20CLASS" >trial</a></span></span> <span class="locative-args">sb-mop:funcallable-standard-object</span></span></p>

<p>Trials are records of calls to tests (see
<a href="#TRY:@TRY%2FCOUNT%20MGL-PAX:SECTION" title="Counting Events">Counting Events</a>, <a href="#TRY:@TRY%2FCOLLECT%20MGL-PAX:SECTION" title="Collecting Events">Collecting Events</a>). Their behaviour as <a href="#TRY:@FUNCALLABLE-INSTANCE%20MGL-PAX:GLOSSARY-TERM" title="funcallable instance">funcallable instance</a>s
is explained in <a href="#TRY:@TRY%2FRERUN%20MGL-PAX:SECTION" title="Rerunning Trials">Rerunning Trials</a>.</p>

<p>There are three ways to acquire a <code>trial</code> object: by calling
<a href="#TRY:CURRENT-TRIAL%20FUNCTION" title="TRY:CURRENT-TRIAL FUNCTION"><code>current-trial</code></a>, through the lexical binding of the symbol that names
the test or through the return value of a test:</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">deftest</span></i> xxx <span class="paren2">(<span class="code"></span>)</span>
  <span class="paren2">(<span class="code">prin1 xxx</span>)</span></span>)</span>

<span class="paren1">(<span class="code">xxx</span>)</span>
.. #&lt;TRIAL <span class="paren1">(<span class="code">XXX</span>)</span> RUNNING&gt;
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code">XXX</span>)</span> EXPECTED-SUCCESS 0.000s&gt;</span></code></pre>

<p><code>with-trial</code> can also provide access to its <code>trial</code>:</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren2">(<span class="code">t0</span>)</span>
  <span class="paren2">(<span class="code">prin1 t0</span>)</span></span>)</span>
.. #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">T0</span>)</span></span>)</span> RUNNING&gt;
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">T0</span>)</span></span>)</span> EXPECTED-SUCCESS 0.000s&gt;</span></code></pre>

<p><code>trial</code>s are not to be instantiated by client code.</p></li>
</ul>
<p><a id="x-28TRY-3ACURRENT-TRIAL-20FUNCTION-29"></a>
<a id="TRY:CURRENT-TRIAL%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial.lisp#L168">[function]</a></span> <span class="reference-object"><a href="#TRY:CURRENT-TRIAL%20FUNCTION" >current-trial</a></span></span></span></p>

<p><a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a>s, like the calls to tests they stand for, nest. <code>current-trial</code>
returns the innermost trial. If there is no currently running test,
then an error is signalled. The returned trial is <a href="#TRY:RUNNINGP%20FUNCTION" title="TRY:RUNNINGP FUNCTION"><code>runningp</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FTRIAL-EVENTS-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FTRIAL-EVENTS%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FTRIALS%20MGL-PAX:SECTION" title="Trials">&#8592;</a> <a href="#TRY:@TRY%2FTRIALS%20MGL-PAX:SECTION" title="Trials">&#8593;</a> <a href="#TRY:@TRY%2FTRIAL-VERDICTS%20MGL-PAX:SECTION" title="Trial Verdicts">&#8594;</a> <a href="#TRY:@TRY%2FTRIAL-EVENTS%20MGL-PAX:SECTION" title="Trial Events">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial-event.lisp#L5">&#955;</a></span></span></p>
<h5><a href="#TRY:@TRY%2FTRIAL-EVENTS%20MGL-PAX:SECTION">Trial Events</a></h5>
<p><a id="x-28TRY-3ATRIAL-EVENT-20CONDITION-29"></a>
<a id="TRY:TRIAL-EVENT%20CONDITION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial-event.lisp#L17">[condition]</a></span> <span class="reference-object"><a href="#TRY:TRIAL-EVENT%20CONDITION" >trial-event</a></span></span> <span class="locative-args"><a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION">event</a></span></span></p>

<p>A <code>trial-event</code> is either a <a href="#TRY:TRIAL-START%20CONDITION" title="TRY:TRIAL-START CONDITION"><code>trial-start</code></a> or a
<a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3ATRIAL-20-28MGL-PAX-3AREADER-20TRY-3ATRIAL-EVENT-29-29"></a>
<a id="TRY:TRIAL%20%28MGL-PAX:READER%20TRY:TRIAL-EVENT%29"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial-event.lisp#L17">[reader]</a></span> <span class="reference-object"><a href="#TRY:TRIAL%20%28MGL-PAX:READER%20TRY:TRIAL-EVENT%29" >trial</a></span></span> <span class="locative-args">trial-event (:trial)</span></span></li>
</ul>
<p><a id="x-28TRY-3ATRIAL-START-20CONDITION-29"></a>
<a id="TRY:TRIAL-START%20CONDITION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial-event.lisp#L24">[condition]</a></span> <span class="reference-object"><a href="#TRY:TRIAL-START%20CONDITION" >trial-start</a></span></span> <span class="locative-args"><a href="#TRY:TRIAL-EVENT%20CONDITION" title="TRY:TRIAL-EVENT CONDITION">trial-event</a></span></span></p>

<p><code>trial-start</code> is signalled when a test function
(see <a href="#TRY:@TRY%2FTESTS%20MGL-PAX:SECTION" title="Tests">Tests</a>) is entered and a <a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a> is started, it is already
the <a href="#TRY:CURRENT-TRIAL%20FUNCTION" title="TRY:CURRENT-TRIAL FUNCTION"><code>current-trial</code></a>, and the <a href="#TRY:@TRY%2FTRIAL-RESTARTS%20MGL-PAX:SECTION" title="Trial Restarts">Trial Restarts</a> are available. It is
also signalled when a trial is retried:</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">let</span></i> <span class="paren2">(<span class="code"><span class="paren3">(<span class="code"><span class="special">*print*</span> nil</span>)</span>
      <span class="paren3">(<span class="code">n 0</span>)</span></span>)</span>
  <span class="paren2">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren3">(<span class="code"></span>)</span>
    <span class="paren3">(<span class="code">handler-bind <span class="paren4">(<span class="code"><span class="paren5">(<span class="code">trial-start <span class="paren6">(<span class="code"><i><span class="symbol">lambda</span></i> <span class="paren1">(<span class="code">c</span>)</span>
                                  <span class="paren1">(<span class="code">format t <span class="string">"TRIAL-START for ~S retry#~S~%"</span>
                                          <span class="paren2">(<span class="code">test-name <span class="paren3">(<span class="code">trial c</span>)</span></span>)</span>
                                          <span class="paren2">(<span class="code">n-retries <span class="paren3">(<span class="code">trial c</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span>
      <span class="paren4">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren5">(<span class="code">this</span>)</span>
        <span class="paren5">(<span class="code">incf n</span>)</span>
        <span class="paren5">(<span class="code">when <span class="paren6">(<span class="code">&lt; n 3</span>)</span>
          <span class="paren6">(<span class="code">retry-trial</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span>
.. TRIAL-START for THIS retry#0
.. TRIAL-START for THIS retry#1
.. TRIAL-START for THIS retry#2
..</span></code></pre>

<p>The matching of <code>trial-start</code> events is less straightforward than that
of other <a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION"><code>event</code></a>s.</p>

<ul>
<li><p>When a <code>trial-start</code> event matches the <code>collect</code> type (see
  <a href="#TRY:@TRY%2FCOLLECT%20MGL-PAX:SECTION" title="Collecting Events">Collecting Events</a>), its <a href="#TRY:TRIAL%20%28MGL-PAX:READER%20TRY:TRIAL-EVENT%29" title="TRY:TRIAL (MGL-PAX:READER TRY:TRIAL-EVENT)"><code>trial</code></a> is collected.</p></li>
<li><p>Similarly, when a <code>trial-start</code> matches the <code>print</code>
  type (see <a href="#TRY:@TRY%2FPRINT%20MGL-PAX:SECTION" title="Printing Events">Printing Events</a>), it is printed immediately, and its trial's
  <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a> will be printed too regardless of whether it matches
  <code>print</code>. If <code>trial-start</code> does not match
  <code>print</code>, it may still be printed if for example
  <a href="#TRY:*PRINT-PARENT*%20VARIABLE" title="TRY:*PRINT-PARENT* VARIABLE"><code>*print-parent*</code></a> requires it.</p></li>
<li><p>When a <code>trial-start</code> matches the <code>rerun</code> type (see <a href="#TRY:@TRY%2FRERUN%20MGL-PAX:SECTION" title="Rerunning Trials">Rerunning Trials</a>), its
  <a href="#TRY:TRIAL%20%28MGL-PAX:READER%20TRY:TRIAL-EVENT%29" title="TRY:TRIAL (MGL-PAX:READER TRY:TRIAL-EVENT)"><code>trial</code></a> may be rerun.</p></li>
<li><p>Also, see <a href="#TRY:WITH-SKIP%20MGL-PAX:MACRO" title="TRY:WITH-SKIP MGL-PAX:MACRO"><code>with-skip</code></a>.</p></li>
</ul></li>
</ul>
<p><a id="x-28TRY-3AVERDICT-20CONDITION-29"></a>
<a id="TRY:VERDICT%20CONDITION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial-event.lisp#L71">[condition]</a></span> <span class="reference-object"><a href="#TRY:VERDICT%20CONDITION" >verdict</a></span></span> <span class="locative-args"><a href="#TRY:TRIAL-EVENT%20CONDITION" title="TRY:TRIAL-EVENT CONDITION">trial-event</a> <a href="#TRY:OUTCOME%20CONDITION" title="TRY:OUTCOME CONDITION">outcome</a></span></span></p>

<p>A <code>verdict</code> is the <a href="#TRY:OUTCOME%20CONDITION" title="TRY:OUTCOME CONDITION"><code>outcome</code></a> of a <a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a>. It is one of
<code>{expected,unexpected}-verdict-{success,failure}</code>, <a href="#TRY:VERDICT-SKIP%20CONDITION" title="TRY:VERDICT-SKIP CONDITION"><code>verdict-skip</code></a> and
<a href="#TRY:VERDICT-ABORT*%20CONDITION" title="TRY:VERDICT-ABORT* CONDITION"><code>verdict-abort*</code></a>. Regarding how the verdict type is determined, see
<a href="#TRY:@TRY%2FTRIAL-VERDICTS%20MGL-PAX:SECTION" title="Trial Verdicts">Trial Verdicts</a>.</p>

<p>Verdicts are signalled while their <a href="#TRY:TRIAL%20%28MGL-PAX:READER%20TRY:TRIAL-EVENT%29" title="TRY:TRIAL (MGL-PAX:READER TRY:TRIAL-EVENT)"><code>trial</code></a> is
still the <a href="#TRY:CURRENT-TRIAL%20FUNCTION" title="TRY:CURRENT-TRIAL FUNCTION"><code>current-trial</code></a>, and <a href="#TRY:@TRY%2FTRIAL-RESTARTS%20MGL-PAX:SECTION" title="Trial Restarts">Trial Restarts</a> are still
available.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code">try <span class="paren2">(<span class="code"><i><span class="symbol">lambda</span></i> <span class="paren3">(<span class="code"></span>)</span>
       <span class="paren3">(<span class="code">handler-bind <span class="paren4">(<span class="code"><span class="paren5">(<span class="code"><span class="paren6">(<span class="code">and verdict failure</span>)</span> #'retry-trial</span>)</span></span>)</span>
         <span class="paren4">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren5">(<span class="code">this</span>)</span>
           <span class="paren5">(<span class="code">is <span class="paren6">(<span class="code">zerop <span class="paren1">(<span class="code">random 2</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span>
.. <span class="paren1">(<span class="code">TRY #&lt;<i><span class="symbol">FUNCTION</span></i> <span class="paren2">(<span class="code"><i><span class="symbol">LAMBDA</span></i> <span class="paren3">(<span class="code"></span>)</span></span>)</span> {53038ADB}&gt;</span>)</span>
..   THIS
..     ⊠ <span class="paren1">(<span class="code">IS <span class="paren2">(<span class="code">ZEROP #1=<span class="paren3">(<span class="code">RANDOM 2</span>)</span></span>)</span></span>)</span>
..       where
..         #1# = 1
..   THIS retry #1
..     ⋅ <span class="paren1">(<span class="code">IS <span class="paren2">(<span class="code">ZEROP <span class="paren3">(<span class="code">RANDOM 2</span>)</span></span>)</span></span>)</span>
..   ⋅ THIS ⋅1
.. ⋅ <span class="paren1">(<span class="code">TRY #&lt;<i><span class="symbol">FUNCTION</span></i> <span class="paren2">(<span class="code"><i><span class="symbol">LAMBDA</span></i> <span class="paren3">(<span class="code"></span>)</span></span>)</span> {53038ADB}&gt;</span>)</span> ⋅1
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code">TRY #&lt;<i><span class="symbol">FUNCTION</span></i> <span class="paren2">(<span class="code"><i><span class="symbol">LAMBDA</span></i> <span class="paren3">(<span class="code"></span>)</span></span>)</span> {53038ADB}&gt;</span>)</span> EXPECTED-SUCCESS 0.000s ⋅1&gt;</span></code></pre></li>
</ul>
<p><a id="x-28TRY-3AEXPECTED-VERDICT-SUCCESS-20CONDITION-29"></a>
<a id="TRY:EXPECTED-VERDICT-SUCCESS%20CONDITION"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial-event.lisp#L114">[condition]</a></span> <span class="reference-object"><a href="#TRY:EXPECTED-VERDICT-SUCCESS%20CONDITION" >expected-verdict-success</a></span></span> <span class="locative-args"><a href="#TRY:EXPECTED%20CONDITION" title="TRY:EXPECTED CONDITION">expected</a> <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION">verdict</a> <a href="#TRY:SUCCESS%20CONDITION" title="TRY:SUCCESS CONDITION">success</a></span></span></li>
</ul>
<p><a id="x-28TRY-3AUNEXPECTED-VERDICT-SUCCESS-20CONDITION-29"></a>
<a id="TRY:UNEXPECTED-VERDICT-SUCCESS%20CONDITION"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial-event.lisp#L115">[condition]</a></span> <span class="reference-object"><a href="#TRY:UNEXPECTED-VERDICT-SUCCESS%20CONDITION" >unexpected-verdict-success</a></span></span> <span class="locative-args"><a href="#TRY:UNEXPECTED%20CONDITION" title="TRY:UNEXPECTED CONDITION">unexpected</a> <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION">verdict</a> <a href="#TRY:SUCCESS%20CONDITION" title="TRY:SUCCESS CONDITION">success</a></span></span></li>
</ul>
<p><a id="x-28TRY-3AEXPECTED-VERDICT-FAILURE-20CONDITION-29"></a>
<a id="TRY:EXPECTED-VERDICT-FAILURE%20CONDITION"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial-event.lisp#L116">[condition]</a></span> <span class="reference-object"><a href="#TRY:EXPECTED-VERDICT-FAILURE%20CONDITION" >expected-verdict-failure</a></span></span> <span class="locative-args"><a href="#TRY:EXPECTED%20CONDITION" title="TRY:EXPECTED CONDITION">expected</a> <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION">verdict</a> <a href="#TRY:FAILURE%20CONDITION" title="TRY:FAILURE CONDITION">failure</a></span></span></li>
</ul>
<p><a id="x-28TRY-3AUNEXPECTED-VERDICT-FAILURE-20CONDITION-29"></a>
<a id="TRY:UNEXPECTED-VERDICT-FAILURE%20CONDITION"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial-event.lisp#L117">[condition]</a></span> <span class="reference-object"><a href="#TRY:UNEXPECTED-VERDICT-FAILURE%20CONDITION" >unexpected-verdict-failure</a></span></span> <span class="locative-args"><a href="#TRY:UNEXPECTED%20CONDITION" title="TRY:UNEXPECTED CONDITION">unexpected</a> <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION">verdict</a> <a href="#TRY:FAILURE%20CONDITION" title="TRY:FAILURE CONDITION">failure</a></span></span></li>
</ul>
<p><a id="x-28TRY-3AVERDICT-SKIP-20CONDITION-29"></a>
<a id="TRY:VERDICT-SKIP%20CONDITION"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial-event.lisp#L118">[condition]</a></span> <span class="reference-object"><a href="#TRY:VERDICT-SKIP%20CONDITION" >verdict-skip</a></span></span> <span class="locative-args"><a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION">verdict</a> <a href="#TRY:SKIP%20CONDITION" title="TRY:SKIP CONDITION">skip</a></span></span></li>
</ul>
<p><a id="x-28TRY-3AVERDICT-ABORT-2A-20CONDITION-29"></a>
<a id="TRY:VERDICT-ABORT*%20CONDITION"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial-event.lisp#L119">[condition]</a></span> <span class="reference-object"><a href="#TRY:VERDICT-ABORT*%20CONDITION" >verdict-abort*</a></span></span> <span class="locative-args"><a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION">verdict</a> <a href="#TRY:ABORT*%20CONDITION" title="TRY:ABORT* CONDITION">abort*</a> <a href="#TRY:DISMISSAL%20CONDITION" title="TRY:DISMISSAL CONDITION">dismissal</a></span></span></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FTRIAL-VERDICTS-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FTRIAL-VERDICTS%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FTRIAL-EVENTS%20MGL-PAX:SECTION" title="Trial Events">&#8592;</a> <a href="#TRY:@TRY%2FTRIALS%20MGL-PAX:SECTION" title="Trials">&#8593;</a> <a href="#TRY:@TRY%2FTRIAL-RESTARTS%20MGL-PAX:SECTION" title="Trial Restarts">&#8594;</a> <a href="#TRY:@TRY%2FTRIAL-VERDICTS%20MGL-PAX:SECTION" title="Trial Verdicts">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial.lisp#L195">&#955;</a></span></span></p>
<h5><a href="#TRY:@TRY%2FTRIAL-VERDICTS%20MGL-PAX:SECTION">Trial Verdicts</a></h5>
<p>When a trial finished, a <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a> is signalled. The verdict's type
is determined as follows.</p>
<ul>
<li><p>It is a <a href="#TRY:VERDICT-SKIP%20CONDITION" title="TRY:VERDICT-SKIP CONDITION"><code>verdict-skip</code></a> if</p>

<ul>
<li><p><a href="#TRY:SKIP-TRIAL%20FUNCTION" title="TRY:SKIP-TRIAL FUNCTION"><code>skip-trial</code></a> was called on the trial, or</p></li>
<li><p><a href="#TRY:ABORT-TRIAL%20FUNCTION" title="TRY:ABORT-TRIAL FUNCTION"><code>abort-trial</code></a>, <code>skip-trial</code>, or <a href="#TRY:RETRY-TRIAL%20FUNCTION" title="TRY:RETRY-TRIAL FUNCTION"><code>retry-trial</code></a> was called on an
  enclosing trial, and</p></li>
<li><p>these were not overruled by a later <code>abort-trial</code> or <code>retry-trial</code>
  on the trial.</p></li>
</ul></li>
<li><p>It is a <a href="#TRY:VERDICT-ABORT*%20CONDITION" title="TRY:VERDICT-ABORT* CONDITION"><code>verdict-abort*</code></a> if <code>abort-trial</code> was called on the trial, and
  it wasn't overruled by a later <code>skip-trial</code> or <code>retry-trial</code>.</p></li>
<li><p>If all children (including those not collected in <a href="#TRY:CHILDREN%20%28MGL-PAX:READER%20TRY:TRIAL%29" title="TRY:CHILDREN (MGL-PAX:READER TRY:TRIAL)"><code>children</code></a>) of the
  trial <a href="#TRY:PASS%20TYPE" title="TRY:PASS TYPE"><code>pass</code></a>, then the verdict will be a <a href="#TRY:SUCCESS%20CONDITION" title="TRY:SUCCESS CONDITION"><code>success</code></a>, else it will be a
  <a href="#TRY:FAILURE%20CONDITION" title="TRY:FAILURE CONDITION"><code>failure</code></a>.</p></li>
<li><p>Subject to the <a href="#TRY:WITH-EXPECTED-OUTCOME%20MGL-PAX:MACRO" title="TRY:WITH-EXPECTED-OUTCOME MGL-PAX:MACRO"><code>with-expected-outcome</code></a> in effect,
  <code>{expected,unexpected}-verdict-{success,failure}</code> is the type of
  the verdict which will be signalled.</p></li>
</ul>
<p>The verdict of this type is signalled, but its type can be changed
by the <a href="#TRY:@TRY%2FOUTCOME-RESTARTS%20MGL-PAX:SECTION" title="Outcome Restarts">Outcome Restarts</a> or the <a href="#TRY:@TRY%2FTRIAL-RESTARTS%20MGL-PAX:SECTION" title="Trial Restarts">Trial Restarts</a> before
<a href="#TRY:RECORD-EVENT%20FUNCTION" title="TRY:RECORD-EVENT FUNCTION"><code>record-event</code></a> is invoked on it.</p>
<p><a id="x-28TRY-3AVERDICT-20-28MGL-PAX-3AREADER-20TRY-3ATRIAL-29-29"></a>
<a id="TRY:VERDICT%20%28MGL-PAX:READER%20TRY:TRIAL%29"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial.lisp#L76">[reader]</a></span> <span class="reference-object"><a href="#TRY:VERDICT%20%28MGL-PAX:READER%20TRY:TRIAL%29" >verdict</a></span></span> <span class="locative-args">trial (= nil)</span></span></p>

<p>The <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a> <a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION"><code>event</code></a> signalled when this
<code>trial</code> finished or <code>nil</code> if it has not finished yet.</p></li>
</ul>
<p><a id="x-28TRY-3ARUNNINGP-20FUNCTION-29"></a>
<a id="TRY:RUNNINGP%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial.lisp#L226">[function]</a></span> <span class="reference-object"><a href="#TRY:RUNNINGP%20FUNCTION" >runningp</a></span></span> <span class="locative-args">trial</span></span></p>

<p>See if the function call associated with <code>trial</code> has not returned yet.
Trials that are not running have a <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a> and are said to be
finished.</p></li>
</ul>
<p><a id="x-28TRY-3APASSEDP-20FUNCTION-29"></a>
<a id="TRY:PASSEDP%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial.lisp#L232">[function]</a></span> <span class="reference-object"><a href="#TRY:PASSEDP%20FUNCTION" >passedp</a></span></span> <span class="locative-args">trial</span></span></p>

<p>See if <code>trial</code> has finished and its <a href="#TRY:VERDICT%20%28MGL-PAX:READER%20TRY:TRIAL%29" title="TRY:VERDICT (MGL-PAX:READER TRY:TRIAL)"><code>verdict</code></a> is a
<a href="#TRY:PASS%20TYPE" title="TRY:PASS TYPE"><code>pass</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3AFAILEDP-20FUNCTION-29"></a>
<a id="TRY:FAILEDP%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial.lisp#L237">[function]</a></span> <span class="reference-object"><a href="#TRY:FAILEDP%20FUNCTION" >failedp</a></span></span> <span class="locative-args">trial</span></span></p>

<p>See if <code>trial</code> has finished and its <a href="#TRY:VERDICT%20%28MGL-PAX:READER%20TRY:TRIAL%29" title="TRY:VERDICT (MGL-PAX:READER TRY:TRIAL)"><code>verdict</code></a> is a
<a href="#TRY:FAIL%20TYPE" title="TRY:FAIL TYPE"><code>fail</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FTRIAL-RESTARTS-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FTRIAL-RESTARTS%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FTRIAL-VERDICTS%20MGL-PAX:SECTION" title="Trial Verdicts">&#8592;</a> <a href="#TRY:@TRY%2FTRIALS%20MGL-PAX:SECTION" title="Trials">&#8593;</a> <a href="#TRY:@TRY%2FERRORS%20MGL-PAX:SECTION" title="Errors">&#8594;</a> <a href="#TRY:@TRY%2FTRIAL-RESTARTS%20MGL-PAX:SECTION" title="Trial Restarts">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial.lisp#L304">&#955;</a></span></span></p>
<h5><a href="#TRY:@TRY%2FTRIAL-RESTARTS%20MGL-PAX:SECTION">Trial Restarts</a></h5>
<p>There are three restarts available for manipulating running
trials: <a href="#TRY:ABORT-TRIAL%20FUNCTION" title="TRY:ABORT-TRIAL FUNCTION"><code>abort-trial</code></a>, <a href="#TRY:SKIP-TRIAL%20FUNCTION" title="TRY:SKIP-TRIAL FUNCTION"><code>skip-trial</code></a>, and <a href="#TRY:RETRY-TRIAL%20FUNCTION" title="TRY:RETRY-TRIAL FUNCTION"><code>retry-trial</code></a>. They may be
invoked programatically or from the debugger. <code>abort-trial</code> is also
invoked by <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a> when encountering <a href="#TRY:UNHANDLED-ERROR%20CONDITION" title="TRY:UNHANDLED-ERROR CONDITION"><code>unhandled-error</code></a>.</p>
<p>The functions below invoke one of these restarts associated with a
<a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a>. It is an error to call them on trials that are not <a href="#TRY:RUNNINGP%20FUNCTION" title="TRY:RUNNINGP FUNCTION"><code>runningp</code></a>,
but they may be called on trials other than the <a href="#TRY:CURRENT-TRIAL%20FUNCTION" title="TRY:CURRENT-TRIAL FUNCTION"><code>current-trial</code></a>. In
that case, any intervening trials are skipped.</p>
<pre><code><span class="code"><span class="comment">;; Skipped trials are marked with '-' in the output.
</span><span class="paren1">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren2">(<span class="code">outer</span>)</span>
  <span class="paren2">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren3">(<span class="code">inner</span>)</span>
    <span class="paren3">(<span class="code">is t</span>)</span>
    <span class="paren3">(<span class="code">skip-trial nil outer</span>)</span></span>)</span></span>)</span>
.. OUTER
..   INNER
..     ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
..   - INNER ⋅1
.. - OUTER ⋅1
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">OUTER</span>)</span></span>)</span> SKIP 0.000s ⋅1&gt;</span></code></pre>
<p>Furthermore, all three restarts initiate a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_n.htm#non-local_exit" title="&quot;non-local exit&quot; (MGL-PAX:CLHS MGL-PAX:GLOSSARY-TERM)">non-local exit</a> to
return from the trial. If during the unwinding of the stack, the
non-local-exit is cancelled (see <a href="#TRY:@CANCELLED-NLX%20MGL-PAX:GLOSSARY-TERM" title="cancelled non-local exit">cancelled non-local exit</a>), the appropriate
restart will be invoked upon returning from the trial. In the
following example, the non-local exit from a skip is cancelled by a
<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_throw.htm" title="THROW (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>throw</code></a>.</p>
<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren2">(<span class="code">some-test</span>)</span>
  <span class="paren2">(<span class="code"><i><span class="symbol">catch</span></i> 'foo
    <span class="paren3">(<span class="code"><i><span class="symbol">unwind-protect</span></i>
         <span class="paren4">(<span class="code">skip-trial</span>)</span>
      <span class="paren4">(<span class="code"><i><span class="symbol">throw</span></i> 'foo nil</span>)</span></span>)</span></span>)</span>
  <span class="paren2">(<span class="code">is t <span class="keyword">:msg</span> <span class="string">"check after skip"</span></span>)</span></span>)</span>
.. SOME-TEST
..   ⋅ check after skip
.. - SOME-TEST ⋅1
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">SOME-TEST</span>)</span></span>)</span> SKIP 0.000s ⋅1&gt;</span></code></pre>
<p>In the next example, the non-local exit from a skip is cancelled by
an <code>error</code>(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/e_error.htm" title="ERROR (MGL-PAX:CLHS CONDITION)"><code>0</code></a> <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_error.htm" title="ERROR (MGL-PAX:CLHS FUNCTION)"><code>1</code></a>), which triggers an <code>abort-trial</code>.</p>
<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">let</span></i> <span class="paren2">(<span class="code"><span class="paren3">(<span class="code"><span class="special">*debug*</span> nil</span>)</span>
      <span class="paren3">(<span class="code"><span class="special">*describe*</span> nil</span>)</span></span>)</span>
  <span class="paren2">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren3">(<span class="code">foo</span>)</span>
    <span class="paren3">(<span class="code"><i><span class="symbol">unwind-protect</span></i>
         <span class="paren4">(<span class="code">skip-trial</span>)</span>
      <span class="paren4">(<span class="code">error <span class="string">"xxx"</span></span>)</span></span>)</span></span>)</span></span>)</span>
.. FOO
..   ⊟ "xxx" <span class="paren1">(<span class="code">SIMPLE-ERROR</span>)</span>
.. ⊟ FOO ⊟1
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">FOO</span>)</span></span>)</span> ABORT* 0.000s ⊟1&gt;</span></code></pre>
<p>All three restarts may be invoked on any <a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION"><code>event</code></a>, including the
trial's own <a href="#TRY:TRIAL-START%20CONDITION" title="TRY:TRIAL-START CONDITION"><code>trial-start</code></a> and <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a>. If their <code>condition</code>
argument is an <code>event</code> (<code>retry-trial</code> has a special case here), they
also record it (as in <a href="#TRY:RECORD-EVENT%20FUNCTION" title="TRY:RECORD-EVENT FUNCTION"><code>record-event</code></a>) to ensure that when they handle
an <code>event</code> in the debugger or programatically that event is not
dropped.</p>
<p><a id="x-28TRY-3AABORT-TRIAL-20FUNCTION-29"></a>
<a id="TRY:ABORT-TRIAL%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial.lisp#L380">[function]</a></span> <span class="reference-object"><a href="#TRY:ABORT-TRIAL%20FUNCTION" >abort-trial</a></span></span> <span class="locative-args">&amp;optional condition (trial (current-trial))</span></span></p>

<p>Invoke the <code>abort-trial</code> restart of a <a href="#TRY:RUNNINGP%20FUNCTION" title="TRY:RUNNINGP FUNCTION"><code>runningp</code></a> <code>trial</code>.</p>

<p>When <code>condition</code> is a <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a> for <code>trial</code>, <code>abort-trial</code> signals a new
verdict of type <a href="#TRY:VERDICT-ABORT*%20CONDITION" title="TRY:VERDICT-ABORT* CONDITION"><code>verdict-abort*</code></a>. This behavior is similar to that
of <a href="#TRY:ABORT-CHECK%20FUNCTION" title="TRY:ABORT-CHECK FUNCTION"><code>abort-check</code></a>. Else, the <code>abort-trial</code> restart may record <code>condition</code>,
then it initiates a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_n.htm#non-local_exit" title="&quot;non-local exit&quot; (MGL-PAX:CLHS MGL-PAX:GLOSSARY-TERM)">non-local exit</a> to return from the test
function with <code>verdict-abort*</code>. If during the unwinding <a href="#TRY:SKIP-TRIAL%20FUNCTION" title="TRY:SKIP-TRIAL FUNCTION"><code>skip-trial</code></a>
or <a href="#TRY:RETRY-TRIAL%20FUNCTION" title="TRY:RETRY-TRIAL FUNCTION"><code>retry-trial</code></a> is called, then the abort is cancelled.</p>

<p>Since <a href="#TRY:ABORT*%20CONDITION" title="TRY:ABORT* CONDITION"><code>abort*</code></a> is an <a href="#TRY:UNEXPECTED%20CONDITION" title="TRY:UNEXPECTED CONDITION"><code>unexpected</code></a> <a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION"><code>event</code></a>, <code>abort-trial</code> is rarely used
programatically. Signalling any error in a trial that's not caught
before the trial's handler catches it will get turned into an
<a href="#TRY:UNHANDLED-ERROR%20CONDITION" title="TRY:UNHANDLED-ERROR CONDITION"><code>unhandled-error</code></a>, and <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a> will invoke <code>abort-trial</code> with it. Thus,
instead of invoking <code>abort-trial</code> directly, signalling an error will
often suffice.</p></li>
</ul>
<p><a id="x-28TRY-3ASKIP-TRIAL-20FUNCTION-29"></a>
<a id="TRY:SKIP-TRIAL%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial.lisp#L400">[function]</a></span> <span class="reference-object"><a href="#TRY:SKIP-TRIAL%20FUNCTION" >skip-trial</a></span></span> <span class="locative-args">&amp;optional condition (trial (current-trial))</span></span></p>

<p>Invoke the <code>skip-trial</code> restart of a <a href="#TRY:RUNNINGP%20FUNCTION" title="TRY:RUNNINGP FUNCTION"><code>runningp</code></a> <code>trial</code>.</p>

<p>When <code>condition</code> is a <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a> for <code>trial</code>, <code>skip-trial</code> signals a new
verdict of type <a href="#TRY:VERDICT-SKIP%20CONDITION" title="TRY:VERDICT-SKIP CONDITION"><code>verdict-skip</code></a>. This behavior is similar to that of
<a href="#TRY:SKIP-CHECK%20FUNCTION" title="TRY:SKIP-CHECK FUNCTION"><code>skip-check</code></a>. Else, the <code>skip-trial</code> restart may record <code>condition</code>, then
it initiates a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_n.htm#non-local_exit" title="&quot;non-local exit&quot; (MGL-PAX:CLHS MGL-PAX:GLOSSARY-TERM)">non-local exit</a> to return from the test function with
<code>verdict-skip</code>. If during the unwinding <a href="#TRY:ABORT-TRIAL%20FUNCTION" title="TRY:ABORT-TRIAL FUNCTION"><code>abort-trial</code></a> or <a href="#TRY:RETRY-TRIAL%20FUNCTION" title="TRY:RETRY-TRIAL FUNCTION"><code>retry-trial</code></a> is
called, then the skip is cancelled.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren2">(<span class="code">skipped</span>)</span>
  <span class="paren2">(<span class="code">handler-bind <span class="paren3">(<span class="code"><span class="paren4">(<span class="code">unexpected-result-failure #'skip-trial</span>)</span></span>)</span>
    <span class="paren3">(<span class="code">is nil</span>)</span></span>)</span></span>)</span>
.. SKIPPED
..   ⊠ <span class="paren1">(<span class="code">IS NIL</span>)</span>
.. - SKIPPED ⊠1
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">SKIPPED</span>)</span></span>)</span> SKIP 0.000s ⊠1&gt;</span></code></pre>

<p>Invoking <code>skip-trial</code> on the <code>trial</code>'s own <a href="#TRY:TRIAL-START%20CONDITION" title="TRY:TRIAL-START CONDITION"><code>trial-start</code></a> skips the trial
being started.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">let</span></i> <span class="paren2">(<span class="code"><span class="paren3">(<span class="code"><span class="special">*print*</span> '<span class="paren4">(<span class="code">or outcome leaf</span>)</span></span>)</span></span>)</span>
  <span class="paren2">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren3">(<span class="code">parent</span>)</span>
    <span class="paren3">(<span class="code">handler-bind <span class="paren4">(<span class="code"><span class="paren5">(<span class="code">trial-start #'skip-trial</span>)</span></span>)</span>
      <span class="paren4">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren5">(<span class="code">child</span>)</span>
        <span class="paren5">(<span class="code">is nil</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span>
.. PARENT
..   - CHILD
.. ⋅ PARENT
..</span></code></pre></li>
</ul>
<p><a id="x-28TRY-3ARETRY-TRIAL-20FUNCTION-29"></a>
<a id="TRY:RETRY-TRIAL%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial.lisp#L440">[function]</a></span> <span class="reference-object"><a href="#TRY:RETRY-TRIAL%20FUNCTION" >retry-trial</a></span></span> <span class="locative-args">&amp;optional condition (trial (current-trial))</span></span></p>

<p>Invoke the <code>retry-trial</code> restart of <a href="#TRY:RUNNINGP%20FUNCTION" title="TRY:RUNNINGP FUNCTION"><code>runningp</code></a> <code>trial</code>. The <code>retry-trial</code>
restart may record <code>condition</code>, then it initiates a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_n.htm#non-local_exit" title="&quot;non-local exit&quot; (MGL-PAX:CLHS MGL-PAX:GLOSSARY-TERM)">non-local
exit</a> to go back to the beginning of the test function. If the
non-local exit completes, then</p>

<ul>
<li><p>(<a href="#TRY:N-RETRIES%20%28MGL-PAX:READER%20TRY:TRIAL%29" title="TRY:N-RETRIES (MGL-PAX:READER TRY:TRIAL)"><code>n-retries</code></a> <code>trial</code>) is incremented,</p></li>
<li><p>collected results and trials are cleared (see <a href="#TRY:@TRY%2FCOLLECT%20MGL-PAX:SECTION" title="Collecting Events">Collecting Events</a>),</p></li>
<li><p>counts are zeroed (see <a href="#TRY:@TRY%2FCOUNT%20MGL-PAX:SECTION" title="Counting Events">Counting Events</a>), and</p></li>
<li><p><a href="#TRY:TRIAL-START%20CONDITION" title="TRY:TRIAL-START CONDITION"><code>trial-start</code></a> is signalled again.</p></li>
</ul>

<p>If during the unwinding <a href="#TRY:ABORT-TRIAL%20FUNCTION" title="TRY:ABORT-TRIAL FUNCTION"><code>abort-trial</code></a> or <a href="#TRY:SKIP-TRIAL%20FUNCTION" title="TRY:SKIP-TRIAL FUNCTION"><code>skip-trial</code></a> is called, then
the retry is cancelled.</p>

<p><code>condition</code> (which may be <code>nil</code>) is recorded if it is an <a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION"><code>event</code></a> but not
the <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a> of <code>trial</code>, and the <a href="#TRY:RECORD-EVENT%20FUNCTION" title="TRY:RECORD-EVENT FUNCTION"><code>record-event</code></a> restart is available.</p></li>
</ul>
<p><a id="x-28TRY-3AN-RETRIES-20-28MGL-PAX-3AREADER-20TRY-3ATRIAL-29-29"></a>
<a id="TRY:N-RETRIES%20%28MGL-PAX:READER%20TRY:TRIAL%29"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial.lisp#L62">[reader]</a></span> <span class="reference-object"><a href="#TRY:N-RETRIES%20%28MGL-PAX:READER%20TRY:TRIAL%29" >n-retries</a></span></span> <span class="locative-args">trial (:n-retries = 0)</span></span></p>

<p>The number of times this <code>trial</code> has
been retried. See <a href="#TRY:RETRY-TRIAL%20FUNCTION" title="TRY:RETRY-TRIAL FUNCTION"><code>retry-trial</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FERRORS-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FERRORS%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FTRIAL-RESTARTS%20MGL-PAX:SECTION" title="Trial Restarts">&#8592;</a> <a href="#TRY:@TRY%2FEVENTS%20MGL-PAX:SECTION" title="Events">&#8593;</a> <a href="#TRY:@TRY%2FCATEGORIES%20MGL-PAX:SECTION" title="Categories">&#8594;</a> <a href="#TRY:@TRY%2FERRORS%20MGL-PAX:SECTION" title="Errors">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/error.lisp#L3">&#955;</a></span></span></p>
<h3><a href="#TRY:@TRY%2FERRORS%20MGL-PAX:SECTION">5.7 Errors</a></h3>
<p><a id="x-28TRY-3AERROR-2A-20CONDITION-29"></a>
<a id="TRY:ERROR*%20CONDITION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/error.lisp#L13">[condition]</a></span> <span class="reference-object"><a href="#TRY:ERROR*%20CONDITION" >error*</a></span></span> <span class="locative-args"><a href="#TRY:ABORT*%20CONDITION" title="TRY:ABORT* CONDITION">abort*</a> <a href="#TRY:TRIAL-EVENT%20CONDITION" title="TRY:TRIAL-EVENT CONDITION">trial-event</a> <a href="#TRY:LEAF%20CONDITION" title="TRY:LEAF CONDITION">leaf</a></span></span></p>

<p>Either <a href="#TRY:UNHANDLED-ERROR%20CONDITION" title="TRY:UNHANDLED-ERROR CONDITION"><code>unhandled-error</code></a> or <a href="#TRY:NLX%20CONDITION" title="TRY:NLX CONDITION"><code>nlx</code></a>, <code>error*</code> causes or
represents abnormal termination of a <a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a>. <a href="#TRY:ABORT-TRIAL%20FUNCTION" title="TRY:ABORT-TRIAL FUNCTION"><code>abort-trial</code></a> can be
called with <code>error*</code>s, but there is little need for explicitly doing
so as <a href="#TRY:RECORD-EVENT%20FUNCTION" title="TRY:RECORD-EVENT FUNCTION"><code>record-event</code></a>, which <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a> invokes, takes care of this.</p></li>
</ul>
<p><a id="x-28TRY-3ATEST-NAME-20-28MGL-PAX-3AREADER-20TRY-3AERROR-2A-29-29"></a>
<a id="TRY:TEST-NAME%20%28MGL-PAX:READER%20TRY:ERROR*%29"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/error.lisp#L13">[reader]</a></span> <span class="reference-object"><a href="#TRY:TEST-NAME%20%28MGL-PAX:READER%20TRY:ERROR*%29" >test-name</a></span></span> <span class="locative-args">error* (:test-name)</span></span></li>
</ul>
<p><a id="x-28TRY-3AUNHANDLED-ERROR-20CONDITION-29"></a>
<a id="TRY:UNHANDLED-ERROR%20CONDITION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/error.lisp#L20">[condition]</a></span> <span class="reference-object"><a href="#TRY:UNHANDLED-ERROR%20CONDITION" >unhandled-error</a></span></span> <span class="locative-args"><a href="#TRY:ERROR*%20CONDITION" title="TRY:ERROR* CONDITION">error*</a></span></span></p>

<p>Signalled when an <a href="http://www.lispworks.com/documentation/HyperSpec/Body/e_error.htm" title="ERROR (MGL-PAX:CLHS CONDITION)"><code>cl:error</code></a> condition reaches the
handlers set up <a href="#TRY:DEFTEST%20MGL-PAX:MACRO" title="TRY:DEFTEST MGL-PAX:MACRO"><code>deftest</code></a> or <a href="#TRY:WITH-TEST%20MGL-PAX:MACRO" title="TRY:WITH-TEST MGL-PAX:MACRO"><code>with-test</code></a>, or when their <a href="http://www.lispworks.com/documentation/HyperSpec/Body/v_debugg.htm" title="*DEBUGGER-HOOK* (MGL-PAX:CLHS VARIABLE)"><code>*debugger-hook*</code></a>
is invoked with a condition that's not an <a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION"><code>event</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3ANESTED-CONDITION-20-28MGL-PAX-3AREADER-20TRY-3AUNHANDLED-ERROR-29-29"></a>
<a id="TRY:NESTED-CONDITION%20%28MGL-PAX:READER%20TRY:UNHANDLED-ERROR%29"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/error.lisp#L20">[reader]</a></span> <span class="reference-object"><a href="#TRY:NESTED-CONDITION%20%28MGL-PAX:READER%20TRY:UNHANDLED-ERROR%29" >nested-condition</a></span></span> <span class="locative-args">unhandled-error (:condition = 'nil)</span></span></li>
</ul>
<p><a id="x-28TRY-3ABACKTRACE-OF-20-28MGL-PAX-3AREADER-20TRY-3AUNHANDLED-ERROR-29-29"></a>
<a id="TRY:BACKTRACE-OF%20%28MGL-PAX:READER%20TRY:UNHANDLED-ERROR%29"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/error.lisp#L20">[reader]</a></span> <span class="reference-object"><a href="#TRY:BACKTRACE-OF%20%28MGL-PAX:READER%20TRY:UNHANDLED-ERROR%29" >backtrace-of</a></span></span> <span class="locative-args">unhandled-error (:backtrace = 'nil)</span></span></li>
</ul>
<p><a id="x-28TRY-3ADEBUGGER-INVOKED-P-20-28MGL-PAX-3AREADER-20TRY-3AUNHANDLED-ERROR-29-29"></a>
<a id="TRY:DEBUGGER-INVOKED-P%20%28MGL-PAX:READER%20TRY:UNHANDLED-ERROR%29"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/error.lisp#L20">[reader]</a></span> <span class="reference-object"><a href="#TRY:DEBUGGER-INVOKED-P%20%28MGL-PAX:READER%20TRY:UNHANDLED-ERROR%29" >debugger-invoked-p</a></span></span> <span class="locative-args">unhandled-error (:debugger-invoked-p = 'nil)</span></span></li>
</ul>
<p><a id="x-28TRY-3A-2AGATHER-BACKTRACE-2A-20VARIABLE-29"></a>
<a id="TRY:*GATHER-BACKTRACE*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/error.lisp#L126">[variable]</a></span> <span class="reference-object"><a href="#TRY:*GATHER-BACKTRACE*%20VARIABLE" >*gather-backtrace*</a></span></span> <span class="locative-args">t</span></span></p>

<p>Capturing the backtrace can be expensive. <code>*gather-backtrace*</code>
controls whether <a href="#TRY:UNHANDLED-ERROR%20CONDITION" title="TRY:UNHANDLED-ERROR CONDITION"><code>unhandled-error</code></a>s shall have their <a href="#TRY:BACKTRACE-OF%20%28MGL-PAX:READER%20TRY:UNHANDLED-ERROR%29" title="TRY:BACKTRACE-OF (MGL-PAX:READER TRY:UNHANDLED-ERROR)"><code>backtrace-of</code></a>
populated.</p></li>
</ul>
<p><a id="x-28TRY-3ANLX-20CONDITION-29"></a>
<a id="TRY:NLX%20CONDITION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/error.lisp#L37">[condition]</a></span> <span class="reference-object"><a href="#TRY:NLX%20CONDITION" >nlx</a></span></span> <span class="locative-args"><a href="#TRY:ERROR*%20CONDITION" title="TRY:ERROR* CONDITION">error*</a></span></span></p>

<p>Representing a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_n.htm#non-local_exit" title="&quot;non-local exit&quot; (MGL-PAX:CLHS MGL-PAX:GLOSSARY-TERM)">non-local exit</a> of unknown
origin, this is signalled if a <a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a> does not return normally
although it should have because it was not dismissed (see <a href="#TRY:DISMISSAL%20CONDITION" title="TRY:DISMISSAL CONDITION"><code>dismissal</code></a>,
<a href="#TRY:SKIP-TRIAL%20FUNCTION" title="TRY:SKIP-TRIAL FUNCTION"><code>skip-trial</code></a>, <a href="#TRY:ABORT-TRIAL%20FUNCTION" title="TRY:ABORT-TRIAL FUNCTION"><code>abort-trial</code></a>). In this case, there is no <code>cl:error</code>(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/e_error.htm" title="ERROR (MGL-PAX:CLHS CONDITION)"><code>0</code></a> <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_error.htm" title="ERROR (MGL-PAX:CLHS FUNCTION)"><code>1</code></a>)
associated with the event.</p></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FCATEGORIES-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FCATEGORIES%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FERRORS%20MGL-PAX:SECTION" title="Errors">&#8592;</a> <a href="#TRY:@TRY%2FEVENTS%20MGL-PAX:SECTION" title="Events">&#8593;</a> <a href="#TRY:@TRY%2FIS%20MGL-PAX:SECTION" title="The `is` Macro">&#8594;</a> <a href="#TRY:@TRY%2FCATEGORIES%20MGL-PAX:SECTION" title="Categories">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L233">&#955;</a></span></span></p>
<h3><a href="#TRY:@TRY%2FCATEGORIES%20MGL-PAX:SECTION">5.8 Categories</a></h3>
<p>Categories determine how event types are printed and events of
what types are counted together.</p>
<p>The default value of <a href="#TRY:*CATEGORIES*%20VARIABLE" title="TRY:*CATEGORIES* VARIABLE"><code>*categories*</code></a> is</p>
<pre><code><span class="code"><span class="paren1">(<span class="code"><span class="paren2">(<span class="code">abort*             <span class="keyword">:marker</span> <span class="string">"⊟"</span></span>)</span>
 <span class="paren2">(<span class="code">unexpected-failure <span class="keyword">:marker</span> <span class="string">"⊠"</span></span>)</span>
 <span class="paren2">(<span class="code">unexpected-success <span class="keyword">:marker</span> <span class="string">"⊡"</span></span>)</span>
 <span class="paren2">(<span class="code">skip               <span class="keyword">:marker</span> <span class="string">"-"</span></span>)</span>
 <span class="paren2">(<span class="code">expected-failure   <span class="keyword">:marker</span> <span class="string">"×"</span></span>)</span>
 <span class="paren2">(<span class="code">expected-success   <span class="keyword">:marker</span> <span class="string">"⋅"</span></span>)</span></span>)</span></span></code></pre>
<p>which says that all concrete <a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION"><code>event</code></a>s that are of type <a href="#TRY:ABORT*%20CONDITION" title="TRY:ABORT* CONDITION"><code>abort*</code></a> (i.e.
<a href="#TRY:RESULT-ABORT*%20CONDITION" title="TRY:RESULT-ABORT* CONDITION"><code>result-abort*</code></a>, <a href="#TRY:VERDICT-ABORT*%20CONDITION" title="TRY:VERDICT-ABORT* CONDITION"><code>verdict-abort*</code></a>, <a href="#TRY:UNHANDLED-ERROR%20CONDITION" title="TRY:UNHANDLED-ERROR CONDITION"><code>unhandled-error</code></a>, and <a href="#TRY:NLX%20CONDITION" title="TRY:NLX CONDITION"><code>nlx</code></a>) are to
be marked with <code>&quot;⊟&quot;</code> when printed (see <a href="#TRY:@TRY%2FPRINT%20MGL-PAX:SECTION" title="Printing Events">Printing Events</a>). Also, the six
types define six counters for <a href="#TRY:@TRY%2FCOUNT%20MGL-PAX:SECTION" title="Counting Events">Counting Events</a>. Note that <a href="#TRY:UNEXPECTED%20CONDITION" title="TRY:UNEXPECTED CONDITION"><code>unexpected</code></a>
events have the same marker but squared as their <a href="#TRY:EXPECTED%20CONDITION" title="TRY:EXPECTED CONDITION"><code>expected</code></a>
counterpart.</p>
<p><a id="x-28TRY-3A-2ACATEGORIES-2A-20VARIABLE-29"></a>
<a id="TRY:*CATEGORIES*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L290">[variable]</a></span> <span class="reference-object"><a href="#TRY:*CATEGORIES*%20VARIABLE" >*categories*</a></span></span> <span class="locative-args">&quot;- see above -&quot;</span></span></p>

<p>A list of of elements like <code>(type &amp;key marker)</code>.
When <a href="#TRY:@TRY%2FPRINT%20MGL-PAX:SECTION" title="Printing Events">Printing Events</a>, <a href="#TRY:@TRY%2FCONCRETE-EVENTS%20MGL-PAX:SECTION" title="Concrete Events">Concrete Events</a> are printed with the marker of
the first matching type. When <a href="#TRY:@TRY%2FCOUNT%20MGL-PAX:SECTION" title="Counting Events">Counting Events</a>, the counts associated with
all matching types are incremented.</p></li>
</ul>
<p><a id="x-28TRY-3AFANCY-STD-CATEGORIES-20FUNCTION-29"></a>
<a id="TRY:FANCY-STD-CATEGORIES%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L259">[function]</a></span> <span class="reference-object"><a href="#TRY:FANCY-STD-CATEGORIES%20FUNCTION" >fancy-std-categories</a></span></span></span></p>

<p>Returns the default value of <a href="#TRY:*CATEGORIES*%20VARIABLE" title="TRY:*CATEGORIES* VARIABLE"><code>*categories*</code></a> (see <a href="#TRY:@TRY%2FCATEGORIES%20MGL-PAX:SECTION" title="Categories">Categories</a>),
which contains some fancy Unicode characters.</p></li>
</ul>
<p><a id="x-28TRY-3AASCII-STD-CATEGORIES-20FUNCTION-29"></a>
<a id="TRY:ASCII-STD-CATEGORIES%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/events.lisp#L269">[function]</a></span> <span class="reference-object"><a href="#TRY:ASCII-STD-CATEGORIES%20FUNCTION" >ascii-std-categories</a></span></span></span></p>

<p>Returns a value suitable for <a href="#TRY:*CATEGORIES*%20VARIABLE" title="TRY:*CATEGORIES* VARIABLE"><code>*categories*</code></a>, which uses only ASCII
characters for the markers.</p>

<pre><code><span class="code">'<span class="paren1">(<span class="code"><span class="paren2">(<span class="code">abort*             <span class="keyword">:marker</span> <span class="string">"!"</span></span>)</span>
  <span class="paren2">(<span class="code">unexpected-failure <span class="keyword">:marker</span> <span class="string">"F"</span></span>)</span>
  <span class="paren2">(<span class="code">unexpected-success <span class="keyword">:marker</span> <span class="string">":"</span></span>)</span>
  <span class="paren2">(<span class="code">skip               <span class="keyword">:marker</span> <span class="string">"-"</span></span>)</span>
  <span class="paren2">(<span class="code">expected-failure   <span class="keyword">:marker</span> <span class="string">"f"</span></span>)</span>
  <span class="paren2">(<span class="code">expected-success   <span class="keyword">:marker</span> <span class="string">"."</span></span>)</span></span>)</span></span></code></pre></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FIS-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FIS%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FCATEGORIES%20MGL-PAX:SECTION" title="Categories">&#8592;</a> <a href="try-manual.html" title="Try Manual">&#8593;</a> <a href="#TRY:@TRY%2FFORMAT-SPECIFIER-FORMS%20MGL-PAX:SECTION" title="Format Specifier Forms">&#8594;</a> <a href="#TRY:@TRY%2FIS%20MGL-PAX:SECTION" title="The `is` Macro">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/is.lisp#L5">&#955;</a></span></span></p>
<h2><a href="#TRY:@TRY%2FIS%20MGL-PAX:SECTION">6 The <code>is</code> Macro</a></h2>
<p><a href="#TRY:IS%20MGL-PAX:MACRO" title="TRY:IS MGL-PAX:MACRO"><code>is</code></a> is the fundamental one among <a href="#TRY:@TRY%2FCHECKS%20MGL-PAX:SECTION" title="Checks">Checks</a>, on which all
the others are built, and it is a replacement for <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_assert.htm" title="ASSERT (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>cl:assert</code></a> that can
capture values of subforms to provide context to failures:</p>
<pre><code><span class="code"><span class="paren1">(<span class="code">is <span class="paren2">(<span class="code">= <span class="paren3">(<span class="code">1+ 5</span>)</span> 0</span>)</span></span>)</span>
.. debugger invoked on UNEXPECTED-RESULT-FAILURE:
..   UNEXPECTED-FAILURE in check:
..     <span class="paren1">(<span class="code">IS <span class="paren2">(<span class="code">= #1=<span class="paren3">(<span class="code">1+ 5</span>)</span> 0</span>)</span></span>)</span>
..   where
..     #1# = 6</span></code></pre>
<p><code>is</code> automatically captures values of arguments to functions like <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_1pl_1_.htm" title="1+ (MGL-PAX:CLHS FUNCTION)"><code>1+</code></a>
in the above example. Values of other interesting subforms can be
explicitly requested to be captured. <code>is</code> supports capturing multiple
values and can be taught how to deal with macros. The combination of
these features allows <a href="#TRY:MATCH-VALUES%20MGL-PAX:MACRO" title="TRY:MATCH-VALUES MGL-PAX:MACRO"><code>match-values</code></a> to be implementable as tiny
extension:</p>
<pre><code><span class="code"><span class="paren1">(<span class="code">is <span class="paren2">(<span class="code">match-values <span class="paren3">(<span class="code">values <span class="paren4">(<span class="code">1+ 5</span>)</span> <span class="string">"sdf"</span></span>)</span>
      <span class="paren3">(<span class="code">= * 0</span>)</span>
      <span class="paren3">(<span class="code">string= * <span class="string">"sdf"</span></span>)</span></span>)</span></span>)</span>
.. debugger invoked on UNEXPECTED-RESULT-FAILURE:
..   UNEXPECTED-FAILURE in check:
..     <span class="paren1">(<span class="code">IS
..      <span class="paren2">(<span class="code">MATCH-VALUES #1=<span class="paren3">(<span class="code">VALUES <span class="paren4">(<span class="code">1+ 5</span>)</span> #2=<span class="string">"sdf"</span></span>)</span>
..        <span class="paren3">(<span class="code">= * 0</span>)</span>
..        <span class="paren3">(<span class="code">STRING= * <span class="string">"sdf"</span></span>)</span></span>)</span></span>)</span>
..   where
..     #1# == 6
..            #2#</span></code></pre>
<p><code>is</code> is flexible enough that all other checks (<a href="#TRY:SIGNALS%20MGL-PAX:MACRO" title="TRY:SIGNALS MGL-PAX:MACRO"><code>signals</code></a>, <a href="#TRY:SIGNALS-NOT%20MGL-PAX:MACRO" title="TRY:SIGNALS-NOT MGL-PAX:MACRO"><code>signals-not</code></a>,
<a href="#TRY:INVOKES-DEBUGGER%20MGL-PAX:MACRO" title="TRY:INVOKES-DEBUGGER MGL-PAX:MACRO"><code>invokes-debugger</code></a>, <a href="#TRY:INVOKES-DEBUGGER-NOT%20MGL-PAX:MACRO" title="TRY:INVOKES-DEBUGGER-NOT MGL-PAX:MACRO"><code>invokes-debugger-not</code></a>, <a href="#TRY:FAILS%20MGL-PAX:MACRO" title="TRY:FAILS MGL-PAX:MACRO"><code>fails</code></a>, and <a href="#TRY:IN-TIME%20MGL-PAX:MACRO" title="TRY:IN-TIME MGL-PAX:MACRO"><code>in-time</code></a> are built
on top of it.</p>
<p><a id="x-28TRY-3AIS-20MGL-PAX-3AMACRO-29"></a>
<a id="TRY:IS%20MGL-PAX:MACRO"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/is.lisp#L59">[macro]</a></span> <span class="reference-object"><a href="#TRY:IS%20MGL-PAX:MACRO" >is</a></span></span> <span class="locative-args">form &amp;key msg ctx (capture t) (print-captures t) (retry t)</span></span></p>

<p>Evaluate <code>form</code> and signal a <a href="#TRY:RESULT%20CONDITION" title="TRY:RESULT CONDITION"><code>result</code></a> <a href="#TRY:SUCCESS%20CONDITION" title="TRY:SUCCESS CONDITION"><code>success</code></a> if its first return
value is not <code>nil</code>, else signal a <code>result</code> <a href="#TRY:FAILURE%20CONDITION" title="TRY:FAILURE CONDITION"><code>failure</code></a> (see <a href="#TRY:@TRY%2FOUTCOMES%20MGL-PAX:SECTION" title="Outcomes">Outcomes</a>).
<code>is</code> returns normally if</p>

<ul>
<li><p>the <a href="#TRY:RECORD-EVENT%20FUNCTION" title="TRY:RECORD-EVENT FUNCTION"><code>record-event</code></a> restart is invoked (available when running in a
  trial), or</p></li>
<li><p>the <a href="http://www.lispworks.com/documentation/HyperSpec/Body/r_contin.htm" title="CONTINUE (MGL-PAX:CLHS RESTART)"><code>continue</code></a> restart is invoked (available when not running in a
  trial), or</p></li>
<li><p>the signalled <a href="#TRY:RESULT%20CONDITION" title="TRY:RESULT CONDITION"><code>result</code></a> condition is not handled (possible only when
  not running in a trial, and the result is a <a href="#TRY:PASS%20TYPE" title="TRY:PASS TYPE"><code>pass</code></a>).</p></li>
</ul>

<p>The return value of <code>is</code> is <code>t</code> if the last condition signalled is a
<code>success</code>, and <code>nil</code> otherwise.</p>

<p><code>msg</code> and <code>ctx</code> are <a href="#TRY:@TRY%2FFORMAT-SPECIFIER-FORMS%20MGL-PAX:SECTION" title="Format Specifier Forms">Format Specifier Forms</a>. <code>msg</code> prints a
description of the check being made, which is by default the whole
<code>is</code> form. Due to how conditions are printed, <code>msg</code> says what the
desired outcome is, and <code>ctx</code> provides information about the
evaluation.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code">is <span class="paren2">(<span class="code">equal <span class="paren3">(<span class="code">prin1-to-string 'hello</span>)</span> <span class="string">"hello"</span></span>)</span>
    <span class="keyword">:msg</span> <span class="string">"Symbols are replacements for strings."</span> 
    <span class="keyword">:ctx</span> <span class="paren2">(<span class="code"><span class="string">"*PACKAGE* is ~S and *PRINT-CASE* is ~S~%"</span>
          <span class="special">*package*</span> <span class="special">*print-case*</span></span>)</span></span>)</span>
.. debugger invoked on UNEXPECTED-RESULT-FAILURE:
..   UNEXPECTED-FAILURE in check:
..     Symbols are replacements for strings.
..   where
..     <span class="paren1">(<span class="code">PRIN1-TO-STRING 'HELLO</span>)</span> = "HELLO"
..   *PACKAGE* is #&lt;PACKAGE "TRY"&gt; and *PRINT-CASE* is :UPCASE
..</span></code></pre>

<p>If <code>capture</code> is true, the value(s) of some subforms of <code>form</code> may be
automatically recorded in the condition and also made available for
<code>ctx</code> via <a href="#TRY:*IS-CAPTURES*%20VARIABLE" title="TRY:*IS-CAPTURES* VARIABLE"><code>*is-captures*</code></a>. See <a href="#TRY:@TRY%2FCAPTURES%20MGL-PAX:SECTION" title="Captures">Captures</a> for more.</p>

<p>If <code>print-captures</code> is true, the captures made are printed when the
<a href="#TRY:RESULT%20CONDITION" title="TRY:RESULT CONDITION"><code>result</code></a> condition is displayed in the debugger or <a href="#TRY:*DESCRIBE*%20VARIABLE" title="TRY:*DESCRIBE* VARIABLE"><code>*describe*</code></a>d (see
<a href="#TRY:@TRY%2FPRINT%20MGL-PAX:SECTION" title="Printing Events">Printing Events</a>). This is the <code>where (PRIN1-TO-STRING 'HELLO) =&quot;HELLO&quot;</code>
part above. If <code>print-captures</code> is <code>nil</code>, the captures are still
available in <code>*is-captures*</code> for writing custom <code>ctx</code> messages.</p>

<p>If <code>retry</code> is true, then the <a href="#TRY:RETRY-CHECK%20FUNCTION" title="TRY:RETRY-CHECK FUNCTION"><code>retry-check</code></a> restart evaluates <code>form</code> again
and signals a new <code>result</code>. If <code>retry</code> is <code>nil</code>, then the <code>retry-check</code>
restart returns <code>:retry</code>, which allows complex checks such as <a href="#TRY:SIGNALS%20MGL-PAX:MACRO" title="TRY:SIGNALS MGL-PAX:MACRO"><code>signals</code></a>
to implement their own retry mechanism.</p></li>
</ul>
<p><a id="x-28TRY-3A-2AIS-FORM-2A-20VARIABLE-29"></a>
<a id="TRY:*IS-FORM*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/is.lisp#L51">[variable]</a></span> <span class="reference-object"><a href="#TRY:*IS-FORM*%20VARIABLE" >*is-form*</a></span></span></span></p>

<p><a href="#TRY:IS%20MGL-PAX:MACRO" title="TRY:IS MGL-PAX:MACRO"><code>is</code></a> binds this to its <code>form</code> argument for <code>ctx</code> and <code>msg</code>.</p></li>
</ul>
<p><a id="x-28TRY-3A-2AIS-CAPTURES-2A-20VARIABLE-29"></a>
<a id="TRY:*IS-CAPTURES*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/is.lisp#L54">[variable]</a></span> <span class="reference-object"><a href="#TRY:*IS-CAPTURES*%20VARIABLE" >*is-captures*</a></span></span></span></p>

<p>Captures made during an <a href="#TRY:IS%20MGL-PAX:MACRO" title="TRY:IS MGL-PAX:MACRO"><code>is</code></a> evaluation are made available for
<code>ctx</code> via <code>*is-captures*</code>.</p></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FFORMAT-SPECIFIER-FORMS-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FFORMAT-SPECIFIER-FORMS%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FIS%20MGL-PAX:SECTION" title="The `is` Macro">&#8592;</a> <a href="#TRY:@TRY%2FIS%20MGL-PAX:SECTION" title="The `is` Macro">&#8593;</a> <a href="#TRY:@TRY%2FCAPTURES%20MGL-PAX:SECTION" title="Captures">&#8594;</a> <a href="#TRY:@TRY%2FFORMAT-SPECIFIER-FORMS%20MGL-PAX:SECTION" title="Format Specifier Forms">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/is.lisp#L162">&#955;</a></span></span></p>
<h3><a href="#TRY:@TRY%2FFORMAT-SPECIFIER-FORMS%20MGL-PAX:SECTION">6.1 Format Specifier Forms</a></h3>
<p>A format specifier form is a Lisp form, typically an argument to
macro, standing for the <code>format-control</code> and <code>format-args</code> arguments to
the <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_format.htm" title="FORMAT (MGL-PAX:CLHS FUNCTION)"><code>format</code></a> function.</p>
<p>It may be a constant string:</p>
<pre><code><span class="code"><span class="paren1">(<span class="code">is nil <span class="keyword">:msg</span> <span class="string">"FORMAT-CONTROL~%with no args."</span></span>)</span>
.. debugger invoked on UNEXPECTED-RESULT-FAILURE:
..   UNEXPECTED-FAILURE in check:
..     FORMAT-CONTROL
..     with no args.</span></code></pre>
<p>It may be a list whose first element is a constant string, and the
rest are the format arguments to be evaluated:</p>
<pre><code><span class="code"><span class="paren1">(<span class="code">is nil <span class="keyword">:msg</span> <span class="paren2">(<span class="code"><span class="string">"Implicit LIST ~A."</span> <span class="string">"form"</span></span>)</span></span>)</span>
.. debugger invoked on UNEXPECTED-RESULT-FAILURE:
..   UNEXPECTED-FAILURE in check:
..     Implicit LIST form.</span></code></pre>
<p>Or it may be a form that evaluates to a list like <code>(format-control
&amp;rest format-args)</code>:</p>
<pre><code><span class="code"><span class="paren1">(<span class="code">is nil <span class="keyword">:msg</span> <span class="paren2">(<span class="code">list <span class="string">"Full ~A."</span> <span class="string">"form"</span></span>)</span></span>)</span>
.. debugger invoked on UNEXPECTED-RESULT-FAILURE:
..   UNEXPECTED-FAILURE in check:
..     Full form.</span></code></pre>
<p>Finally, it may evaluate to <code>nil</code>, in which case some context specific
default is implied.</p>
<p><a id="x-28TRY-3ACANONICALIZE-FORMAT-SPECIFIER-FORM-20FUNCTION-29"></a>
<a id="TRY:CANONICALIZE-FORMAT-SPECIFIER-FORM%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/is.lisp#L202">[function]</a></span> <span class="reference-object"><a href="#TRY:CANONICALIZE-FORMAT-SPECIFIER-FORM%20FUNCTION" >canonicalize-format-specifier-form</a></span></span> <span class="locative-args">form</span></span></p>

<p>Ensure that the format specifier form <code>form</code> is in its full form.</p></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FCAPTURES-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FCAPTURES%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FFORMAT-SPECIFIER-FORMS%20MGL-PAX:SECTION" title="Format Specifier Forms">&#8592;</a> <a href="#TRY:@TRY%2FIS%20MGL-PAX:SECTION" title="The `is` Macro">&#8593;</a> <a href="#TRY:@TRY%2FAUTOMATIC-CAPTURES%20MGL-PAX:SECTION" title="Automatic Captures">&#8594;</a> <a href="#TRY:@TRY%2FCAPTURES%20MGL-PAX:SECTION" title="Captures">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/is.lisp#L213">&#955;</a></span></span></p>
<h3><a href="#TRY:@TRY%2FCAPTURES%20MGL-PAX:SECTION">6.2 Captures</a></h3>
<p>During the evaluation of the <code>form</code> argument of <a href="#TRY:IS%20MGL-PAX:MACRO" title="TRY:IS MGL-PAX:MACRO"><code>is</code></a>, evaluation of any
form (e.g. a subform of <code>form</code>) may be recorded, which are called
captures.</p>
<p><a id="x-28TRY-3A-40TRY-2FAUTOMATIC-CAPTURES-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FAUTOMATIC-CAPTURES%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FCAPTURES%20MGL-PAX:SECTION" title="Captures">&#8592;</a> <a href="#TRY:@TRY%2FCAPTURES%20MGL-PAX:SECTION" title="Captures">&#8593;</a> <a href="#TRY:@TRY%2FWRITING-AUTOMATIC-CAPTURE-RULES%20MGL-PAX:SECTION" title="Writing Automatic Capture Rules">&#8594;</a> <a href="#TRY:@TRY%2FAUTOMATIC-CAPTURES%20MGL-PAX:SECTION" title="Automatic Captures">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/is.lisp#L311">&#955;</a></span></span></p>
<h4><a href="#TRY:@TRY%2FAUTOMATIC-CAPTURES%20MGL-PAX:SECTION">6.2.1 Automatic Captures</a></h4>
<p><a href="#TRY:IS%20MGL-PAX:MACRO" title="TRY:IS MGL-PAX:MACRO"><code>is</code></a> automatically captures some subforms of <code>form</code> that are likely
to be informative. In particular, if <code>form</code> is a function call, then
non-constant arguments are automatically captured:</p>
<pre><code><span class="code"><span class="paren1">(<span class="code">is <span class="paren2">(<span class="code">= 3 <span class="paren3">(<span class="code">1+ 2</span>)</span> <span class="paren3">(<span class="code">- 4 3</span>)</span></span>)</span></span>)</span>
.. debugger invoked on UNEXPECTED-RESULT-FAILURE:
..   UNEXPECTED-FAILURE in check:
..     <span class="paren1">(<span class="code">IS <span class="paren2">(<span class="code">= 3 #1=<span class="paren3">(<span class="code">1+ 2</span>)</span> #2=<span class="paren3">(<span class="code">- 4 3</span>)</span></span>)</span></span>)</span>
..   where
..     #1# = 3
..     #2# = 1</span></code></pre>
<p>By default, automatic captures are not made for subforms deeper in
<code>form</code>, except for when <code>form</code> is a call to <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_null.htm" title="NULL (MGL-PAX:CLHS FUNCTION)"><code>null</code></a>,
<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_endp.htm" title="ENDP (MGL-PAX:CLHS FUNCTION)"><code>endp</code></a> and <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_not.htm" title="NOT (MGL-PAX:CLHS FUNCTION)"><code>not</code></a>:</p>
<pre><code><span class="code"><span class="paren1">(<span class="code">is <span class="paren2">(<span class="code">null <span class="paren3">(<span class="code">find <span class="paren4">(<span class="code">1+ 1</span>)</span> '<span class="paren4">(<span class="code">1 2 3</span>)</span></span>)</span></span>)</span></span>)</span>
.. debugger invoked on UNEXPECTED-RESULT-FAILURE:
..   UNEXPECTED-FAILURE in check:
..     <span class="paren1">(<span class="code">IS <span class="paren2">(<span class="code">NULL #1=<span class="paren3">(<span class="code">FIND #2=<span class="paren4">(<span class="code">1+ 1</span>)</span> '<span class="paren4">(<span class="code">1 2 3</span>)</span></span>)</span></span>)</span></span>)</span>
..   where
..     #2# = 2
..     #1# = 2</span></code></pre>
<pre><code><span class="code"><span class="paren1">(<span class="code">is <span class="paren2">(<span class="code">endp <span class="paren3">(<span class="code">member <span class="paren4">(<span class="code">1+ 1</span>)</span> '<span class="paren4">(<span class="code">1 2 3</span>)</span></span>)</span></span>)</span></span>)</span>
.. debugger invoked on UNEXPECTED-RESULT-FAILURE:
..   UNEXPECTED-FAILURE in check:
..     <span class="paren1">(<span class="code">IS <span class="paren2">(<span class="code">ENDP #1=<span class="paren3">(<span class="code">MEMBER #2=<span class="paren4">(<span class="code">1+ 1</span>)</span> '<span class="paren4">(<span class="code">1 2 3</span>)</span></span>)</span></span>)</span></span>)</span>
..   where
..     #2# = 2
..     #1# = <span class="paren1">(<span class="code">2 3</span>)</span></span></code></pre>
<p>Note that the argument of <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_not.htm" title="NOT (MGL-PAX:CLHS FUNCTION)"><code>not</code></a> is not captured as it is
assumed to be <code>nil</code> or <code>t</code>. If that's not true, use <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_null.htm" title="NULL (MGL-PAX:CLHS FUNCTION)"><code>null</code></a>.</p>
<pre><code><span class="code"><span class="paren1">(<span class="code">is <span class="paren2">(<span class="code">not <span class="paren3">(<span class="code">equal <span class="paren4">(<span class="code">1+ 5</span>)</span> 6</span>)</span></span>)</span></span>)</span>
.. debugger invoked on UNEXPECTED-RESULT-FAILURE:
..   UNEXPECTED-FAILURE in check:
..     <span class="paren1">(<span class="code">IS <span class="paren2">(<span class="code">NOT <span class="paren3">(<span class="code">EQUAL #1=<span class="paren4">(<span class="code">1+ 5</span>)</span> 6</span>)</span></span>)</span></span>)</span>
..   where
..     #1# = 6</span></code></pre>
<p>Other automatic captures are discussed with the relevant
functionality such as <a href="#TRY:MATCH-VALUES%20MGL-PAX:MACRO" title="TRY:MATCH-VALUES MGL-PAX:MACRO"><code>match-values</code></a>.</p>
<p><a id="x-28TRY-3A-40TRY-2FWRITING-AUTOMATIC-CAPTURE-RULES-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FWRITING-AUTOMATIC-CAPTURE-RULES%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FAUTOMATIC-CAPTURES%20MGL-PAX:SECTION" title="Automatic Captures">&#8592;</a> <a href="#TRY:@TRY%2FAUTOMATIC-CAPTURES%20MGL-PAX:SECTION" title="Automatic Captures">&#8593;</a> <a href="#TRY:@TRY%2FEXPLICIT-CAPTURES%20MGL-PAX:SECTION" title="Explicit Captures">&#8594;</a> <a href="#TRY:@TRY%2FWRITING-AUTOMATIC-CAPTURE-RULES%20MGL-PAX:SECTION" title="Writing Automatic Capture Rules">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/is.lisp#L459">&#955;</a></span></span></p>
<h5><a href="#TRY:@TRY%2FWRITING-AUTOMATIC-CAPTURE-RULES%20MGL-PAX:SECTION">Writing Automatic Capture Rules</a></h5>
<p><a id="x-28TRY-3ASUB-20CLASS-29"></a>
<a id="TRY:SUB%20CLASS"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/is.lisp#L367">[class]</a></span> <span class="reference-object"><a href="#TRY:SUB%20CLASS" >sub</a></span></span> <span class="locative-args"><a href="http://www.lispworks.com/documentation/HyperSpec/Body/t_stu_ob.htm" title="STRUCTURE-OBJECT (MGL-PAX:CLHS CLASS)">structure-object</a></span></span></p>

<p>A <code>sub</code> (short for substitution) says that in the original form <a href="#TRY:IS%20MGL-PAX:MACRO" title="TRY:IS MGL-PAX:MACRO"><code>is</code></a> is
checking, a <code>subform</code> was substituted (by <code>substitute-is-form</code>) with
<code>var</code> (if <code>valuesp</code> is <code>nil</code>) or with (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_vals_l.htm" title="VALUES-LIST (MGL-PAX:CLHS FUNCTION)"><code>values-list</code></a> <code>var</code>) if <code>valuesp</code> is
true. Conversely, <code>var</code> is to be bound to the evaluated <code>new-form</code> if
<code>valuesp</code> is <code>nil</code>, and to (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_mult_1.htm" title="MULTIPLE-VALUE-LIST (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>multiple-value-list</code></a> <code>form</code>) if <code>valuesp</code>.
<code>new-form</code> is often <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_eq.htm" title="EQ (MGL-PAX:CLHS FUNCTION)"><code>eq</code></a> to <code>subform</code>, but it may be different, which is
the case when further substitutions are made within a substitution.</p></li>
</ul>
<p><a id="x-28TRY-3AMAKE-SUB-20FUNCTION-29"></a>
<a id="TRY:MAKE-SUB%20FUNCTION"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/is.lisp#L367">[function]</a></span> <span class="reference-object"><a href="#TRY:MAKE-SUB%20FUNCTION" >make-sub</a></span></span> <span class="locative-args">var subform new-form valuesp</span></span></li>
</ul>
<p><a id="x-28TRY-3ASUB-VAR-20-28MGL-PAX-3ASTRUCTURE-ACCESSOR-20TRY-3ASUB-29-29"></a>
<a id="TRY:SUB-VAR%20%28MGL-PAX:STRUCTURE-ACCESSOR%20TRY:SUB%29"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/is.lisp#L367">[structure-accessor]</a></span> <span class="reference-object"><a href="#TRY:SUB-VAR%20%28MGL-PAX:STRUCTURE-ACCESSOR%20TRY:SUB%29" >sub-var</a></span></span> <span class="locative-args">sub</span></span></li>
</ul>
<p><a id="x-28TRY-3ASUB-SUBFORM-20-28MGL-PAX-3ASTRUCTURE-ACCESSOR-20TRY-3ASUB-29-29"></a>
<a id="TRY:SUB-SUBFORM%20%28MGL-PAX:STRUCTURE-ACCESSOR%20TRY:SUB%29"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/is.lisp#L367">[structure-accessor]</a></span> <span class="reference-object"><a href="#TRY:SUB-SUBFORM%20%28MGL-PAX:STRUCTURE-ACCESSOR%20TRY:SUB%29" >sub-subform</a></span></span> <span class="locative-args">sub</span></span></li>
</ul>
<p><a id="x-28TRY-3ASUB-NEW-FORM-20-28MGL-PAX-3ASTRUCTURE-ACCESSOR-20TRY-3ASUB-29-29"></a>
<a id="TRY:SUB-NEW-FORM%20%28MGL-PAX:STRUCTURE-ACCESSOR%20TRY:SUB%29"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/is.lisp#L367">[structure-accessor]</a></span> <span class="reference-object"><a href="#TRY:SUB-NEW-FORM%20%28MGL-PAX:STRUCTURE-ACCESSOR%20TRY:SUB%29" >sub-new-form</a></span></span> <span class="locative-args">sub</span></span></li>
</ul>
<p><a id="x-28TRY-3ASUB-VALUESP-20-28MGL-PAX-3ASTRUCTURE-ACCESSOR-20TRY-3ASUB-29-29"></a>
<a id="TRY:SUB-VALUESP%20%28MGL-PAX:STRUCTURE-ACCESSOR%20TRY:SUB%29"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/is.lisp#L367">[structure-accessor]</a></span> <span class="reference-object"><a href="#TRY:SUB-VALUESP%20%28MGL-PAX:STRUCTURE-ACCESSOR%20TRY:SUB%29" >sub-valuesp</a></span></span> <span class="locative-args">sub</span></span></li>
</ul>
<p><a id="x-28TRY-3ASUBSTITUTE-IS-LIST-FORM-20GENERIC-FUNCTION-29"></a>
<a id="TRY:SUBSTITUTE-IS-LIST-FORM%20GENERIC-FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/is.lisp#L475">[generic-function]</a></span> <span class="reference-object"><a href="#TRY:SUBSTITUTE-IS-LIST-FORM%20GENERIC-FUNCTION" >substitute-is-list-form</a></span></span> <span class="locative-args">first form env</span></span></p>

<p>In the list <code>form</code>, whose <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_car_c.htm" title="CAR (MGL-PAX:CLHS FUNCTION)"><code>car</code></a> is <code>first</code>, substitute
subexpressions of interest with a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_gensym.htm" title="GENSYM (MGL-PAX:CLHS FUNCTION)"><code>gensym</code></a> and return the new form. As
the second value, return a list of <a href="#TRY:SUB%20CLASS" title="TRY:SUB CLASS"><code>sub</code></a>s.</p>

<p>For example, consider <code>(is (find (foo) list))</code>. When
<code>substitute-is-list-form</code> is invoked on <code>(find (foo) list)</code>, it
substitutes each argument of <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_find_.htm" title="FIND (MGL-PAX:CLHS FUNCTION)"><code>find</code></a> with a variable, returning the new
form <code>(find temp1 temp2)</code> and the list of two
substitutions <code>((temp2 (foo) (foo) nil) (temp3 list list nil))</code>.
This allows the original form to be rewritten as</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">let*</span></i> <span class="paren2">(<span class="code"><span class="paren3">(<span class="code">temp1 <span class="paren4">(<span class="code">foo</span>)</span></span>)</span>
       <span class="paren3">(<span class="code">temp2 list</span>)</span></span>)</span>
  <span class="paren2">(<span class="code">find temp1 temp2</span>)</span></span>)</span></span></code></pre>

<p>TEMP1 and TEMP2 may then be reported in the <a href="#TRY:OUTCOME%20CONDITION" title="TRY:OUTCOME CONDITION"><code>outcome</code></a> condition
signalled by <a href="#TRY:IS%20MGL-PAX:MACRO" title="TRY:IS MGL-PAX:MACRO"><code>is</code></a> like this:</p>

<pre><code>The following check failed:
  (is (find #1=(foo) #2=list))
where
  #1# = &lt;return-value-of-foo&gt;
  #2# = &lt;value-of-variable-list&gt;
</code></pre></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FEXPLICIT-CAPTURES-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FEXPLICIT-CAPTURES%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FWRITING-AUTOMATIC-CAPTURE-RULES%20MGL-PAX:SECTION" title="Writing Automatic Capture Rules">&#8592;</a> <a href="#TRY:@TRY%2FCAPTURES%20MGL-PAX:SECTION" title="Captures">&#8593;</a> <a href="#TRY:@TRY%2FCHECK-LIBRARY%20MGL-PAX:SECTION" title="Check Library">&#8594;</a> <a href="#TRY:@TRY%2FEXPLICIT-CAPTURES%20MGL-PAX:SECTION" title="Explicit Captures">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/is.lisp#L221">&#955;</a></span></span></p>
<h4><a href="#TRY:@TRY%2FEXPLICIT-CAPTURES%20MGL-PAX:SECTION">6.2.2 Explicit Captures</a></h4>
<p>In addition to automatic captures, which are prescribed by
rewriting rules (see <a href="#TRY:@TRY%2FWRITING-AUTOMATIC-CAPTURE-RULES%20MGL-PAX:SECTION" title="Writing Automatic Capture Rules">Writing Automatic Capture Rules</a>),
explicit, ad-hoc captures can also be made.</p>
<pre><code><span class="code"><span class="paren1">(<span class="code">is <span class="paren2">(<span class="code"><i><span class="symbol">let</span></i> <span class="paren3">(<span class="code"><span class="paren4">(<span class="code">x 1</span>)</span></span>)</span>
      <span class="paren3">(<span class="code">= <span class="paren4">(<span class="code">capture x</span>)</span> 2</span>)</span></span>)</span></span>)</span>
.. debugger invoked on UNEXPECTED-RESULT-FAILURE:
..   UNEXPECTED-FAILURE in check:
..     <span class="paren1">(<span class="code">IS
..      <span class="paren2">(<span class="code"><i><span class="symbol">LET</span></i> <span class="paren3">(<span class="code"><span class="paren4">(<span class="code">X 1</span>)</span></span>)</span>
..        <span class="paren3">(<span class="code">= <span class="paren4">(<span class="code">CAPTURE X</span>)</span> 2</span>)</span></span>)</span></span>)</span>
..   where
..     X = 1</span></code></pre>
<p>If <a href="#TRY:CAPTURE%20MGL-PAX:MACRO" title="TRY:CAPTURE MGL-PAX:MACRO"><code>capture</code></a> showing up in the form that <a href="#TRY:IS%20MGL-PAX:MACRO" title="TRY:IS MGL-PAX:MACRO"><code>is</code></a> prints is undesirable,
then <a href="#TRY:%25%20MACROLET" title="TRY:% MACROLET"><code>%</code></a> may be used instead:</p>
<pre><code><span class="code"><span class="paren1">(<span class="code">is <span class="paren2">(<span class="code"><i><span class="symbol">let</span></i> <span class="paren3">(<span class="code"><span class="paren4">(<span class="code">x 1</span>)</span></span>)</span>
      <span class="paren3">(<span class="code">= <span class="paren4">(<span class="code">% x</span>)</span> 2</span>)</span></span>)</span></span>)</span>
.. debugger invoked on UNEXPECTED-RESULT-FAILURE:
..   UNEXPECTED-FAILURE in check:
..     <span class="paren1">(<span class="code">IS
..      <span class="paren2">(<span class="code"><i><span class="symbol">LET</span></i> <span class="paren3">(<span class="code"><span class="paren4">(<span class="code">X 1</span>)</span></span>)</span>
..        <span class="paren3">(<span class="code">= X 2</span>)</span></span>)</span></span>)</span>
..   where
..     X = 1</span></code></pre>
<p>Multiple values may be captured with <a href="#TRY:CAPTURE-VALUES%20MGL-PAX:MACRO" title="TRY:CAPTURE-VALUES MGL-PAX:MACRO"><code>capture-values</code></a> and its
secretive counterpart <a href="#TRY:%25%25%20MACROLET" title="TRY:%% MACROLET"><code>%%</code></a>:</p>
<pre><code><span class="code"><span class="paren1">(<span class="code">is <span class="paren2">(<span class="code">= <span class="paren3">(<span class="code">%% <span class="paren4">(<span class="code">values 1 2</span>)</span></span>)</span> 2</span>)</span></span>)</span>
.. debugger invoked on UNEXPECTED-RESULT-FAILURE:
..   UNEXPECTED-FAILURE in check:
..     <span class="paren1">(<span class="code">IS <span class="paren2">(<span class="code">= #1=<span class="paren3">(<span class="code">VALUES 1 2</span>)</span> 2</span>)</span></span>)</span>
..   where
..     #1# == 1
..            2</span></code></pre>
<p>where printing <code>==</code> instead of = indicates that this
is a multiple value capture.</p>
<p><a id="x-28TRY-3ACAPTURE-20MGL-PAX-3AMACRO-29"></a>
<a id="TRY:CAPTURE%20MGL-PAX:MACRO"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/is.lisp#L274">[macro]</a></span> <span class="reference-object"><a href="#TRY:CAPTURE%20MGL-PAX:MACRO" >capture</a></span></span> <span class="locative-args">form</span></span></p>

<p>Evaluate <code>form</code>, record its primary return value if within the
dynamic extent of an <a href="#TRY:IS%20MGL-PAX:MACRO" title="TRY:IS MGL-PAX:MACRO"><code>is</code></a> evaluation, and finally return that value.
If <code>capture</code> is used within the lexical scope of <code>is</code>, then <code>capture</code>
itself will show up in the form that the default <code>msg</code> prints. Thus it
is recommended to use the equivalent <a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_flet_.htm" title="MACROLET (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>macrolet</code></a> <a href="#TRY:%25%20MACROLET" title="TRY:% MACROLET"><code>%</code></a> in the lexical
scope as <code>%</code> is removed before printing.</p></li>
</ul>
<p><a id="x-28TRY-3ACAPTURE-VALUES-20MGL-PAX-3AMACRO-29"></a>
<a id="TRY:CAPTURE-VALUES%20MGL-PAX:MACRO"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/is.lisp#L287">[macro]</a></span> <span class="reference-object"><a href="#TRY:CAPTURE-VALUES%20MGL-PAX:MACRO" >capture-values</a></span></span> <span class="locative-args">form</span></span></p>

<p>Like <code>capture-values</code>, but record and return all values returned by
<code>form</code>. It is recommended to use the equivalent <a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_flet_.htm" title="MACROLET (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>macrolet</code></a> <a href="#TRY:%25%25%20MACROLET" title="TRY:%% MACROLET"><code>%%</code></a> in the
lexical scope as <code>%%</code> is removed before printing.</p></li>
</ul>
<p><a id="x-28TRY-3A-25-20MACROLET-29"></a>
<a id="TRY:%25%20MACROLET"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/is.lisp#L301">[macrolet]</a></span> <span class="reference-object"><a href="#TRY:%25%20MACROLET" >%</a></span></span> <span class="locative-args">form</span></span></p>

<p>An alias for <a href="#TRY:CAPTURE%20MGL-PAX:MACRO" title="TRY:CAPTURE MGL-PAX:MACRO"><code>capture</code></a> in the lexical scope of <a href="#TRY:IS%20MGL-PAX:MACRO" title="TRY:IS MGL-PAX:MACRO"><code>is</code></a>. Removed from the
<code>is</code> form when printed.</p></li>
</ul>
<p><a id="x-28TRY-3A-25-25-20MACROLET-29"></a>
<a id="TRY:%25%25%20MACROLET"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/is.lisp#L305">[macrolet]</a></span> <span class="reference-object"><a href="#TRY:%25%25%20MACROLET" >%%</a></span></span> <span class="locative-args">form</span></span></p>

<p>An alias for <a href="#TRY:CAPTURE-VALUES%20MGL-PAX:MACRO" title="TRY:CAPTURE-VALUES MGL-PAX:MACRO"><code>capture-values</code></a> in the lexical scope of <a href="#TRY:IS%20MGL-PAX:MACRO" title="TRY:IS MGL-PAX:MACRO"><code>is</code></a>. Removed
from the <code>is</code> form when printed.</p></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FCHECK-LIBRARY-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FCHECK-LIBRARY%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FEXPLICIT-CAPTURES%20MGL-PAX:SECTION" title="Explicit Captures">&#8592;</a> <a href="try-manual.html" title="Try Manual">&#8593;</a> <a href="#TRY:@TRY%2FCHECKING-CONDITIONS%20MGL-PAX:SECTION" title="Checking Conditions">&#8594;</a> <a href="#TRY:@TRY%2FCHECK-LIBRARY%20MGL-PAX:SECTION" title="Check Library">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/checks.lisp#L5">&#955;</a></span></span></p>
<h2><a href="#TRY:@TRY%2FCHECK-LIBRARY%20MGL-PAX:SECTION">7 Check Library</a></h2>
<p>In the following, various checks built on top of <a href="#TRY:IS%20MGL-PAX:MACRO" title="TRY:IS MGL-PAX:MACRO"><code>is</code></a> are described.
Many of them share a number of arguments, which are described here.</p>
<ul>
<li><p><code>on-return</code> is a boolean that determines whether the check in a
  macro that wraps <code>body</code> is made when <code>body</code> returns normally.</p></li>
<li><p><code>on-nlx</code> is a boolean that determines whether the check in a macro
  that wraps <code>body</code> is made when <code>body</code> performs a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_n.htm#non-local_exit" title="&quot;non-local exit&quot; (MGL-PAX:CLHS MGL-PAX:GLOSSARY-TERM)">non-local exit</a>.</p></li>
<li><p><code>msg</code> and <code>ctx</code> are <a href="#TRY:@TRY%2FFORMAT-SPECIFIER-FORMS%20MGL-PAX:SECTION" title="Format Specifier Forms">Format Specifier Forms</a> as in <code>is</code>.</p></li>
<li><p><code>name</code> may be provided so that it is printed (with <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_wr_pr.htm" title="PRIN1 (MGL-PAX:CLHS FUNCTION)"><code>prin1</code></a>) instead of
  <code>body</code> in <code>msg</code>.</p></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FCHECKING-CONDITIONS-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FCHECKING-CONDITIONS%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FCHECK-LIBRARY%20MGL-PAX:SECTION" title="Check Library">&#8592;</a> <a href="#TRY:@TRY%2FCHECK-LIBRARY%20MGL-PAX:SECTION" title="Check Library">&#8593;</a> <a href="#TRY:@TRY%2FMISC-CHECKS%20MGL-PAX:SECTION" title="Miscellaneous Checks">&#8594;</a> <a href="#TRY:@TRY%2FCHECKING-CONDITIONS%20MGL-PAX:SECTION" title="Checking Conditions">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/checks.lisp#L24">&#955;</a></span></span></p>
<h3><a href="#TRY:@TRY%2FCHECKING-CONDITIONS%20MGL-PAX:SECTION">7.1 Checking Conditions</a></h3>
<p>The macros <a href="#TRY:SIGNALS%20MGL-PAX:MACRO" title="TRY:SIGNALS MGL-PAX:MACRO"><code>signals</code></a>, <a href="#TRY:SIGNALS-NOT%20MGL-PAX:MACRO" title="TRY:SIGNALS-NOT MGL-PAX:MACRO"><code>signals-not</code></a>, <a href="#TRY:INVOKES-DEBUGGER%20MGL-PAX:MACRO" title="TRY:INVOKES-DEBUGGER MGL-PAX:MACRO"><code>invokes-debugger</code></a>, and
<a href="#TRY:INVOKES-DEBUGGER-NOT%20MGL-PAX:MACRO" title="TRY:INVOKES-DEBUGGER-NOT MGL-PAX:MACRO"><code>invokes-debugger-not</code></a> all check whether a condition of a given type,
possibly also matching a predicate, was signalled. In addition to
those already described in <a href="#TRY:@TRY%2FCHECK-LIBRARY%20MGL-PAX:SECTION" title="Check Library">Check Library</a>, these macros share a
number of arguments.</p>
<p>Matching conditions are those that are of type <code>condition-type</code> (not
evaluated) and satisfy the predicate <code>pred</code>.</p>
<p>When <code>pred</code> is <code>nil</code>, it always matches. When it is a string, then it
matches if it is a substring of the printed representation of the
condition being handled (by <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_wr_pr.htm" title="PRINC (MGL-PAX:CLHS FUNCTION)"><code>princ</code></a> under <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_w_std_.htm" title="WITH-STANDARD-IO-SYNTAX (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>with-standard-io-syntax</code></a>).
When it is a function, it matches if it returns true when called
with the condition as its argument.</p>
<p>The check is performed in the cleanup form of an <a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_unwind.htm" title="UNWIND-PROTECT (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>unwind-protect</code></a>
around <code>body</code>.</p>
<p><code>handler</code> is called when a matching condition is found. It can be a
function, <code>t</code>, or <code>nil</code>. When it is a function, it is called from the
condition handler (<code>signals</code> and <code>signals-not</code>) or the debugger
hook (invokes-debugger and <code>invokes-debugger-not</code>) with the matching
condition. <code>handler</code> may perform a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_n.htm#non-local_exit" title="&quot;non-local exit&quot; (MGL-PAX:CLHS MGL-PAX:GLOSSARY-TERM)">non-local exit</a>. When <code>handler</code> is <code>t</code>,
the matching condition is handled by performing a non-local exit to
just outside <code>body</code>. If the exit completes, <code>body</code> is treated as if it
had returned normally, and <code>on-return</code> is consulted. When <code>handler</code> is
<code>nil</code>, no addition action is performed when a matching condition is
found.</p>
<p>The default <code>ctx</code> describes the result of the matching process in
terms of <a href="#TRY:*CONDITION-MATCHED-P*%20VARIABLE" title="TRY:*CONDITION-MATCHED-P* VARIABLE"><code>*condition-matched-p*</code></a> and <a href="#TRY:*BEST-MATCHING-CONDITION*%20VARIABLE" title="TRY:*BEST-MATCHING-CONDITION* VARIABLE"><code>*best-matching-condition*</code></a>.</p>
<p><a id="x-28TRY-3A-2ACONDITION-MATCHED-P-2A-20VARIABLE-29"></a>
<a id="TRY:*CONDITION-MATCHED-P*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/checks.lisp#L87">[variable]</a></span> <span class="reference-object"><a href="#TRY:*CONDITION-MATCHED-P*%20VARIABLE" >*condition-matched-p*</a></span></span></span></p>

<p>When a check described in <a href="#TRY:@TRY%2FCHECKING-CONDITIONS%20MGL-PAX:SECTION" title="Checking Conditions">Checking Conditions</a> signals its
<a href="#TRY:OUTCOME%20CONDITION" title="TRY:OUTCOME CONDITION"><code>outcome</code></a>, this variable is bound to a boolean value to indicate
whether a condition that matched <code>condition-type</code> and <code>pred</code> was
found.</p></li>
</ul>
<p><a id="x-28TRY-3A-2ABEST-MATCHING-CONDITION-2A-20VARIABLE-29"></a>
<a id="TRY:*BEST-MATCHING-CONDITION*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/checks.lisp#L94">[variable]</a></span> <span class="reference-object"><a href="#TRY:*BEST-MATCHING-CONDITION*%20VARIABLE" >*best-matching-condition*</a></span></span></span></p>

<p>Bound when a check described in <a href="#TRY:@TRY%2FCHECKING-CONDITIONS%20MGL-PAX:SECTION" title="Checking Conditions">Checking Conditions</a>
signals its <a href="#TRY:OUTCOME%20CONDITION" title="TRY:OUTCOME CONDITION"><code>outcome</code></a>. If <a href="#TRY:*CONDITION-MATCHED-P*%20VARIABLE" title="TRY:*CONDITION-MATCHED-P* VARIABLE"><code>*condition-matched-p*</code></a>, then it is the
most recent condition that matched both <code>condition-type</code> and <code>pred</code>.
Else, it is the most recent condition that matched
<code>condition-type</code> or <code>nil</code> if no such conditions were detected.</p></li>
</ul>
<p><a id="x-28TRY-3ASIGNALS-20MGL-PAX-3AMACRO-29"></a>
<a id="TRY:SIGNALS%20MGL-PAX:MACRO"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/checks.lisp#L152">[macro]</a></span> <span class="reference-object"><a href="#TRY:SIGNALS%20MGL-PAX:MACRO" >signals</a></span></span> <span class="locative-args">(condition-type &amp;key pred (handler t) (on-return t) (on-nlx t) name msg ctx) &amp;body body</span></span></p>

<p>Check that <code>body</code> signals a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/e_cnd.htm" title="CONDITION (MGL-PAX:CLHS CONDITION)"><code>condition</code></a> of <code>condition-type</code> (not
evaluated) that matches <code>pred</code>. To detect matching conditions, <code>signals</code>
sets up a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_handle.htm" title="HANDLER-BIND (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>handler-bind</code></a>. Thus it can only see what <code>body</code> does not
handle. The arguments are described in <a href="#TRY:@TRY%2FCHECKING-CONDITIONS%20MGL-PAX:SECTION" title="Checking Conditions">Checking Conditions</a>.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code">signals <span class="paren2">(<span class="code">error</span>)</span>
  <span class="paren2">(<span class="code">error <span class="string">"xxx"</span></span>)</span></span>)</span>
=&gt; NIL</span></code></pre>

<p>The following example shows a failure where <code>condition-type</code> matches
but <code>pred</code> does not.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code">signals <span class="paren2">(<span class="code">error <span class="keyword">:pred</span> <span class="string">"non-matching"</span></span>)</span>
  <span class="paren2">(<span class="code">error <span class="string">"xxx"</span></span>)</span></span>)</span>
.. debugger invoked on UNEXPECTED-RESULT-FAILURE:
..   UNEXPECTED-FAILURE in check:
..     <span class="paren1">(<span class="code">ERROR <span class="string">"xxx"</span></span>)</span> signals a condition of type ERROR that matches
..     "non-matching".
..   The predicate did not match "xxx".</span></code></pre></li>
</ul>
<p><a id="x-28TRY-3ASIGNALS-NOT-20MGL-PAX-3AMACRO-29"></a>
<a id="TRY:SIGNALS-NOT%20MGL-PAX:MACRO"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/checks.lisp#L207">[macro]</a></span> <span class="reference-object"><a href="#TRY:SIGNALS-NOT%20MGL-PAX:MACRO" >signals-not</a></span></span> <span class="locative-args">(condition-type &amp;key pred (handler t) (on-return t) (on-nlx t) name msg ctx) &amp;body body</span></span></p>

<p>Check that <code>body</code> does not signal a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/e_cnd.htm" title="CONDITION (MGL-PAX:CLHS CONDITION)"><code>condition</code></a> of <code>condition-type</code> (not
evaluated) that matches <code>pred</code>. To detect matching conditions,
<code>signals-not</code> sets up a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_handle.htm" title="HANDLER-BIND (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>handler-bind</code></a>. Thus, it can only see what <code>body</code>
does not handle. The arguments are described in
<a href="#TRY:@TRY%2FCHECKING-CONDITIONS%20MGL-PAX:SECTION" title="Checking Conditions">Checking Conditions</a>.</p></li>
</ul>
<p><a id="x-28TRY-3AINVOKES-DEBUGGER-20MGL-PAX-3AMACRO-29"></a>
<a id="TRY:INVOKES-DEBUGGER%20MGL-PAX:MACRO"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/checks.lisp#L238">[macro]</a></span> <span class="reference-object"><a href="#TRY:INVOKES-DEBUGGER%20MGL-PAX:MACRO" >invokes-debugger</a></span></span> <span class="locative-args">(condition-type &amp;key pred (handler t) (on-return t) (on-nlx t) name msg ctx) &amp;body body</span></span></p>

<p>Check that <code>body</code> enters the debugger with a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/e_cnd.htm" title="CONDITION (MGL-PAX:CLHS CONDITION)"><code>condition</code></a> of
<code>condition-type</code> (not evaluated) that matches <code>pred</code>. To detect matching
conditions, <code>invokes-debugger</code> sets up a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/v_debugg.htm" title="*DEBUGGER-HOOK* (MGL-PAX:CLHS VARIABLE)"><code>*debugger-hook*</code></a>. Thus, if
<code>*debugger-hook*</code> is changed by <code>body</code>, it may not detect the condition.
The arguments are described in <a href="#TRY:@TRY%2FCHECKING-CONDITIONS%20MGL-PAX:SECTION" title="Checking Conditions">Checking Conditions</a>.</p>

<p>Note that in a trial (see <a href="#TRY:CURRENT-TRIAL%20FUNCTION" title="TRY:CURRENT-TRIAL FUNCTION"><code>current-trial</code></a>), all <code>error</code>(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/e_error.htm" title="ERROR (MGL-PAX:CLHS CONDITION)"><code>0</code></a> <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_error.htm" title="ERROR (MGL-PAX:CLHS FUNCTION)"><code>1</code></a>)s are handled,
and a <code>*debugger-hook*</code> is set up (see <a href="#TRY:UNHANDLED-ERROR%20CONDITION" title="TRY:UNHANDLED-ERROR CONDITION"><code>unhandled-error</code></a>). Thus,
invoking debugger would normally cause the trial to abort.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code">invokes-debugger <span class="paren2">(<span class="code">error <span class="keyword">:pred</span> <span class="string">"xxx"</span></span>)</span>
  <span class="paren2">(<span class="code">handler-bind <span class="paren3">(<span class="code"><span class="paren4">(<span class="code">error #'invoke-debugger</span>)</span></span>)</span>
    <span class="paren3">(<span class="code">error <span class="string">"xxx"</span></span>)</span></span>)</span></span>)</span>
=&gt; NIL</span></code></pre></li>
</ul>
<p><a id="x-28TRY-3AINVOKES-DEBUGGER-NOT-20MGL-PAX-3AMACRO-29"></a>
<a id="TRY:INVOKES-DEBUGGER-NOT%20MGL-PAX:MACRO"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/checks.lisp#L291">[macro]</a></span> <span class="reference-object"><a href="#TRY:INVOKES-DEBUGGER-NOT%20MGL-PAX:MACRO" >invokes-debugger-not</a></span></span> <span class="locative-args">(condition-type &amp;key pred (handler t) (on-return t) (on-nlx t) name msg ctx) &amp;body body</span></span></p>

<p>Check that <code>body</code> does not enter the debugger with a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/e_cnd.htm" title="CONDITION (MGL-PAX:CLHS CONDITION)"><code>condition</code></a> of
<code>condition-type</code> (not evaluated) that matches <code>pred</code>. To detect matching
conditions, <code>invokes-debugger-not</code> sets up a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/v_debugg.htm" title="*DEBUGGER-HOOK* (MGL-PAX:CLHS VARIABLE)"><code>*debugger-hook*</code></a>. Thus, if
<code>*debugger-hook*</code> is changed by <code>body</code>, it may not detect the condition.
The arguments are described in <a href="#TRY:@TRY%2FCHECKING-CONDITIONS%20MGL-PAX:SECTION" title="Checking Conditions">Checking Conditions</a>.</p></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FMISC-CHECKS-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FMISC-CHECKS%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FCHECKING-CONDITIONS%20MGL-PAX:SECTION" title="Checking Conditions">&#8592;</a> <a href="#TRY:@TRY%2FCHECK-LIBRARY%20MGL-PAX:SECTION" title="Check Library">&#8593;</a> <a href="#TRY:@TRY%2FCHECK-UTILITIES%20MGL-PAX:SECTION" title="Check Utilities">&#8594;</a> <a href="#TRY:@TRY%2FMISC-CHECKS%20MGL-PAX:SECTION" title="Miscellaneous Checks">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/checks.lisp#L322">&#955;</a></span></span></p>
<h3><a href="#TRY:@TRY%2FMISC-CHECKS%20MGL-PAX:SECTION">7.2 Miscellaneous Checks</a></h3>
<p><a id="x-28TRY-3AFAILS-20MGL-PAX-3AMACRO-29"></a>
<a id="TRY:FAILS%20MGL-PAX:MACRO"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/checks.lisp#L328">[macro]</a></span> <span class="reference-object"><a href="#TRY:FAILS%20MGL-PAX:MACRO" >fails</a></span></span> <span class="locative-args">(&amp;key name msg ctx) &amp;body body</span></span></p>

<p>Check that <code>body</code> performs a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_n.htm#non-local_exit" title="&quot;non-local exit&quot; (MGL-PAX:CLHS MGL-PAX:GLOSSARY-TERM)">non-local exit</a> but do not
cancel it (see <a href="#TRY:@CANCELLED-NLX%20MGL-PAX:GLOSSARY-TERM" title="cancelled non-local exit">cancelled non-local exit</a>). See <a href="#TRY:@TRY%2FCHECK-LIBRARY%20MGL-PAX:SECTION" title="Check Library">Check Library</a> for the
descriptions of the other arguments.</p>

<p>In the following example, <code>fails</code> signals a <a href="#TRY:SUCCESS%20CONDITION" title="TRY:SUCCESS CONDITION"><code>success</code></a>.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">catch</span></i> 'foo
  <span class="paren2">(<span class="code">fails <span class="paren3">(<span class="code"></span>)</span>
    <span class="paren3">(<span class="code"><i><span class="symbol">throw</span></i> 'foo 7</span>)</span></span>)</span></span>)</span>
=&gt; 7</span></code></pre>

<p>Next, <code>fails</code> signals an <a href="#TRY:UNEXPECTED-FAILURE%20TYPE" title="TRY:UNEXPECTED-FAILURE TYPE"><code>unexpected-failure</code></a> because <code>body</code> returns
normally.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code">fails <span class="paren2">(<span class="code"></span>)</span>
  <span class="paren2">(<span class="code">print 'hey</span>)</span></span>)</span>
..
.. HEY 
.. debugger invoked on UNEXPECTED-RESULT-FAILURE:
..   UNEXPECTED-FAILURE in check:
..     <span class="paren1">(<span class="code">PRINT 'HEY</span>)</span> does not return normally.</span></code></pre>

<p>Note that there is no <code>fails-not</code> as <a href="#TRY:WITH-TEST%20MGL-PAX:MACRO" title="TRY:WITH-TEST MGL-PAX:MACRO"><code>with-test</code></a> fills that role.</p></li>
</ul>
<p><a id="x-28TRY-3AIN-TIME-20MGL-PAX-3AMACRO-29"></a>
<a id="TRY:IN-TIME%20MGL-PAX:MACRO"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/checks.lisp#L378">[macro]</a></span> <span class="reference-object"><a href="#TRY:IN-TIME%20MGL-PAX:MACRO" >in-time</a></span></span> <span class="locative-args">(seconds &amp;key (on-return t) (on-nlx t) name msg ctx) &amp;body body</span></span></p>

<p>Check that <code>body</code> finishes in <code>seconds</code>. See <a href="#TRY:@TRY%2FCHECK-LIBRARY%20MGL-PAX:SECTION" title="Check Library">Check Library</a> for
the descriptions of the other arguments.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code">in-time <span class="paren2">(<span class="code">1</span>)</span>
  <span class="paren2">(<span class="code">sleep 2</span>)</span></span>)</span>
.. debugger invoked on UNEXPECTED-RESULT-FAILURE:
..   UNEXPECTED-FAILURE in check:
..     <span class="paren1">(<span class="code">SLEEP 2</span>)</span> finishes within 1s.
..   Took 2.000s.</span></code></pre>

<p><a href="#TRY:RETRY-CHECK%20FUNCTION" title="TRY:RETRY-CHECK FUNCTION"><code>retry-check</code></a> restarts timing.</p></li>
</ul>
<p><a id="x-28TRY-3A-2AIN-TIME-ELAPSED-SECONDS-2A-20VARIABLE-29"></a>
<a id="TRY:*IN-TIME-ELAPSED-SECONDS*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/checks.lisp#L414">[variable]</a></span> <span class="reference-object"><a href="#TRY:*IN-TIME-ELAPSED-SECONDS*%20VARIABLE" >*in-time-elapsed-seconds*</a></span></span></span></p>

<p>Bound to the number of seconds passed during the evaluation of
<code>body</code> when <a href="#TRY:IN-TIME%20MGL-PAX:MACRO" title="TRY:IN-TIME MGL-PAX:MACRO"><code>in-time</code></a> signals its <a href="#TRY:OUTCOME%20CONDITION" title="TRY:OUTCOME CONDITION"><code>outcome</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FCHECK-UTILITIES-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FCHECK-UTILITIES%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FMISC-CHECKS%20MGL-PAX:SECTION" title="Miscellaneous Checks">&#8592;</a> <a href="#TRY:@TRY%2FCHECK-LIBRARY%20MGL-PAX:SECTION" title="Check Library">&#8593;</a> <a href="#TRY:@TRY%2FCOMPARING-FLOATS%20MGL-PAX:SECTION" title="Comparing Floats">&#8594;</a> <a href="#TRY:@TRY%2FCHECK-UTILITIES%20MGL-PAX:SECTION" title="Check Utilities">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/checks.lisp#L420">&#955;</a></span></span></p>
<h3><a href="#TRY:@TRY%2FCHECK-UTILITIES%20MGL-PAX:SECTION">7.3 Check Utilities</a></h3>
<p>These utilities are not checks (which signal <a href="#TRY:OUTCOME%20CONDITION" title="TRY:OUTCOME CONDITION"><code>outcome</code></a>s) but simple
functions and macros that may be useful for writing <a href="#TRY:IS%20MGL-PAX:MACRO" title="TRY:IS MGL-PAX:MACRO"><code>is</code></a> checks.</p>
<p><a id="x-28TRY-3AON-VALUES-20MGL-PAX-3AMACRO-29"></a>
<a id="TRY:ON-VALUES%20MGL-PAX:MACRO"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/util.lisp#L159">[macro]</a></span> <span class="reference-object"><a href="#TRY:ON-VALUES%20MGL-PAX:MACRO" >on-values</a></span></span> <span class="locative-args">form &amp;body body</span></span></p>

<p><code>on-values</code> evaluates <code>form</code> and transforms its return values one by
one based on forms in <code>body</code>. The Nth value is replaced by the return
value of the Nth form of <code>body</code> evaluated with <code>*</code> bound
to the Nth value. If the number of values exceeds the number of
transformation forms in <code>body</code> then the excess values are returned as
is.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code">on-values <span class="paren2">(<span class="code">values 1 <span class="string">"abc"</span> 7</span>)</span>
  <span class="paren2">(<span class="code">1+ *</span>)</span>
  <span class="paren2">(<span class="code">length *</span>)</span></span>)</span>
=&gt; 2
=&gt; 3
=&gt; 7</span></code></pre>

<p>If the number of values is less than the number of transformation
forms, then in later transformation forms <code>*</code> is bound
to <code>nil</code>.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code">on-values <span class="paren2">(<span class="code">values</span>)</span>
  *
  *</span>)</span>
=&gt; NIL
=&gt; NIL</span></code></pre>

<p>The first forms in <code>body</code> may be options. Options must precede
transformation forms. With <code>:truncate</code> <code>t</code>, the excess values are
discarded.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code">on-values <span class="paren2">(<span class="code">values 1 <span class="string">"abc"</span> 7</span>)</span>
  <span class="paren2">(<span class="code"><span class="keyword">:truncate</span> t</span>)</span>
  <span class="paren2">(<span class="code">1+ *</span>)</span>
  <span class="paren2">(<span class="code">length *</span>)</span></span>)</span>
=&gt; 2
=&gt; 3</span></code></pre>

<p>The <code>:on-length-mismatch</code> option may be <code>nil</code> or a function of a single
argument. If the number of values and the number of transformation
forms are different, then this function is called to transform the
list of values. <code>:truncate</code> is handled before <code>:on-length-mismatch</code>.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code">on-values 1
  <span class="paren2">(<span class="code"><span class="keyword">:on-length-mismatch</span> <span class="paren3">(<span class="code"><i><span class="symbol">lambda</span></i> <span class="paren4">(<span class="code">values</span>)</span>
                         <span class="paren4">(<span class="code"><i><span class="symbol">if</span></i> <span class="paren5">(<span class="code">= <span class="paren6">(<span class="code">length values</span>)</span> 1</span>)</span>
                             <span class="paren5">(<span class="code">append values '<span class="paren6">(<span class="code"><span class="string">"abc"</span></span>)</span></span>)</span>
                             values</span>)</span></span>)</span></span>)</span>
  <span class="paren2">(<span class="code">1+ *</span>)</span>
  *</span>)</span>
=&gt; 2
=&gt; "abc"</span></code></pre>

<p>If the same option is specified multiple times, the first one is in
effect.</p></li>
</ul>
<p><a id="x-28TRY-3AMATCH-VALUES-20MGL-PAX-3AMACRO-29"></a>
<a id="TRY:MATCH-VALUES%20MGL-PAX:MACRO"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/checks.lisp#L431">[macro]</a></span> <span class="reference-object"><a href="#TRY:MATCH-VALUES%20MGL-PAX:MACRO" >match-values</a></span></span> <span class="locative-args">form &amp;body body</span></span></p>

<p><code>match-values</code> returns true iff all return values of <code>form</code> satisfy
the predicates given by <code>body</code>, which are described in <a href="#TRY:ON-VALUES%20MGL-PAX:MACRO" title="TRY:ON-VALUES MGL-PAX:MACRO"><code>on-values</code></a>. The
<code>:truncate</code> option of <code>on-values</code> is supported, but <code>:on-length-mismatch</code>
always returns <code>nil</code>.</p>

<pre><code><span class="code"><span class="comment">;; no values
</span><span class="paren1">(<span class="code">is <span class="paren2">(<span class="code">match-values <span class="paren3">(<span class="code">values</span>)</span></span>)</span></span>)</span>
<span class="comment">;; single value success
</span><span class="paren1">(<span class="code">is <span class="paren2">(<span class="code">match-values 1
      <span class="paren3">(<span class="code">= * 1</span>)</span></span>)</span></span>)</span>
<span class="comment">;; success with different types
</span><span class="paren1">(<span class="code">is <span class="paren2">(<span class="code">match-values <span class="paren3">(<span class="code">values 1 <span class="string">"sdf"</span></span>)</span>
      <span class="paren3">(<span class="code">= * 1</span>)</span>
      <span class="paren3">(<span class="code">string= * <span class="string">"sdf"</span></span>)</span></span>)</span></span>)</span>
<span class="comment">;; too few values
</span><span class="paren1">(<span class="code">is <span class="paren2">(<span class="code">not <span class="paren3">(<span class="code">match-values 1
           <span class="paren4">(<span class="code">= * 1</span>)</span>
           <span class="paren4">(<span class="code">string= * <span class="string">"sdf"</span></span>)</span></span>)</span></span>)</span></span>)</span>
<span class="comment">;; too many values
</span><span class="paren1">(<span class="code">is <span class="paren2">(<span class="code">not <span class="paren3">(<span class="code">match-values <span class="paren4">(<span class="code">values 1 <span class="string">"sdf"</span> 3</span>)</span>
           <span class="paren4">(<span class="code">= * 1</span>)</span>
           <span class="paren4">(<span class="code">string= * <span class="string">"sdf"</span></span>)</span></span>)</span></span>)</span></span>)</span>
<span class="comment">;; too many values, but truncated
</span><span class="paren1">(<span class="code">is <span class="paren2">(<span class="code">match-values <span class="paren3">(<span class="code">values 1 <span class="string">"sdf"</span> 3</span>)</span>
      <span class="paren3">(<span class="code"><span class="keyword">:truncate</span> t</span>)</span>
      <span class="paren3">(<span class="code">= * 1</span>)</span>
      <span class="paren3">(<span class="code">string= * <span class="string">"sdf"</span></span>)</span></span>)</span></span>)</span></span></code></pre></li>
</ul>
<p><a id="x-28TRY-3AMISMATCH-25-20FUNCTION-29"></a>
<a id="TRY:MISMATCH%25%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/checks.lisp#L482">[function]</a></span> <span class="reference-object"><a href="#TRY:MISMATCH%25%20FUNCTION" >mismatch%</a></span></span> <span class="locative-args">sequence1 sequence2 &amp;key from-end (test #'eql) (start1 0) end1 (start2 0) end2 key max-prefix-length max-suffix-length</span></span></p>

<p>Like <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_mismat.htm" title="MISMATCH (MGL-PAX:CLHS FUNCTION)"><code>cl:mismatch</code></a> but <a href="#TRY:CAPTURE%20MGL-PAX:MACRO" title="TRY:CAPTURE MGL-PAX:MACRO"><code>capture</code></a>s and returns the common prefix and
the mismatched suffixes. The <code>test-not</code> argument is deprecated by
the <a href="pax-manual.html#MGL-PAX:CLHS%20MGL-PAX:LOCATIVE" title="MGL-PAX:CLHS MGL-PAX:LOCATIVE"><code>clhs</code></a> and is not supported. In addition, if <code>max-prefix-length</code> and
<code>max-suffix-length</code> are non-<code>nil</code>, they must be non-negative integers,
and they limit the number of elements in the prefix and the
suffixes.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code">is <span class="paren2">(<span class="code">null <span class="paren3">(<span class="code">mismatch% '<span class="paren4">(<span class="code">1 2 3</span>)</span> '<span class="paren4">(<span class="code">1 2 4 5</span>)</span></span>)</span></span>)</span></span>)</span>
.. debugger invoked on UNEXPECTED-RESULT-FAILURE:
..   UNEXPECTED-FAILURE in check:
..     <span class="paren1">(<span class="code">IS <span class="paren2">(<span class="code">NULL #1=<span class="paren3">(<span class="code">MISMATCH% '<span class="paren4">(<span class="code">1 2 3</span>)</span> '<span class="paren4">(<span class="code">1 2 4 5</span>)</span></span>)</span></span>)</span></span>)</span>
..   where
..     COMMON-PREFIX = <span class="paren1">(<span class="code">1 2</span>)</span>
..     MISMATCHED-SUFFIX-1 = <span class="paren1">(<span class="code">3</span>)</span>
..     MISMATCHED-SUFFIX-2 = <span class="paren1">(<span class="code">4 5</span>)</span>
..     #1# = 2</span></code></pre>

<pre><code><span class="code"><span class="paren1">(<span class="code">is <span class="paren2">(<span class="code">null <span class="paren3">(<span class="code">mismatch% <span class="string">"Hello, World!"</span>
                     <span class="string">"Hello, world!"</span></span>)</span></span>)</span></span>)</span>
.. debugger invoked on UNEXPECTED-RESULT-FAILURE:
..   UNEXPECTED-FAILURE in check:
..     <span class="paren1">(<span class="code">IS <span class="paren2">(<span class="code">NULL #1=<span class="paren3">(<span class="code">MISMATCH% <span class="string">"Hello, World!"</span> <span class="string">"Hello, world!"</span></span>)</span></span>)</span></span>)</span>
..   where
..     COMMON-PREFIX = "Hello, "
..     MISMATCHED-SUFFIX-1 = "World!"
..     MISMATCHED-SUFFIX-2 = "world!"
..     #1# = 7</span></code></pre></li>
</ul>
<p><a id="x-28TRY-3ADIFFERENT-ELEMENTS-20FUNCTION-29"></a>
<a id="TRY:DIFFERENT-ELEMENTS%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/checks.lisp#L545">[function]</a></span> <span class="reference-object"><a href="#TRY:DIFFERENT-ELEMENTS%20FUNCTION" >different-elements</a></span></span> <span class="locative-args">sequence1 sequence2 &amp;key (pred #'eql) (missing :missing)</span></span></p>

<p>Return the different elements under <code>pred</code> in the given sequences as
a list of <code>(:index &lt;index&gt; &lt;e1&gt; &lt;e2&gt;)</code> elements, where <code>e1</code> and <code>e2</code>
are elements of <code>sequence1</code> and <code>sequence2</code> at <code>&lt;index&gt;</code>, respectively,
and they may be <code>missing</code> if the corresponding sequence is too short.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code">is <span class="paren2">(<span class="code">endp <span class="paren3">(<span class="code">different-elements '<span class="paren4">(<span class="code">1 2 3</span>)</span> '<span class="paren4">(<span class="code">1 b 3 d</span>)</span></span>)</span></span>)</span></span>)</span>
.. debugger invoked on UNEXPECTED-RESULT-FAILURE:
..   UNEXPECTED-FAILURE in check:
..     <span class="paren1">(<span class="code">IS <span class="paren2">(<span class="code">ENDP #1=<span class="paren3">(<span class="code">DIFFERENT-ELEMENTS '<span class="paren4">(<span class="code">1 2 3</span>)</span> '<span class="paren4">(<span class="code">1 B 3 D</span>)</span></span>)</span></span>)</span></span>)</span>
..   where
..     #1# = <span class="paren1">(<span class="code"><span class="paren2">(<span class="code"><span class="keyword">:INDEX</span> 1 2 B</span>)</span> <span class="paren2">(<span class="code"><span class="keyword">:INDEX</span> 3 <span class="keyword">:MISSING</span> D</span>)</span></span>)</span></span></code></pre></li>
</ul>
<p><a id="x-28TRY-3AWITH-SHUFFLING-20MGL-PAX-3AMACRO-29"></a>
<a id="TRY:WITH-SHUFFLING%20MGL-PAX:MACRO"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/checks.lisp#L573">[macro]</a></span> <span class="reference-object"><a href="#TRY:WITH-SHUFFLING%20MGL-PAX:MACRO" >with-shuffling</a></span></span> <span class="locative-args">nil &amp;body body</span></span></p>

<p>Execute the forms that make up the list of forms <code>body</code> in random
order and return <code>nil</code>. This may be useful to prevent writing tests
that accidentally depend on the order in which subtests are called.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">loop</span></i> repeat 3 do
  <span class="paren2">(<span class="code"><i><span class="symbol">with-shuffling</span></i> <span class="paren3">(<span class="code"></span>)</span>
    <span class="paren3">(<span class="code">prin1 1</span>)</span>
    <span class="paren3">(<span class="code">prin1 2</span>)</span></span>)</span></span>)</span>
.. 122112
=&gt; NIL</span></code></pre></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FCOMPARING-FLOATS-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FCOMPARING-FLOATS%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FCHECK-UTILITIES%20MGL-PAX:SECTION" title="Check Utilities">&#8592;</a> <a href="#TRY:@TRY%2FCHECK-UTILITIES%20MGL-PAX:SECTION" title="Check Utilities">&#8593;</a> <a href="#TRY:@TRY%2FTESTS%20MGL-PAX:SECTION" title="Tests">&#8594;</a> <a href="#TRY:@TRY%2FCOMPARING-FLOATS%20MGL-PAX:SECTION" title="Comparing Floats">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/floats.lisp#L3">&#955;</a></span></span></p>
<h4><a href="#TRY:@TRY%2FCOMPARING-FLOATS%20MGL-PAX:SECTION">7.3.1 Comparing Floats</a></h4>
<p>Float comparisons following
<a href="https://randomascii.wordpress.com/2012/02/25/comparing-floating-point-numbers-2012-edition/" >https://randomascii.wordpress.com/2012/02/25/comparing-floating-point-numbers-2012-edition/</a>.</p>
<p><a id="x-28TRY-3AFLOAT--7E-3D-20FUNCTION-29"></a>
<a id="TRY:FLOAT-~%3D%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/floats.lisp#L18">[function]</a></span> <span class="reference-object"><a href="#TRY:FLOAT-~%3D%20FUNCTION" >float-~=</a></span></span> <span class="locative-args">x y &amp;key (max-diff-in-value *max-diff-in-value*) (max-diff-in-ulp *max-diff-in-ulp*)</span></span></p>

<p>Return whether two numbers, <code>x</code> and <code>y</code>, are approximately equal either
according to <code>max-diff-in-value</code> or <code>max-diff-in-ulp</code>.</p>

<p>If the absolute value of the difference of two floats is not greater
than <code>max-diff-in-value</code>, then they are considered equal.</p>

<p>If two floats are of the same sign and the number of representable
floats (ULP, unit in the last place) between them is less than
<code>max-diff-in-ulp</code>, then they are considered equal.</p>

<p>If neither <code>x</code> nor <code>y</code> are floats, then the comparison is done with <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_eq_sle.htm" title="= (MGL-PAX:CLHS FUNCTION)"><code>=</code></a>.
If one of them is a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/t_short_.htm" title="DOUBLE-FLOAT (MGL-PAX:CLHS TYPE)"><code>double-float</code></a>, then the other is converted to a
double float, and the comparison takes place in double float space.
Else, both are converted to <a href="http://www.lispworks.com/documentation/HyperSpec/Body/t_short_.htm" title="SINGLE-FLOAT (MGL-PAX:CLHS TYPE)"><code>single-float</code></a> and the comparison takes
place in single float space.</p></li>
</ul>
<p><a id="x-28TRY-3A-2AMAX-DIFF-IN-VALUE-2A-20VARIABLE-29"></a>
<a id="TRY:*MAX-DIFF-IN-VALUE*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/floats.lisp#L12">[variable]</a></span> <span class="reference-object"><a href="#TRY:*MAX-DIFF-IN-VALUE*%20VARIABLE" >*max-diff-in-value*</a></span></span> <span class="locative-args">1.0e-16</span></span></p>

<p>The default value of the <code>max-diff-in-value</code> argument of <a href="#TRY:FLOAT-~%3D%20FUNCTION" title="TRY:FLOAT-~= FUNCTION"><code>float-~=</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3A-2AMAX-DIFF-IN-ULP-2A-20VARIABLE-29"></a>
<a id="TRY:*MAX-DIFF-IN-ULP*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/floats.lisp#L15">[variable]</a></span> <span class="reference-object"><a href="#TRY:*MAX-DIFF-IN-ULP*%20VARIABLE" >*max-diff-in-ulp*</a></span></span> <span class="locative-args">2</span></span></p>

<p>The default value of the <code>max-diff-in-ulp</code> argument of <a href="#TRY:FLOAT-~%3D%20FUNCTION" title="TRY:FLOAT-~= FUNCTION"><code>float-~=</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3AFLOAT--7E-3C-20FUNCTION-29"></a>
<a id="TRY:FLOAT-~%3C%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/floats.lisp#L66">[function]</a></span> <span class="reference-object"><a href="#TRY:FLOAT-~%3C%20FUNCTION" >float-~&lt;</a></span></span> <span class="locative-args">x y &amp;key (max-diff-in-value *max-diff-in-value*) (max-diff-in-ulp *max-diff-in-ulp*)</span></span></p>

<p>Return whether <code>x</code> is approximately less than <code>y</code>. Equivalent to <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_eq_sle.htm" title="&lt; (MGL-PAX:CLHS FUNCTION)"><code>&lt;</code></a>,
but it also allows for approximate equality according to <a href="#TRY:FLOAT-~%3D%20FUNCTION" title="TRY:FLOAT-~= FUNCTION"><code>float-~=</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3AFLOAT--7E-3E-20FUNCTION-29"></a>
<a id="TRY:FLOAT-~%3E%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/floats.lisp#L76">[function]</a></span> <span class="reference-object"><a href="#TRY:FLOAT-~%3E%20FUNCTION" >float-~&gt;</a></span></span> <span class="locative-args">x y &amp;key (max-diff-in-value *max-diff-in-value*) (max-diff-in-ulp *max-diff-in-ulp*)</span></span></p>

<p>Return whether <code>x</code> is approximately greater than <code>y</code>. Equivalent to <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_eq_sle.htm" title="&gt; (MGL-PAX:CLHS FUNCTION)"><code>&gt;</code></a>,
but it also allows for approximate equality according to <a href="#TRY:FLOAT-~%3D%20FUNCTION" title="TRY:FLOAT-~= FUNCTION"><code>float-~=</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FTESTS-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FTESTS%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FCOMPARING-FLOATS%20MGL-PAX:SECTION" title="Comparing Floats">&#8592;</a> <a href="try-manual.html" title="Try Manual">&#8593;</a> <a href="#TRY:@TRY%2FIMPLICIT-TRY%20MGL-PAX:SECTION" title="Calling Test Functions">&#8594;</a> <a href="#TRY:@TRY%2FTESTS%20MGL-PAX:SECTION" title="Tests">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/test.lisp#L5">&#955;</a></span></span></p>
<h2><a href="#TRY:@TRY%2FTESTS%20MGL-PAX:SECTION">8 Tests</a></h2>
<p>In Try, tests are Lisp functions that record their execution in
<a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a> objects. <code>trial</code>s are to tests what function call traces are to
functions. In more detail, tests</p>
<ul>
<li><p>create a <code>trial</code> object and signal a <a href="#TRY:TRIAL-START%20CONDITION" title="TRY:TRIAL-START CONDITION"><code>trial-start</code></a> event upon entry to
  the function,</p></li>
<li><p>signal a <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a> condition before returning normally or via a
  <a href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_n.htm#non-local_exit" title="&quot;non-local exit&quot; (MGL-PAX:CLHS MGL-PAX:GLOSSARY-TERM)">non-local exit</a>,</p></li>
<li><p>return the <code>trial</code> object as the first value,</p></li>
<li><p>return explicitly returned values as the second, third, and so on
  values.</p></li>
</ul>
<p>See <a href="#TRY:DEFTEST%20MGL-PAX:MACRO" title="TRY:DEFTEST MGL-PAX:MACRO"><code>deftest</code></a> and <a href="#TRY:WITH-TEST%20MGL-PAX:MACRO" title="TRY:WITH-TEST MGL-PAX:MACRO"><code>with-test</code></a> for more precise descriptions.</p>
<p><a id="x-28TRY-3ADEFTEST-20MGL-PAX-3AMACRO-29"></a>
<a id="TRY:DEFTEST%20MGL-PAX:MACRO"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/test.lisp#L41">[macro]</a></span> <span class="reference-object"><a href="#TRY:DEFTEST%20MGL-PAX:MACRO" >deftest</a></span></span> <span class="locative-args">name lambda-list &amp;body body</span></span></p>

<p><code>deftest</code> is a wrapper around <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_defun.htm" title="DEFUN (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>defun</code></a> to define global test functions.
See <code>defun</code> for a description of <code>name</code>, <code>lambda-list</code>, and <code>body</code>. The
behaviour common with <a href="#TRY:WITH-TEST%20MGL-PAX:MACRO" title="TRY:WITH-TEST MGL-PAX:MACRO"><code>with-test</code></a> is described in <a href="#TRY:@TRY%2FTESTS%20MGL-PAX:SECTION" title="Tests">Tests</a>.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">deftest</span></i> my-test <span class="paren2">(<span class="code"></span>)</span>
  <span class="paren2">(<span class="code">write-string <span class="string">"hey"</span></span>)</span></span>)</span>
=&gt; MY-TEST

<span class="paren1">(<span class="code">test-bound-p 'my-test</span>)</span>
=&gt; T

<span class="paren1">(<span class="code">my-test</span>)</span>
.. hey
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code">MY-TEST</span>)</span> EXPECTED-SUCCESS 0.000s&gt;</span></code></pre>

<p>Although the common case is for tests to have no arguments, <code>deftest</code>
supports general function lambda lists. Within a global test,</p>

<ul>
<li><p><code>name</code> is bound to the <a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a> object</p></li>
<li><p>the first return value is the trial</p></li>
<li><p>values are not returned implicitly</p></li>
<li><p>values returned with an explicit <a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_ret_fr.htm" title="RETURN-FROM (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>return-from</code></a> are returned as
  values after the trial</p></li>
</ul>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">deftest</span></i> my-test <span class="paren2">(<span class="code"></span>)</span>
  <span class="paren2">(<span class="code">prin1 my-test</span>)</span>
  <span class="paren2">(<span class="code"><i><span class="symbol">return-from</span></i> my-test <span class="paren3">(<span class="code">values 2 3</span>)</span></span>)</span></span>)</span>

<span class="paren1">(<span class="code">my-test</span>)</span>
.. #&lt;TRIAL <span class="paren1">(<span class="code">MY-TEST</span>)</span> RUNNING&gt;
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code">MY-TEST</span>)</span> EXPECTED-SUCCESS 0.000s&gt;
=&gt; 2
=&gt; 3</span></code></pre></li>
</ul>
<p><a id="x-28TRY-3A-2ARUN-DEFTEST-WHEN-2A-20VARIABLE-29"></a>
<a id="TRY:*RUN-DEFTEST-WHEN*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/test.lisp#L145">[variable]</a></span> <span class="reference-object"><a href="#TRY:*RUN-DEFTEST-WHEN*%20VARIABLE" >*run-deftest-when*</a></span></span> <span class="locative-args">nil</span></span></p>

<p>This may be any of <code>:compile-toplevel</code>, <code>:load-toplevel</code>, <code>:execute</code>, or
a list thereof. The value of <code>*run-deftest-when*</code> determines in what
<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_eval_w.htm" title="EVAL-WHEN (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>eval-when</code></a> situation to call the test function immediately after it
has been defined with <a href="#TRY:DEFTEST%20MGL-PAX:MACRO" title="TRY:DEFTEST MGL-PAX:MACRO"><code>deftest</code></a>.</p>

<p>For interactive development, it may be convenient to set it to
<code>:execute</code> and have the test run when the <code>deftest</code> is evaluated (maybe
with Slime <code>C-M-x</code>, <code>slime-eval-defun</code>). Or set it to
<code>:compile-toplevel</code>, and have it rerun on Slime <code>C-c C-c</code>,
<code>slime-compile-defun</code>.</p>

<p>If the test has required arguments, an argument list is prompted for
and read from <a href="http://www.lispworks.com/documentation/HyperSpec/Body/v_debug_.htm" title="*QUERY-IO* (MGL-PAX:CLHS VARIABLE)"><code>*query-io*</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3ATEST-BOUND-P-20FUNCTION-29"></a>
<a id="TRY:TEST-BOUND-P%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/test.lisp#L369">[function]</a></span> <span class="reference-object"><a href="#TRY:TEST-BOUND-P%20FUNCTION" >test-bound-p</a></span></span> <span class="locative-args">symbol</span></span></p>

<p>See if <code>symbol</code> names a global test (i.e. a test defined with
<a href="#TRY:DEFTEST%20MGL-PAX:MACRO" title="TRY:DEFTEST MGL-PAX:MACRO"><code>deftest</code></a>). If since the execution of <code>deftest</code>, the symbol has been
<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_uninte.htm" title="UNINTERN (MGL-PAX:CLHS FUNCTION)"><code>unintern</code></a>ed, <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_fmakun.htm" title="FMAKUNBOUND (MGL-PAX:CLHS FUNCTION)"><code>fmakunbound</code></a>ed, or redefined with <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_defun.htm" title="DEFUN (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>defun</code></a>, then it no
longer names a global test.</p></li>
</ul>
<p><a id="x-28TRY-3AWITH-TEST-20MGL-PAX-3AMACRO-29"></a>
<a id="TRY:WITH-TEST%20MGL-PAX:MACRO"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/test.lisp#L200">[macro]</a></span> <span class="reference-object"><a href="#TRY:WITH-TEST%20MGL-PAX:MACRO" >with-test</a></span></span> <span class="locative-args">(&amp;optional trial-var &amp;key name) &amp;body body</span></span></p>

<p>Define a so-called lambda test to group together <code>check</code>s and other
tests it executes. <code>with-test</code> executes <code>body</code> in its lexical
environment even on a rerun (see <a href="#TRY:@TRY%2FRERUN%20MGL-PAX:SECTION" title="Rerunning Trials">Rerunning Trials</a>).</p>

<p>If <code>trial-var</code> is a non-<code>nil</code> symbol, bind it to the trial object.
<code>name</code> may be any type, it is purely for presentation purposes. If
<code>name</code> is <code>nil</code>, then it defaults to <code>trial-var</code>.</p>

<p>To facilitate returning values, a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_block.htm" title="BLOCK (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>block</code></a> is wrapped around <code>body</code>. The
name of the block is <code>trial-var</code> if it is a symbol, else it's <code>nil</code>.</p>

<p>When both <code>trial-var</code> and <code>name</code> are specified:</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren2">(<span class="code">some-feature <span class="keyword">:name</span> <span class="string">"obscure feature"</span></span>)</span>
  <span class="paren2">(<span class="code">prin1 some-feature</span>)</span>
  <span class="paren2">(<span class="code">is t</span>)</span>
  <span class="paren2">(<span class="code"><i><span class="symbol">return-from</span></i> some-feature <span class="paren3">(<span class="code">values 1 2</span>)</span></span>)</span></span>)</span>
.. #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code"><span class="string">"obscure feature"</span></span>)</span></span>)</span> RUNNING&gt;
.. obscure feature
..   ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
.. ⋅ obscure feature ⋅1
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code"><span class="string">"obscure feature"</span></span>)</span></span>)</span> EXPECTED-SUCCESS 0.002s ⋅1&gt;
=&gt; 1
=&gt; 2</span></code></pre>

<p>If only <code>trial-var</code> is specified:</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren2">(<span class="code">some-feature</span>)</span>
  <span class="paren2">(<span class="code">prin1 some-feature</span>)</span>
  <span class="paren2">(<span class="code">is t</span>)</span>
  <span class="paren2">(<span class="code"><i><span class="symbol">return-from</span></i> some-feature <span class="paren3">(<span class="code">values 1 2</span>)</span></span>)</span></span>)</span>
.. #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">SOME-FEATURE</span>)</span></span>)</span> RUNNING&gt;
.. SOME-FEATURE
..   ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
.. ⋅ SOME-FEATURE ⋅1
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">SOME-FEATURE</span>)</span></span>)</span> EXPECTED-SUCCESS 0.000s ⋅1&gt;
=&gt; 1
=&gt; 2</span></code></pre>

<p>If neither is specified:</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren2">(<span class="code"></span>)</span>
  <span class="paren2">(<span class="code">prin1 <span class="paren3">(<span class="code">current-trial</span>)</span></span>)</span>
  <span class="paren2">(<span class="code">is t</span>)</span>
  <span class="paren2">(<span class="code">return <span class="paren3">(<span class="code">values 1 2</span>)</span></span>)</span></span>)</span>
.. #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">NIL</span>)</span></span>)</span> RUNNING&gt;
.. NIL
..   ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
.. ⋅ NIL ⋅1
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">NIL</span>)</span></span>)</span> EXPECTED-SUCCESS 0.000s ⋅1&gt;
=&gt; 1
=&gt; 2</span></code></pre>

<p>Finally, using that <code>name</code> defaults to <code>trial-var</code> and that it is valid
to specify non-symbols for <code>trial-var</code>, one can also write:</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren2">(<span class="code"><span class="string">"Some feature"</span></span>)</span>
  <span class="paren2">(<span class="code">prin1 <span class="paren3">(<span class="code">current-trial</span>)</span></span>)</span>
  <span class="paren2">(<span class="code">is t</span>)</span>
  <span class="paren2">(<span class="code">return <span class="paren3">(<span class="code">values 1 2</span>)</span></span>)</span></span>)</span>
.. #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code"><span class="string">"Some feature"</span></span>)</span></span>)</span> RUNNING&gt;
.. Some feature
..   ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
.. ⋅ Some feature ⋅1
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code"><span class="string">"Some feature"</span></span>)</span></span>)</span> EXPECTED-SUCCESS 0.000s ⋅1&gt;
=&gt; 1
=&gt; 2</span></code></pre>

<p>In summary and in contrast to global tests (those defined with
<a href="#TRY:DEFTEST%20MGL-PAX:MACRO" title="TRY:DEFTEST MGL-PAX:MACRO"><code>deftest</code></a>), lambda tests</p>

<ul>
<li><p>have no arguments,</p></li>
<li><p>are defined and called at the same time,</p></li>
<li><p>may not bind their trial object to any variable,</p></li>
<li><p>may have a <code>block</code> named <code>nil</code>,</p></li>
<li><p>have a <code>name</code> purely for presentation purposes.</p></li>
</ul>

<p>Lambda tests can be thought of as analogous to <code>(funcall (lambda ()
body))</code>. The presence of the <code>lambda</code>(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_lambda.htm" title="&quot;s_lambda&quot; (MGL-PAX:CLHS MGL-PAX:SECTION)"><code>0</code></a> <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_lambda.htm" title="LAMBDA (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>1</code></a>) is important because it is
stored in the <a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a> object to support <a href="#TRY:@TRY%2FRERUN%20MGL-PAX:SECTION" title="Rerunning Trials">Rerunning Trials</a>.</p></li>
</ul>
<p><a id="x-28TRY-3ALIST-PACKAGE-TESTS-20FUNCTION-29"></a>
<a id="TRY:LIST-PACKAGE-TESTS%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/test.lisp#L381">[function]</a></span> <span class="reference-object"><a href="#TRY:LIST-PACKAGE-TESTS%20FUNCTION" >list-package-tests</a></span></span> <span class="locative-args">&amp;optional (package *package*)</span></span></p>

<p>List all symbols in <code>package</code> that name global tests in the sense of
<a href="#TRY:TEST-BOUND-P%20FUNCTION" title="TRY:TEST-BOUND-P FUNCTION"><code>test-bound-p</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3AWITH-TESTS-RUN-20MGL-PAX-3AMACRO-29"></a>
<a id="TRY:WITH-TESTS-RUN%20MGL-PAX:MACRO"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/test.lisp#L400">[macro]</a></span> <span class="reference-object"><a href="#TRY:WITH-TESTS-RUN%20MGL-PAX:MACRO" >with-tests-run</a></span></span> <span class="locative-args">(tests-run) &amp;body body</span></span></p>

<p>Bind the symbol <code>tests-run</code> to an empty <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_eq.htm" title="EQ (MGL-PAX:CLHS FUNCTION)"><code>eq</code></a> hash table and execute
<code>body</code>. The has table reflects call counts to global tests. Keys are
symbols naming global tests, and the values are the number of times
the keys have been called.</p></li>
</ul>
<p><a id="x-28TRY-3AWARN-ON-TESTS-NOT-RUN-20MGL-PAX-3AMACRO-29"></a>
<a id="TRY:WARN-ON-TESTS-NOT-RUN%20MGL-PAX:MACRO"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/test.lisp#L413">[macro]</a></span> <span class="reference-object"><a href="#TRY:WARN-ON-TESTS-NOT-RUN%20MGL-PAX:MACRO" >warn-on-tests-not-run</a></span></span> <span class="locative-args">(&amp;optional (package *package*)) &amp;body body</span></span></p>

<p>A convenience utility to that records the global tests run by <code>body</code>
with <a href="#TRY:WITH-TESTS-RUN%20MGL-PAX:MACRO" title="TRY:WITH-TESTS-RUN MGL-PAX:MACRO"><code>with-tests-run</code></a> and, when <code>body</code> finishes, signals a warning for
each global tests in <code>package</code> not run.</p>

<p>This is how Try runs its own tests:</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">defun</span></i> test <span class="paren2">(<span class="code"></span>)</span>
  <span class="comment">;; Bind *PACKAGE* so that names of tests printed have package names,
</span>  <span class="comment">;; and M-. works on them in Slime.
</span>  <span class="paren2">(<span class="code"><i><span class="symbol">let</span></i> <span class="paren3">(<span class="code"><span class="paren4">(<span class="code"><span class="special">*package*</span> <span class="paren5">(<span class="code">find-package <span class="keyword">:common-lisp</span></span>)</span></span>)</span></span>)</span>
    <span class="paren3">(<span class="code">warn-on-tests-not-run <span class="paren4">(<span class="code"><span class="paren5">(<span class="code">find-package <span class="keyword">:try</span></span>)</span></span>)</span>
      <span class="paren4">(<span class="code">print <span class="paren5">(<span class="code">try 'test-all
                  <span class="keyword">:print</span> 'unexpected
                  <span class="keyword">:describe</span> 'unexpected</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span></code></pre></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FIMPLICIT-TRY-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FIMPLICIT-TRY%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FTESTS%20MGL-PAX:SECTION" title="Tests">&#8592;</a> <a href="#TRY:@TRY%2FTESTS%20MGL-PAX:SECTION" title="Tests">&#8593;</a> <a href="#TRY:@TRY%2FEXPLICIT-TRY%20MGL-PAX:SECTION" title="Explicit `try`">&#8594;</a> <a href="#TRY:@TRY%2FIMPLICIT-TRY%20MGL-PAX:SECTION" title="Calling Test Functions">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L3">&#955;</a></span></span></p>
<h3><a href="#TRY:@TRY%2FIMPLICIT-TRY%20MGL-PAX:SECTION">8.1 Calling Test Functions</a></h3>
<p>Tests can be run explicitly by invoking the <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a> function or
implicitly by calling a test function:</p>
<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">deftest</span></i> my-test <span class="paren2">(<span class="code"></span>)</span>
  <span class="paren2">(<span class="code">is t</span>)</span></span>)</span>

<span class="paren1">(<span class="code">my-test</span>)</span>
.. MY-TEST
..   ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
.. ⋅ MY-TEST ⋅1
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code">MY-TEST</span>)</span> EXPECTED-SUCCESS 0.004s ⋅1&gt;</span></code></pre>
<p>The situation is similar with a <a href="#TRY:WITH-TEST%20MGL-PAX:MACRO" title="TRY:WITH-TEST MGL-PAX:MACRO"><code>with-test</code></a>:</p>
<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren2">(<span class="code">my-test</span>)</span>
  <span class="paren2">(<span class="code">is t</span>)</span></span>)</span>
.. MY-TEST
..   ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
.. ⋅ MY-TEST ⋅1
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">MY-TEST</span>)</span></span>)</span> EXPECTED-SUCCESS 0.000s ⋅1&gt;</span></code></pre>
<p>Behind the scenes, the outermost test function calls <code>try</code> with</p>
<pre><code><span class="code"><span class="paren1">(<span class="code">try trial <span class="keyword">:debug</span> <span class="special">*debug*</span> <span class="keyword">:collect</span> <span class="special">*collect*</span> <span class="keyword">:rerun</span> <span class="special">*rerun*</span>
     <span class="keyword">:print</span> <span class="special">*print*</span> <span class="keyword">:describe</span> <span class="special">*describe*</span>
     <span class="keyword">:stream</span> <span class="special">*stream*</span> <span class="keyword">:printer</span> <span class="special">*printer*</span></span>)</span></span></code></pre>
<p><code>try</code> then calls the test function belonging to <code>trial</code>.
The rest of the behaviour is described in <a href="#TRY:@TRY%2FEXPLICIT-TRY%20MGL-PAX:SECTION" title="Explicit `try`">Explicit <code>try</code></a>.</p>
<p><a id="x-28TRY-3A-2ADEBUG-2A-20VARIABLE-29"></a>
<a id="TRY:*DEBUG*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L50">[variable]</a></span> <span class="reference-object"><a href="#TRY:*DEBUG*%20VARIABLE" >*debug*</a></span></span> <span class="locative-args">(and unexpected (not nlx) (not verdict))</span></span></p>

<p>The default value makes <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a> invoke the debugger on <a href="#TRY:UNHANDLED-ERROR%20CONDITION" title="TRY:UNHANDLED-ERROR CONDITION"><code>unhandled-error</code></a>,
<a href="#TRY:RESULT-ABORT*%20CONDITION" title="TRY:RESULT-ABORT* CONDITION"><code>result-abort*</code></a>, <a href="#TRY:UNEXPECTED-RESULT-FAILURE%20CONDITION" title="TRY:UNEXPECTED-RESULT-FAILURE CONDITION"><code>unexpected-result-failure</code></a>, and
<a href="#TRY:UNEXPECTED-RESULT-SUCCESS%20CONDITION" title="TRY:UNEXPECTED-RESULT-SUCCESS CONDITION"><code>unexpected-result-success</code></a>. <a href="#TRY:NLX%20CONDITION" title="TRY:NLX CONDITION"><code>nlx</code></a> is excluded because it is caught as
the test function is being exited, but by that time the dynamic
environment of the actual cause is likely gone. <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a> is excluded
because it is a consequence of its child outcomes.</p></li>
</ul>
<p><a id="x-28TRY-3A-2ACOUNT-2A-20VARIABLE-29"></a>
<a id="TRY:*COUNT*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L58">[variable]</a></span> <span class="reference-object"><a href="#TRY:*COUNT*%20VARIABLE" >*count*</a></span></span> <span class="locative-args">leaf</span></span></p>

<p>Although the default value of <a href="#TRY:*CATEGORIES*%20VARIABLE" title="TRY:*CATEGORIES* VARIABLE"><code>*categories*</code></a> lumps <a href="#TRY:RESULT%20CONDITION" title="TRY:RESULT CONDITION"><code>result</code></a>s and
<a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a>s together, with the default of <a href="#TRY:LEAF%20CONDITION" title="TRY:LEAF CONDITION"><code>leaf</code></a>, <code>verdict</code>s are not
counted. See <a href="#TRY:@TRY%2FCOUNT%20MGL-PAX:SECTION" title="Counting Events">Counting Events</a>.</p></li>
</ul>
<p><a id="x-28TRY-3A-2ACOLLECT-2A-20VARIABLE-29"></a>
<a id="TRY:*COLLECT*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L63">[variable]</a></span> <span class="reference-object"><a href="#TRY:*COLLECT*%20VARIABLE" >*collect*</a></span></span> <span class="locative-args">unexpected</span></span></p>

<p>To save memory, only the <a href="#TRY:UNEXPECTED%20CONDITION" title="TRY:UNEXPECTED CONDITION"><code>unexpected</code></a> are collected by default.
See <a href="#TRY:@TRY%2FCOLLECT%20MGL-PAX:SECTION" title="Collecting Events">Collecting Events</a>.</p></li>
</ul>
<p><a id="x-28TRY-3A-2ARERUN-2A-20VARIABLE-29"></a>
<a id="TRY:*RERUN*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L67">[variable]</a></span> <span class="reference-object"><a href="#TRY:*RERUN*%20VARIABLE" >*rerun*</a></span></span> <span class="locative-args">unexpected</span></span></p>

<p>The default matches that of <a href="#TRY:*COLLECT*%20VARIABLE" title="TRY:*COLLECT* VARIABLE"><code>*collect*</code></a>. See <a href="#TRY:@TRY%2FRERUN%20MGL-PAX:SECTION" title="Rerunning Trials">Rerunning Trials</a>.</p></li>
</ul>
<p><a id="x-28TRY-3A-2APRINT-2A-20VARIABLE-29"></a>
<a id="TRY:*PRINT*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L70">[variable]</a></span> <span class="reference-object"><a href="#TRY:*PRINT*%20VARIABLE" >*print*</a></span></span> <span class="locative-args">leaf</span></span></p>

<p>With the default of <a href="#TRY:LEAF%20CONDITION" title="TRY:LEAF CONDITION"><code>leaf</code></a> combined with the default <a href="#TRY:*PRINT-PARENT*%20VARIABLE" title="TRY:*PRINT-PARENT* VARIABLE"><code>*print-parent*</code></a>
<code>t</code>, only <a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a>s with checks or <a href="#TRY:ERROR*%20CONDITION" title="TRY:ERROR* CONDITION"><code>error*</code></a> in them are printed. If
<a href="#TRY:UNEXPECTED%20CONDITION" title="TRY:UNEXPECTED CONDITION"><code>unexpected</code></a>, only the interesting things are printed. See <a href="#TRY:@TRY%2FPRINT%20MGL-PAX:SECTION" title="Printing Events">Printing Events</a>.</p></li>
</ul>
<p><a id="x-28TRY-3A-2ADESCRIBE-2A-20VARIABLE-29"></a>
<a id="TRY:*DESCRIBE*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L75">[variable]</a></span> <span class="reference-object"><a href="#TRY:*DESCRIBE*%20VARIABLE" >*describe*</a></span></span> <span class="locative-args">(or unexpected failure)</span></span></p>

<p>By default, the context (e.g. <a href="#TRY:@TRY%2FCAPTURES%20MGL-PAX:SECTION" title="Captures">Captures</a>, and the <code>ctx</code> argument
of is and other checks) of <a href="#TRY:UNEXPECTED%20CONDITION" title="TRY:UNEXPECTED CONDITION"><code>unexpected</code></a> events is described. See
<a href="#TRY:@TRY%2FPRINT%20MGL-PAX:SECTION" title="Printing Events">Printing Events</a>.</p></li>
</ul>
<p><a id="x-28TRY-3A-2ASTREAM-2A-20VARIABLE-29"></a>
<a id="TRY:*STREAM*%20VARIABLE"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L80">[variable]</a></span> <span class="reference-object"><a href="#TRY:*STREAM*%20VARIABLE" >*stream*</a></span></span> <span class="locative-args">(make-synonym-stream '*debug-io*)</span></span></li>
</ul>
<p><a id="x-28TRY-3A-2APRINTER-2A-20VARIABLE-29"></a>
<a id="TRY:*PRINTER*%20VARIABLE"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L82">[variable]</a></span> <span class="reference-object"><a href="#TRY:*PRINTER*%20VARIABLE" >*printer*</a></span></span> <span class="locative-args">tree-printer</span></span></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FEXPLICIT-TRY-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FEXPLICIT-TRY%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FIMPLICIT-TRY%20MGL-PAX:SECTION" title="Calling Test Functions">&#8592;</a> <a href="#TRY:@TRY%2FTESTS%20MGL-PAX:SECTION" title="Tests">&#8593;</a> <a href="#TRY:@TRY%2FTESTABLES%20MGL-PAX:SECTION" title="Testables">&#8594;</a> <a href="#TRY:@TRY%2FEXPLICIT-TRY%20MGL-PAX:SECTION" title="Explicit `try`">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L91">&#955;</a></span></span></p>
<h3><a href="#TRY:@TRY%2FEXPLICIT-TRY%20MGL-PAX:SECTION">8.2 Explicit <code>try</code></a></h3>
<p>Instead of invoking the test function directly, tests can also be
run by invoking the <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a> function.</p>
<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">deftest</span></i> my-test <span class="paren2">(<span class="code"></span>)</span>
  <span class="paren2">(<span class="code">is t</span>)</span></span>)</span>

<span class="paren1">(<span class="code">try 'my-test</span>)</span>
.. MY-TEST
..   ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
.. ⋅ MY-TEST ⋅1
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code">MY-TEST</span>)</span> EXPECTED-SUCCESS 0.000s ⋅1&gt;</span></code></pre>
<p>The situation is similar with a <a href="#TRY:WITH-TEST%20MGL-PAX:MACRO" title="TRY:WITH-TEST MGL-PAX:MACRO"><code>with-test</code></a>, only that <code>try</code> wraps an
extra <a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a> around the execution of the <code>lambda</code>(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_lambda.htm" title="&quot;s_lambda&quot; (MGL-PAX:CLHS MGL-PAX:SECTION)"><code>0</code></a> <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_lambda.htm" title="LAMBDA (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>1</code></a>) to ensure that all
<a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION"><code>event</code></a>s are signalled within a trial.</p>
<pre><code><span class="code"><span class="paren1">(<span class="code">try <span class="paren2">(<span class="code"><i><span class="symbol">lambda</span></i> <span class="paren3">(<span class="code"></span>)</span>
       <span class="paren3">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren4">(<span class="code">my-test</span>)</span>
         <span class="paren4">(<span class="code">is t</span>)</span></span>)</span></span>)</span></span>)</span>
.. <span class="paren1">(<span class="code">TRY #&lt;<i><span class="symbol">FUNCTION</span></i> <span class="paren2">(<span class="code"><i><span class="symbol">LAMBDA</span></i> <span class="paren3">(<span class="code"></span>)</span></span>)</span> {531FE50B}&gt;</span>)</span>
..   MY-TEST
..     ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
..   ⋅ MY-TEST ⋅1
.. ⋅ <span class="paren1">(<span class="code">TRY #&lt;<i><span class="symbol">FUNCTION</span></i> <span class="paren2">(<span class="code"><i><span class="symbol">LAMBDA</span></i> <span class="paren3">(<span class="code"></span>)</span></span>)</span> {531FE50B}&gt;</span>)</span> ⋅1
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code">TRY #&lt;<i><span class="symbol">FUNCTION</span></i> <span class="paren2">(<span class="code"><i><span class="symbol">LAMBDA</span></i> <span class="paren3">(<span class="code"></span>)</span></span>)</span> {531FE50B}&gt;</span>)</span> EXPECTED-SUCCESS 0.000s ⋅1&gt;</span></code></pre>
<p>Invoking tests with an explicit <code>try</code> is very similar to just calling
the test functions directly (see <a href="#TRY:@TRY%2FIMPLICIT-TRY%20MGL-PAX:SECTION" title="Calling Test Functions">Calling Test Functions</a>). The differences
are that <code>try</code></p>
<ul>
<li><p>can run <a href="#TRY:@TRY%2FTESTABLES%20MGL-PAX:SECTION" title="Testables">Testables</a>,</p></li>
<li><p>has a function argument for each of the <a href="#TRY:*DEBUG*%20VARIABLE" title="TRY:*DEBUG* VARIABLE"><code>*debug*</code></a>, <a href="#TRY:*COLLECT*%20VARIABLE" title="TRY:*COLLECT* VARIABLE"><code>*collect*</code></a>, etc
  variables.</p></li>
</ul>
<p>Those arguments default to <a href="#TRY:*TRY-DEBUG*%20VARIABLE" title="TRY:*TRY-DEBUG* VARIABLE"><code>*try-debug*</code></a>, <a href="#TRY:*TRY-COLLECT*%20VARIABLE" title="TRY:*TRY-COLLECT* VARIABLE"><code>*try-collect*</code></a>, etc, which
parallel and default to <code>*debug*</code>, <code>*collect*</code>, etc if set to
<code>:unspecified</code>. <code>*try-debug*</code> is <code>nil</code>, the rest of them are <code>:unspecified</code>.</p>
<p>These defaults encourage the use of an explicit <code>try</code> call in the
non-interactive case and calling the test functions directly in the
interactive one, but this is not enforced in any way.</p>
<p><a id="x-28TRY-3ATRY-20FUNCTION-29"></a>
<a id="TRY:TRY%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L324">[function]</a></span> <span class="reference-object"><a href="#TRY:TRY%20FUNCTION" >try</a></span></span> <span class="locative-args">testable &amp;key (debug *try-debug*) (count *try-count*) (collect *try-collect*) (rerun *try-rerun*) (print *try-print*) (describe *try-describe*) (stream *try-stream*) (printer *try-printer*)</span></span></p>

<p><code>try</code> runs <code>testable</code> and handles the <a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION"><code>event</code></a>s to collect, debug, print
the results of checks and trials, and to decide what tests to skip
and what to rerun.</p>

<p><code>debug</code>, <code>count</code>, <code>collect</code>, <code>rerun</code>, <code>print</code>, and <code>describe</code> must all be valid
specifiers for types that are either <code>nil</code> (the empty type) or have a
non-empty intersection with the type <a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION"><code>event</code></a> (e.g. <code>t</code>, <a href="#TRY:OUTCOME%20CONDITION" title="TRY:OUTCOME CONDITION"><code>outcome</code></a>,
<a href="#TRY:UNEXPECTED%20CONDITION" title="TRY:UNEXPECTED CONDITION"><code>unexpected</code></a>, <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a>).</p>

<p><code>try</code> sets up a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_handle.htm" title="HANDLER-BIND (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>handler-bind</code></a> handler for <code>event</code>s and runs <code>testable</code> (see
<a href="#TRY:@TRY%2FTESTABLES%20MGL-PAX:SECTION" title="Testables">Testables</a>). When an <code>event</code> is signalled, the handler matches its
type to the value of the <code>debug</code> argument (in the sense of <code>(typep
event debug)</code>). If it matches, then the debugger is invoked with the
event. In the debugger, the user has a number of restarts available
to change (see <a href="#TRY:@TRY%2FEVENT-RESTARTS%20MGL-PAX:SECTION" title="Event Restarts">Event Restarts</a>, <a href="#TRY:@TRY%2FOUTCOME-RESTARTS%20MGL-PAX:SECTION" title="Outcome Restarts">Outcome Restarts</a>,
<a href="#TRY:@TRY%2FCHECK-RESTARTS%20MGL-PAX:SECTION" title="Check Restarts">Check Restarts</a>, <a href="#TRY:@TRY%2FTRIAL-RESTARTS%20MGL-PAX:SECTION" title="Trial Restarts">Trial Restarts</a>, and <a href="#TRY:SET-TRY-DEBUG%20FUNCTION" title="TRY:SET-TRY-DEBUG FUNCTION"><code>set-try-debug</code></a>.</p>

<p>If the debugger is not invoked, <code>try</code> invokes the very first restart
available, which is always <a href="#TRY:RECORD-EVENT%20FUNCTION" title="TRY:RECORD-EVENT FUNCTION"><code>record-event</code></a>.</p>

<p>Recording the event is performed as follows.</p>

<ul>
<li><p>Outcome counts are updated (see <a href="#TRY:@TRY%2FCOUNT%20MGL-PAX:SECTION" title="Counting Events">Counting Events</a>).</p></li>
<li><p>The event is passed to the collector (see <a href="#TRY:@TRY%2FCOLLECT%20MGL-PAX:SECTION" title="Collecting Events">Collecting Events</a>).</p></li>
<li><p>The event is passed to the printer (see <a href="#TRY:@TRY%2FPRINT%20MGL-PAX:SECTION" title="Printing Events">Printing Events</a>).</p></li>
<li><p>Finally, when rerunning a trial (i.e. when <code>testable</code> is a trial),
  on a <a href="#TRY:TRIAL-START%20CONDITION" title="TRY:TRIAL-START CONDITION"><code>trial-start</code></a> event, the trial may be skipped (see <a href="#TRY:@TRY%2FRERUN%20MGL-PAX:SECTION" title="Rerunning Trials">Rerunning Trials</a>).</p></li>
</ul>

<p><code>try</code> returns the values returned by the outermost trial (see
<a href="#TRY:@TRY%2FTESTS%20MGL-PAX:SECTION" title="Tests">Tests</a>).</p></li>
</ul>
<p><a id="x-28TRY-3ASET-TRY-DEBUG-20FUNCTION-29"></a>
<a id="TRY:SET-TRY-DEBUG%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L284">[function]</a></span> <span class="reference-object"><a href="#TRY:SET-TRY-DEBUG%20FUNCTION" >set-try-debug</a></span></span> <span class="locative-args">debug</span></span></p>

<p>Invoke the <code>set-try-debug</code> restart to override the <code>debug</code> argument of
the currently running <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a>. <code>debug</code> must thus be a suitable type. When
the <code>set-try-debug</code> restart is invoked interactively, <code>debug</code> is read as
a non-evaluated form from <a href="http://www.lispworks.com/documentation/HyperSpec/Body/v_debug_.htm" title="*QUERY-IO* (MGL-PAX:CLHS VARIABLE)"><code>*query-io*</code></a>.</p></li>
</ul>
<p><a id="x-28TRY-3A-2ATRY-DEBUG-2A-20VARIABLE-29"></a>
<a id="TRY:*TRY-DEBUG*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L157">[variable]</a></span> <span class="reference-object"><a href="#TRY:*TRY-DEBUG*%20VARIABLE" >*try-debug*</a></span></span> <span class="locative-args">nil</span></span></p>

<p>The default value for <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a>'s <code>:debug</code> argument. If
<code>:unspecified</code>, then the value of <a href="#TRY:*DEBUG*%20VARIABLE" title="TRY:*DEBUG* VARIABLE"><code>*debug*</code></a> is used instead.</p></li>
</ul>
<p><a id="x-28TRY-3A-2ATRY-COUNT-2A-20VARIABLE-29"></a>
<a id="TRY:*TRY-COUNT*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L160">[variable]</a></span> <span class="reference-object"><a href="#TRY:*TRY-COUNT*%20VARIABLE" >*try-count*</a></span></span> <span class="locative-args">:unspecified</span></span></p>

<p>The default value for <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a>'s <code>:count</code> argument. If
<code>:unspecified</code>, then the value of <a href="#TRY:*COUNT*%20VARIABLE" title="TRY:*COUNT* VARIABLE"><code>*count*</code></a> is used instead.</p></li>
</ul>
<p><a id="x-28TRY-3A-2ATRY-COLLECT-2A-20VARIABLE-29"></a>
<a id="TRY:*TRY-COLLECT*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L163">[variable]</a></span> <span class="reference-object"><a href="#TRY:*TRY-COLLECT*%20VARIABLE" >*try-collect*</a></span></span> <span class="locative-args">:unspecified</span></span></p>

<p>The default value for <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a>'s <code>:collect</code> argument. If
<code>:unspecified</code>, then the value of <a href="#TRY:*COLLECT*%20VARIABLE" title="TRY:*COLLECT* VARIABLE"><code>*collect*</code></a> is used instead.</p></li>
</ul>
<p><a id="x-28TRY-3A-2ATRY-RERUN-2A-20VARIABLE-29"></a>
<a id="TRY:*TRY-RERUN*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L166">[variable]</a></span> <span class="reference-object"><a href="#TRY:*TRY-RERUN*%20VARIABLE" >*try-rerun*</a></span></span> <span class="locative-args">:unspecified</span></span></p>

<p>The default value for <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a>'s <code>:rerun</code> argument. If
<code>:unspecified</code>, then the value of <a href="#TRY:*RERUN*%20VARIABLE" title="TRY:*RERUN* VARIABLE"><code>*rerun*</code></a> is used instead.</p></li>
</ul>
<p><a id="x-28TRY-3A-2ATRY-PRINT-2A-20VARIABLE-29"></a>
<a id="TRY:*TRY-PRINT*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L169">[variable]</a></span> <span class="reference-object"><a href="#TRY:*TRY-PRINT*%20VARIABLE" >*try-print*</a></span></span> <span class="locative-args">:unspecified</span></span></p>

<p>The default value for <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a>'s <code>:print</code> argument. If
<code>:unspecified</code>, then the value of <a href="#TRY:*PRINT*%20VARIABLE" title="TRY:*PRINT* VARIABLE"><code>*print*</code></a> is used instead.</p></li>
</ul>
<p><a id="x-28TRY-3A-2ATRY-DESCRIBE-2A-20VARIABLE-29"></a>
<a id="TRY:*TRY-DESCRIBE*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L172">[variable]</a></span> <span class="reference-object"><a href="#TRY:*TRY-DESCRIBE*%20VARIABLE" >*try-describe*</a></span></span> <span class="locative-args">:unspecified</span></span></p>

<p>The default value for <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a>'s <code>:describe</code> argument. If
<code>:unspecified</code>, then the value of <a href="#TRY:*DESCRIBE*%20VARIABLE" title="TRY:*DESCRIBE* VARIABLE"><code>*describe*</code></a> is used instead.</p></li>
</ul>
<p><a id="x-28TRY-3A-2ATRY-STREAM-2A-20VARIABLE-29"></a>
<a id="TRY:*TRY-STREAM*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L175">[variable]</a></span> <span class="reference-object"><a href="#TRY:*TRY-STREAM*%20VARIABLE" >*try-stream*</a></span></span> <span class="locative-args">:unspecified</span></span></p>

<p>The default value for <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a>'s <code>:stream</code> argument. If
<code>:unspecified</code>, then the value of <a href="#TRY:*STREAM*%20VARIABLE" title="TRY:*STREAM* VARIABLE"><code>*stream*</code></a> is used instead.</p></li>
</ul>
<p><a id="x-28TRY-3A-2ATRY-PRINTER-2A-20VARIABLE-29"></a>
<a id="TRY:*TRY-PRINTER*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L178">[variable]</a></span> <span class="reference-object"><a href="#TRY:*TRY-PRINTER*%20VARIABLE" >*try-printer*</a></span></span> <span class="locative-args">:unspecified</span></span></p>

<p>The default value for <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a>'s <code>:printer</code> argument. If
<code>:unspecified</code>, then the value of <a href="#TRY:*PRINTER*%20VARIABLE" title="TRY:*PRINTER* VARIABLE"><code>*printer*</code></a> is used instead.</p></li>
</ul>
<p><a id="x-28TRY-3A-2AN-RECENT-TRIALS-2A-20VARIABLE-29"></a>
<a id="TRY:*N-RECENT-TRIALS*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L301">[variable]</a></span> <span class="reference-object"><a href="#TRY:*N-RECENT-TRIALS*%20VARIABLE" >*n-recent-trials*</a></span></span> <span class="locative-args">3</span></span></p>

<p>See <code>*recent-trials*</code>.</p></li>
</ul>
<p><a id="x-28TRY-3ARECENT-TRIAL-20FUNCTION-29"></a>
<a id="TRY:RECENT-TRIAL%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L295">[function]</a></span> <span class="reference-object"><a href="#TRY:RECENT-TRIAL%20FUNCTION" >recent-trial</a></span></span> <span class="locative-args">&amp;optional (n 0)</span></span></p>

<p>Returns the <code>n</code>th most recent trial or <code>nil</code> if there are not enough
trials recorded. Every <a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a> returned by <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a> gets pushed
onto a list of trials, but only <a href="#TRY:*N-RECENT-TRIALS*%20VARIABLE" title="TRY:*N-RECENT-TRIALS* VARIABLE"><code>*n-recent-trials*</code></a> are kept.</p></li>
</ul>
<p><a id="x-28TRY-3A-21-20VARIABLE-29"></a>
<a id="TRY:%21%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L304">[variable]</a></span> <span class="reference-object"><a href="#TRY:%21%20VARIABLE" >!</a></span></span> <span class="locative-args">nil</span></span></p>

<p>The most recent trial. Equivalent to <code>(recent-trial 0)</code>.</p></li>
</ul>
<p><a id="x-28TRY-3A-21-21-20VARIABLE-29"></a>
<a id="TRY:%21%21%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L306">[variable]</a></span> <span class="reference-object"><a href="#TRY:%21%21%20VARIABLE" >!!</a></span></span> <span class="locative-args">nil</span></span></p>

<p>Equivalent to <code>(recent-trial 1)</code>.</p></li>
</ul>
<p><a id="x-28TRY-3A-21-21-21-20VARIABLE-29"></a>
<a id="TRY:%21%21%21%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L308">[variable]</a></span> <span class="reference-object"><a href="#TRY:%21%21%21%20VARIABLE" >!!!</a></span></span> <span class="locative-args">nil</span></span></p>

<p>Equivalent to <code>(recent-trial 2)</code>.</p></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FTESTABLES-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FTESTABLES%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FEXPLICIT-TRY%20MGL-PAX:SECTION" title="Explicit `try`">&#8592;</a> <a href="#TRY:@TRY%2FEXPLICIT-TRY%20MGL-PAX:SECTION" title="Explicit `try`">&#8593;</a> <a href="#TRY:@TRY%2FIMPLICIT-TRY-IMPLEMENTATION%20MGL-PAX:SECTION" title="Implementation of Implicit `try`">&#8594;</a> <a href="#TRY:@TRY%2FTESTABLES%20MGL-PAX:SECTION" title="Testables">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/testable.lisp#L3">&#955;</a></span></span></p>
<h4><a href="#TRY:@TRY%2FTESTABLES%20MGL-PAX:SECTION">8.2.1 Testables</a></h4>
<p>Valid first arguments to <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a> are called testables. A testable may
be:</p>
<ul>
<li><p>a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_f.htm#function_designator" title="&quot;function designator&quot; (MGL-PAX:CLHS MGL-PAX:GLOSSARY-TERM)">function designator</a></p>

<ul>
<li><p>the name of a global test</p></li>
<li><p>the name of a global function</p></li>
<li><p>a function object</p></li>
<li><p>a trial</p></li>
</ul></li>
<li><p>a list of testables</p></li>
<li><p>a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/t_pkg.htm" title="PACKAGE (MGL-PAX:CLHS CLASS)"><code>package</code></a></p></li>
</ul>
<p>In the function designator cases, <code>try</code> calls the designated function.
<a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a>s, being <a href="#TRY:@FUNCALLABLE-INSTANCE%20MGL-PAX:GLOSSARY-TERM" title="funcallable instance">funcallable instance</a>s, designate themselves. If the
trial is not <a href="#TRY:RUNNINGP%20FUNCTION" title="TRY:RUNNINGP FUNCTION"><code>runningp</code></a>, then it will be rerun (see <a href="#TRY:@TRY%2FRERUN%20MGL-PAX:SECTION" title="Rerunning Trials">Rerunning Trials</a>). Don't
invoke <code>try</code> with <code>runningp</code> trials (but see
<a href="#TRY:@TRY%2FIMPLICIT-TRY-IMPLEMENTATION%20MGL-PAX:SECTION" title="Implementation of Implicit `try`">Implementation of Implicit <code>try</code></a> for discussion).</p>
<p>When given a list of testables, <code>try</code> calls each testable one by one.</p>
<p>Finally, a <code>package</code> stands for the result of calling
<a href="#TRY:LIST-PACKAGE-TESTS%20FUNCTION" title="TRY:LIST-PACKAGE-TESTS FUNCTION"><code>list-package-tests</code></a> on that package.</p>
<p><a id="x-28TRY-3A-40TRY-2FIMPLICIT-TRY-IMPLEMENTATION-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FIMPLICIT-TRY-IMPLEMENTATION%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FTESTABLES%20MGL-PAX:SECTION" title="Testables">&#8592;</a> <a href="#TRY:@TRY%2FEXPLICIT-TRY%20MGL-PAX:SECTION" title="Explicit `try`">&#8593;</a> <a href="#TRY:@TRY%2FPRINT%20MGL-PAX:SECTION" title="Printing Events">&#8594;</a> <a href="#TRY:@TRY%2FIMPLICIT-TRY-IMPLEMENTATION%20MGL-PAX:SECTION" title="Implementation of Implicit `try`">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/try.lisp#L197">&#955;</a></span></span></p>
<h4><a href="#TRY:@TRY%2FIMPLICIT-TRY-IMPLEMENTATION%20MGL-PAX:SECTION">8.2.2 Implementation of Implicit <code>try</code></a></h4>
<p>What's happening in the implementation is that a test function,
when it is called, checks whether it is running under the <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a>
function. If it isn't, then it invokes <code>try</code> with its <a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a>. <code>try</code>
realizes the trial cannot be rerun yet (see <a href="#TRY:@TRY%2FRERUN%20MGL-PAX:SECTION" title="Rerunning Trials">Rerunning Trials</a>) because it
is <a href="#TRY:RUNNINGP%20FUNCTION" title="TRY:RUNNINGP FUNCTION"><code>runningp</code></a>, sets up its event handlers for debugging, collecting,
printing, and invokes the trial as if it were rerun but without
skipping anything based on the <code>rerun</code> argument. Thus the following
are infinite recursions:</p>
<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren2">(<span class="code">recurse</span>)</span>
  <span class="paren2">(<span class="code">try recurse</span>)</span></span>)</span>

<span class="paren1">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren2">(<span class="code">recurse</span>)</span>
  <span class="paren2">(<span class="code">funcall recurse</span>)</span></span>)</span></span></code></pre>
<p><a id="x-28TRY-3A-40TRY-2FPRINT-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FPRINT%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FIMPLICIT-TRY-IMPLEMENTATION%20MGL-PAX:SECTION" title="Implementation of Implicit `try`">&#8592;</a> <a href="#TRY:@TRY%2FTESTS%20MGL-PAX:SECTION" title="Tests">&#8593;</a> <a href="#TRY:@TRY%2FCOUNT%20MGL-PAX:SECTION" title="Counting Events">&#8594;</a> <a href="#TRY:@TRY%2FPRINT%20MGL-PAX:SECTION" title="Printing Events">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/print.lisp#L5">&#955;</a></span></span></p>
<h3><a href="#TRY:@TRY%2FPRINT%20MGL-PAX:SECTION">8.3 Printing Events</a></h3>
<p><a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a> instantiates a printer of the type given by its <code>printer</code>
argument. All <a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION"><code>event</code></a>s recorded by <code>try</code> are sent to this printer. The
printer then prints events that match the type given by the <code>print</code>
argument of <code>try</code>. Events that also match the <code>describe</code> argument of <code>try</code>
are printed with context information (see <a href="#TRY:IS%20MGL-PAX:MACRO" title="TRY:IS MGL-PAX:MACRO"><code>is</code></a>) and backtraces (see
<a href="#TRY:UNHANDLED-ERROR%20CONDITION" title="TRY:UNHANDLED-ERROR CONDITION"><code>unhandled-error</code></a>).</p>
<p>Although the printing is primarily customized with global special
variables, changing the value of those variables after the printer
object is instantiated by <code>try</code> has no effect. This is to ensure
consistent output with nested <code>try</code> calls of differing printer
setups.</p>
<p><a id="x-28TRY-3ATREE-PRINTER-20CLASS-29"></a>
<a id="TRY:TREE-PRINTER%20CLASS"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/print.lisp#L350">[class]</a></span> <span class="reference-object"><a href="#TRY:TREE-PRINTER%20CLASS" >tree-printer</a></span></span></span></p>

<p><code>tree-printer</code> prints events in an indented
tree-like structure, with each internal node corresponding to a
<a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a>. This is the default printer (according to <a href="#TRY:*PRINTER*%20VARIABLE" title="TRY:*PRINTER* VARIABLE"><code>*printer*</code></a> and
<a href="#TRY:*TRY-PRINTER*%20VARIABLE" title="TRY:*TRY-PRINTER* VARIABLE"><code>*try-printer*</code></a>) and currently the only one.</p>

<p>The following example prints all <a href="#TRY:@TRY%2FCONCRETE-EVENTS%20MGL-PAX:SECTION" title="Concrete Events">Concrete Events</a>.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">let</span></i> <span class="paren2">(<span class="code"><span class="paren3">(<span class="code"><span class="special">*debug*</span> nil</span>)</span>
      <span class="paren3">(<span class="code"><span class="special">*print*</span> '<span class="paren4">(<span class="code">not trial-start</span>)</span></span>)</span>
      <span class="paren3">(<span class="code"><span class="special">*describe*</span> nil</span>)</span></span>)</span>
  <span class="paren2">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren3">(<span class="code">verdict-abort*</span>)</span>
    <span class="paren3">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren4">(<span class="code">expected-verdict-success</span>)</span></span>)</span>
    <span class="paren3">(<span class="code"><i><span class="symbol">with-expected-outcome</span></i> <span class="paren4">(<span class="code">'failure</span>)</span>
      <span class="paren4">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren5">(<span class="code">unexpected-verdict-success</span>)</span></span>)</span></span>)</span>
    <span class="paren3">(<span class="code">handler-bind <span class="paren4">(<span class="code"><span class="paren5">(<span class="code"><span class="paren6">(<span class="code">and verdict success</span>)</span> #'force-expected-failure</span>)</span></span>)</span>
      <span class="paren4">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren5">(<span class="code">expected-verdict-failure</span>)</span></span>)</span></span>)</span>
    <span class="paren3">(<span class="code">handler-bind <span class="paren4">(<span class="code"><span class="paren5">(<span class="code"><span class="paren6">(<span class="code">and verdict success</span>)</span> #'force-unexpected-failure</span>)</span></span>)</span>
      <span class="paren4">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren5">(<span class="code">unexpected-verdict-failure</span>)</span></span>)</span></span>)</span>
    <span class="paren3">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren4">(<span class="code">verdict-skip</span>)</span>
      <span class="paren4">(<span class="code">skip-trial</span>)</span></span>)</span>
    <span class="paren3">(<span class="code">is t <span class="keyword">:msg</span> <span class="string">"EXPECTED-RESULT-SUCCESS"</span></span>)</span>
    <span class="paren3">(<span class="code"><i><span class="symbol">with-failure-expected</span></i> <span class="paren4">(<span class="code">'failure</span>)</span>
      <span class="paren4">(<span class="code">is t <span class="keyword">:msg</span> <span class="string">"UNEXPECTED-RESULT-SUCCESS"</span></span>)</span>
      <span class="paren4">(<span class="code">is nil <span class="keyword">:msg</span> <span class="string">"EXPECTED-RESULT-FAILURE"</span></span>)</span></span>)</span>
    <span class="paren3">(<span class="code">is nil <span class="keyword">:msg</span> <span class="string">"UNEXPECTED-RESULT-FAILURE"</span></span>)</span>
    <span class="paren3">(<span class="code"><i><span class="symbol">with-skip</span></i> <span class="paren4">(<span class="code"></span>)</span>
      <span class="paren4">(<span class="code">is nil <span class="keyword">:msg</span> <span class="string">"RESULT-SKIP"</span></span>)</span></span>)</span>
    <span class="paren3">(<span class="code">handler-bind <span class="paren4">(<span class="code"><span class="paren5">(<span class="code"><span class="paren6">(<span class="code">and result success</span>)</span> #'abort-check</span>)</span></span>)</span>
      <span class="paren4">(<span class="code">is t <span class="keyword">:msg</span> <span class="string">"RESULT-ABORT*"</span></span>)</span></span>)</span>
    <span class="paren3">(<span class="code"><i><span class="symbol">catch</span></i> 'foo
      <span class="paren4">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren5">(<span class="code">nlx-test</span>)</span>
        <span class="paren5">(<span class="code"><i><span class="symbol">throw</span></i> 'foo nil</span>)</span></span>)</span></span>)</span>
    <span class="paren3">(<span class="code">error <span class="string">"UNHANDLED-ERROR"</span></span>)</span></span>)</span></span>)</span>
.. VERDICT-ABORT*                       <span class="comment">; TRIAL-START
</span>..   ⋅ EXPECTED-VERDICT-SUCCESS
..   ⊡ UNEXPECTED-VERDICT-SUCCESS
..   × EXPECTED-VERDICT-FAILURE
..   ⊠ UNEXPECTED-VERDICT-FAILURE
..   - VERDICT-SKIP
..   ⋅ EXPECTED-RESULT-SUCCESS
..   ⊡ UNEXPECTED-RESULT-SUCCESS
..   × EXPECTED-RESULT-FAILURE
..   ⊠ UNEXPECTED-RESULT-FAILURE
..   - RESULT-SKIP
..   ⊟ RESULT-ABORT*
..   NLX-TEST                           <span class="comment">; TRIAL-START
</span>..     ⊟ non-local exit                 <span class="comment">; NLX
</span>..   ⊟ NLX-TEST ⊟1                      <span class="comment">; VERDICT-ABORT*
</span>..   ⊟ "UNHANDLED-ERROR" <span class="paren1">(<span class="code">SIMPLE-ERROR</span>)</span>
.. ⊟ VERDICT-ABORT* ⊟3 ⊠1 ⊡1 -1 ×1 ⋅1
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">VERDICT-ABORT*</span>)</span></span>)</span> ABORT* 0.004s ⊟3 ⊠1 ⊡1 -1 ×1 ⋅1&gt;</span></code></pre>

<p>The <code>⊟3 ⊠1 ⊡1 -1 ×1 ⋅1</code> part is the counts for <a href="#TRY:*CATEGORIES*%20VARIABLE" title="TRY:*CATEGORIES* VARIABLE"><code>*categories*</code></a> printed
with their markers.</p></li>
</ul>
<p><a id="x-28TRY-3A-2APRINT-PARENT-2A-20VARIABLE-29"></a>
<a id="TRY:*PRINT-PARENT*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/print.lisp#L57">[variable]</a></span> <span class="reference-object"><a href="#TRY:*PRINT-PARENT*%20VARIABLE" >*print-parent*</a></span></span> <span class="locative-args">t</span></span></p>

<p>When an <a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION"><code>event</code></a> is signalled and its parent <a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a>'s type matches
<code>*print-parent*</code>, the trial is printed as if its <a href="#TRY:TRIAL-START%20CONDITION" title="TRY:TRIAL-START CONDITION"><code>trial-start</code></a> matched
the <code>print</code> argument of <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a>.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">let</span></i> <span class="paren2">(<span class="code"><span class="paren3">(<span class="code"><span class="special">*print*</span> 'leaf</span>)</span>
      <span class="paren3">(<span class="code"><span class="special">*print-parent*</span> t</span>)</span></span>)</span>
  <span class="paren2">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren3">(<span class="code">t0</span>)</span>
    <span class="paren3">(<span class="code">is t</span>)</span>
    <span class="paren3">(<span class="code">is t</span>)</span></span>)</span></span>)</span>
.. T0
..   ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
..   ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
.. ⋅ T0 ⋅2
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">T0</span>)</span></span>)</span> EXPECTED-SUCCESS 0.000s ⋅2&gt;</span></code></pre>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">let</span></i> <span class="paren2">(<span class="code"><span class="paren3">(<span class="code"><span class="special">*print*</span> 'leaf</span>)</span>
      <span class="paren3">(<span class="code"><span class="special">*print-parent*</span> nil</span>)</span></span>)</span>
  <span class="paren2">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren3">(<span class="code">t0</span>)</span>
    <span class="paren3">(<span class="code">is t</span>)</span>
    <span class="paren3">(<span class="code">is t</span>)</span></span>)</span></span>)</span>
.. ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
.. ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">T0</span>)</span></span>)</span> EXPECTED-SUCCESS 0.000s ⋅2&gt;</span></code></pre>

<p><code>*print-parent*</code> <code>nil</code> combined with printing <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a>s results in a flat
 output:</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">let</span></i> <span class="paren2">(<span class="code"><span class="paren3">(<span class="code"><span class="special">*print*</span> '<span class="paren4">(<span class="code">or leaf verdict</span>)</span></span>)</span>
      <span class="paren3">(<span class="code"><span class="special">*print-parent*</span> nil</span>)</span></span>)</span>
  <span class="paren2">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren3">(<span class="code">outer</span>)</span>
    <span class="paren3">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren4">(<span class="code">inner</span>)</span>
      <span class="paren4">(<span class="code">is t <span class="keyword">:msg</span> <span class="string">"inner-t"</span></span>)</span></span>)</span>
    <span class="paren3">(<span class="code">is t <span class="keyword">:msg</span> <span class="string">"outer-t"</span></span>)</span></span>)</span></span>)</span>
.. ⋅ inner-t
.. ⋅ INNER ⋅1
.. ⋅ outer-t
.. ⋅ OUTER ⋅2
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">OUTER</span>)</span></span>)</span> EXPECTED-SUCCESS 0.000s ⋅2&gt;</span></code></pre></li>
</ul>
<p><a id="x-28TRY-3A-2APRINT-INDENTATION-2A-20VARIABLE-29"></a>
<a id="TRY:*PRINT-INDENTATION*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/print.lisp#L260">[variable]</a></span> <span class="reference-object"><a href="#TRY:*PRINT-INDENTATION*%20VARIABLE" >*print-indentation*</a></span></span> <span class="locative-args">2</span></span></p>

<p>The number of spaces each printed <a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a> increases the indentation
of its children.</p></li>
</ul>
<p><a id="x-28TRY-3A-2APRINT-DURATION-2A-20VARIABLE-29"></a>
<a id="TRY:*PRINT-DURATION*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/print.lisp#L264">[variable]</a></span> <span class="reference-object"><a href="#TRY:*PRINT-DURATION*%20VARIABLE" >*print-duration*</a></span></span> <span class="locative-args">nil</span></span></p>

<p>If true, the number of seconds spent during execution is printed.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">let</span></i> <span class="paren2">(<span class="code"><span class="paren3">(<span class="code"><span class="special">*print-duration*</span> t</span>)</span>
      <span class="paren3">(<span class="code"><span class="special">*debug*</span> nil</span>)</span>
      <span class="paren3">(<span class="code"><span class="special">*describe*</span> nil</span>)</span></span>)</span>
  <span class="paren2">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren3">(<span class="code">timed</span>)</span>
    <span class="paren3">(<span class="code">is <span class="paren4">(<span class="code"><i><span class="symbol">progn</span></i> <span class="paren5">(<span class="code">sleep 0.3</span>)</span> t</span>)</span></span>)</span>
    <span class="paren3">(<span class="code">is <span class="paren4">(<span class="code"><i><span class="symbol">progn</span></i> <span class="paren5">(<span class="code">sleep 0.2</span>)</span> t</span>)</span></span>)</span>
    <span class="paren3">(<span class="code">error <span class="string">"xxx"</span></span>)</span></span>)</span></span>)</span>
..        TIMED
..  0.300   ⋅ <span class="paren1">(<span class="code">IS <span class="paren2">(<span class="code"><i><span class="symbol">PROGN</span></i> <span class="paren3">(<span class="code">SLEEP 0.3</span>)</span> T</span>)</span></span>)</span>
..  0.200   ⋅ <span class="paren1">(<span class="code">IS <span class="paren2">(<span class="code"><i><span class="symbol">PROGN</span></i> <span class="paren3">(<span class="code">SLEEP 0.2</span>)</span> T</span>)</span></span>)</span>
..          ⊟ ""xxx <span class="paren1">(<span class="code">SIMPLE-ERROR</span>)</span>
..  0.504 ⊟ TIMED ⊟1 ⋅2
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">TIMED</span>)</span></span>)</span> ABORT* 0.504s ⊟1 ⋅2&gt;</span></code></pre>

<p>Timing is available for all <a href="#TRY:OUTCOME%20CONDITION" title="TRY:OUTCOME CONDITION"><code>outcome</code></a>s (i.e. for <a href="#TRY:@TRY%2FCHECKS%20MGL-PAX:SECTION" title="Checks">Checks</a> and
<a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a>s). Checks generally measure the time spent during evaluation
the form they are wrapping. Trials measure the time between
<a href="#TRY:TRIAL-START%20CONDITION" title="TRY:TRIAL-START CONDITION"><code>trial-start</code></a> and the <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a>.</p>

<p>Timing information is not available for <code>trial-start</code> and <a href="#TRY:ERROR*%20CONDITION" title="TRY:ERROR* CONDITION"><code>error*</code></a>
events.</p></li>
</ul>
<p><a id="x-28TRY-3A-2APRINT-COMPACTLY-2A-20VARIABLE-29"></a>
<a id="TRY:*PRINT-COMPACTLY*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/print.lisp#L293">[variable]</a></span> <span class="reference-object"><a href="#TRY:*PRINT-COMPACTLY*%20VARIABLE" >*print-compactly*</a></span></span> <span class="locative-args">nil</span></span></p>

<p><a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION"><code>event</code></a>s whose type matches <code>*print-compactly*</code> are printed less
verbosely. <a href="#TRY:LEAF%20CONDITION" title="TRY:LEAF CONDITION"><code>leaf</code></a> events are printed only with their marker, and
<a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a>s of trials without printed child trials are printed with <code>=&gt;
&lt;marker&gt;</code> (see <a href="#TRY:*CATEGORIES*%20VARIABLE" title="TRY:*CATEGORIES* VARIABLE"><code>*categories*</code></a>).</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">let</span></i> <span class="paren2">(<span class="code"><span class="paren3">(<span class="code"><span class="special">*print-compactly*</span> t</span>)</span>
      <span class="paren3">(<span class="code"><span class="special">*debug*</span> nil</span>)</span>
      <span class="paren3">(<span class="code"><span class="special">*describe*</span> nil</span>)</span></span>)</span>
  <span class="paren2">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren3">(<span class="code">outer</span>)</span>
    <span class="paren3">(<span class="code"><i><span class="symbol">loop</span></i> repeat 10 do <span class="paren4">(<span class="code">is t</span>)</span></span>)</span>
    <span class="paren3">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren4">(<span class="code">inner</span>)</span>
      <span class="paren4">(<span class="code">is t</span>)</span>
      <span class="paren4">(<span class="code">is nil</span>)</span>
      <span class="paren4">(<span class="code">error <span class="string">"xxx"</span></span>)</span></span>)</span>
    <span class="paren3">(<span class="code"><i><span class="symbol">loop</span></i> repeat 10 do <span class="paren4">(<span class="code">is t</span>)</span></span>)</span></span>)</span></span>)</span>
.. OUTER ⋅⋅⋅⋅⋅⋅⋅⋅⋅⋅
..   INNER ⋅⊠⊟ =&gt; ⊟
..   ⋅⋅⋅⋅⋅⋅⋅⋅⋅⋅
.. ⊠ OUTER ⊟1 ⊠1 ⋅21
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">OUTER</span>)</span></span>)</span> UNEXPECTED-FAILURE 0.000s ⊟1 ⊠1 ⋅21&gt;</span></code></pre>

<p><code>*print-compactly*</code> has no effect on events being <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_descri.htm" title="DESCRIBE (MGL-PAX:CLHS FUNCTION)"><code>describe</code></a>d.</p></li>
</ul>
<p><a id="x-28TRY-3A-2ADEFER-DESCRIBE-2A-20VARIABLE-29"></a>
<a id="TRY:*DEFER-DESCRIBE*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/print.lisp#L321">[variable]</a></span> <span class="reference-object"><a href="#TRY:*DEFER-DESCRIBE*%20VARIABLE" >*defer-describe*</a></span></span> <span class="locative-args">nil</span></span></p>

<p>When an <a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION"><code>event</code></a> is to be <a href="#TRY:*DESCRIBE*%20VARIABLE" title="TRY:*DESCRIBE* VARIABLE"><code>*describe*</code></a>d and its type matches
<code>*defer-describe*</code>, then instead of printing the often longish context
information in the tree of events, it is deferred until after <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a>
has finished. The following example only prints <a href="#TRY:LEAF%20CONDITION" title="TRY:LEAF CONDITION"><code>leaf</code></a> events (due to
<a href="#TRY:*PRINT*%20VARIABLE" title="TRY:*PRINT* VARIABLE"><code>*print*</code></a> and <a href="#TRY:*PRINT-PARENT*%20VARIABLE" title="TRY:*PRINT-PARENT* VARIABLE"><code>*print-parent*</code></a>) and in compact form (see
<a href="#TRY:*PRINT-COMPACTLY*%20VARIABLE" title="TRY:*PRINT-COMPACTLY* VARIABLE"><code>*print-compactly*</code></a>), deferring description of events matching
<code>*describe*</code> until the end.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">let</span></i> <span class="paren2">(<span class="code"><span class="paren3">(<span class="code"><span class="special">*print*</span> 'leaf</span>)</span>
      <span class="paren3">(<span class="code"><span class="special">*print-parent*</span> nil</span>)</span>
      <span class="paren3">(<span class="code"><span class="special">*print-compactly*</span> t</span>)</span>
      <span class="paren3">(<span class="code"><span class="special">*defer-describe*</span> t</span>)</span>
      <span class="paren3">(<span class="code"><span class="special">*debug*</span> nil</span>)</span></span>)</span>
  <span class="paren2">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren3">(<span class="code">outer</span>)</span>
    <span class="paren3">(<span class="code"><i><span class="symbol">loop</span></i> repeat 10 do <span class="paren4">(<span class="code">is t</span>)</span></span>)</span>
    <span class="paren3">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren4">(<span class="code">inner</span>)</span>
      <span class="paren4">(<span class="code">is <span class="paren5">(<span class="code">= <span class="paren6">(<span class="code">1+ 5</span>)</span> 7</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span>
.. ⋅⋅⋅⋅⋅⋅⋅⋅⋅⋅⊠
..
.. <span class="comment">;; UNEXPECTED-RESULT-FAILURE (⊠) in OUTER INNER:
</span>.. <span class="paren1">(<span class="code">IS <span class="paren2">(<span class="code">= #1=<span class="paren3">(<span class="code">1+ 5</span>)</span> 7</span>)</span></span>)</span>
.. where
..   #1# = 6
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">OUTER</span>)</span></span>)</span> UNEXPECTED-FAILURE 0.000s ⊠1 ⋅10&gt;</span></code></pre></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FCOUNT-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FCOUNT%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FPRINT%20MGL-PAX:SECTION" title="Printing Events">&#8592;</a> <a href="#TRY:@TRY%2FTESTS%20MGL-PAX:SECTION" title="Tests">&#8593;</a> <a href="#TRY:@TRY%2FCOLLECT%20MGL-PAX:SECTION" title="Collecting Events">&#8594;</a> <a href="#TRY:@TRY%2FCOUNT%20MGL-PAX:SECTION" title="Counting Events">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/count.lisp#L5">&#955;</a></span></span></p>
<h3><a href="#TRY:@TRY%2FCOUNT%20MGL-PAX:SECTION">8.4 Counting Events</a></h3>
<p><a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a>s have a counter for each category in <a href="#TRY:*CATEGORIES*%20VARIABLE" title="TRY:*CATEGORIES* VARIABLE"><code>*categories*</code></a>. When an
<a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION"><code>event</code></a> is recorded by <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a> and its type matches <a href="#TRY:*COUNT*%20VARIABLE" title="TRY:*COUNT* VARIABLE"><code>*count*</code></a>, the counters
of all categories matching the event type are incremented in the
<a href="#TRY:CURRENT-TRIAL%20FUNCTION" title="TRY:CURRENT-TRIAL FUNCTION"><code>current-trial</code></a>. When a trial finishes and a <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a> is recorded, the
trial's event counters are added to that of its parent's (if any).
The counts are printed with <code>verdict</code>s (see <a href="#TRY:@TRY%2FPRINT%20MGL-PAX:SECTION" title="Printing Events">Printing Events</a>).</p>
<p>If both <code>*count*</code> and <code>*categories*</code> are unchanged from the their
default values, then only <a href="#TRY:LEAF%20CONDITION" title="TRY:LEAF CONDITION"><code>leaf</code></a> events are counted, and we get
separate counters for <a href="#TRY:ABORT*%20CONDITION" title="TRY:ABORT* CONDITION"><code>abort*</code></a>, <a href="#TRY:UNEXPECTED-FAILURE%20TYPE" title="TRY:UNEXPECTED-FAILURE TYPE"><code>unexpected-failure</code></a>,
<a href="#TRY:UNEXPECTED-SUCCESS%20TYPE" title="TRY:UNEXPECTED-SUCCESS TYPE"><code>unexpected-success</code></a>, <a href="#TRY:SKIP%20CONDITION" title="TRY:SKIP CONDITION"><code>skip</code></a>, <a href="#TRY:EXPECTED-FAILURE%20TYPE" title="TRY:EXPECTED-FAILURE TYPE"><code>expected-failure</code></a>, and <a href="#TRY:EXPECTED-SUCCESS%20TYPE" title="TRY:EXPECTED-SUCCESS TYPE"><code>expected-success</code></a>.</p>
<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">let</span></i> <span class="paren2">(<span class="code"><span class="paren3">(<span class="code"><span class="special">*debug*</span> nil</span>)</span></span>)</span>
  <span class="paren2">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren3">(<span class="code">outer</span>)</span>
    <span class="paren3">(<span class="code"><i><span class="symbol">with-test</span></i> <span class="paren4">(<span class="code">inner</span>)</span>
      <span class="paren4">(<span class="code">is t</span>)</span></span>)</span>
    <span class="paren3">(<span class="code">is t</span>)</span>
    <span class="paren3">(<span class="code">is nil</span>)</span></span>)</span></span>)</span>
.. OUTER
..   INNER
..     ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
..   ⋅ INNER ⋅1
..   ⋅ <span class="paren1">(<span class="code">IS T</span>)</span>
..   ⊠ <span class="paren1">(<span class="code">IS NIL</span>)</span>
.. ⊠ OUTER ⊠1 ⋅2
..
==&gt; #&lt;TRIAL <span class="paren1">(<span class="code"><i><span class="symbol">WITH-TEST</span></i> <span class="paren2">(<span class="code">OUTER</span>)</span></span>)</span> UNEXPECTED-FAILURE 0.000s ⊠1 ⋅2&gt;</span></code></pre>
<p>As the above example shows, <a href="#TRY:EXPECTED-VERDICT-SUCCESS%20CONDITION" title="TRY:EXPECTED-VERDICT-SUCCESS CONDITION"><code>expected-verdict-success</code></a> and
<a href="#TRY:EXPECTED-RESULT-SUCCESS%20CONDITION" title="TRY:EXPECTED-RESULT-SUCCESS CONDITION"><code>expected-result-success</code></a> are both marked with <code>&quot;⋅&quot;</code>, but only
<code>expected-result-success</code> is counted due to <code>*count*</code> being <code>leaf</code>.</p>
<p><a id="x-28TRY-3A-40TRY-2FCOLLECT-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FCOLLECT%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FCOUNT%20MGL-PAX:SECTION" title="Counting Events">&#8592;</a> <a href="#TRY:@TRY%2FTESTS%20MGL-PAX:SECTION" title="Tests">&#8593;</a> <a href="#TRY:@TRY%2FRERUN%20MGL-PAX:SECTION" title="Rerunning Trials">&#8594;</a> <a href="#TRY:@TRY%2FCOLLECT%20MGL-PAX:SECTION" title="Collecting Events">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/collect.lisp#L3">&#955;</a></span></span></p>
<h3><a href="#TRY:@TRY%2FCOLLECT%20MGL-PAX:SECTION">8.5 Collecting Events</a></h3>
<p>When an <a href="#TRY:EVENT%20CONDITION" title="TRY:EVENT CONDITION"><code>event</code></a> is recorded and the type of the <code>event</code> matches the
<code>collect</code> type argument of <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a>, then a corresponding object is pushed
onto <a href="#TRY:CHILDREN%20%28MGL-PAX:READER%20TRY:TRIAL%29" title="TRY:CHILDREN (MGL-PAX:READER TRY:TRIAL)"><code>children</code></a> of the <a href="#TRY:CURRENT-TRIAL%20FUNCTION" title="TRY:CURRENT-TRIAL FUNCTION"><code>current-trial</code></a> for subsequent <a href="#TRY:@TRY%2FRERUN%20MGL-PAX:SECTION" title="Rerunning Trials">Rerunning Trials</a> or
<a href="#TRY:@TRY%2FREPLAY%20MGL-PAX:SECTION" title="Reprocessing Trials">Reprocessing Trials</a>.</p>
<p>In particular, if the matching event is a <a href="#TRY:LEAF%20CONDITION" title="TRY:LEAF CONDITION"><code>leaf</code></a>, then the event
itself is collected. If the matching event is a <a href="#TRY:TRIAL-EVENT%20CONDITION" title="TRY:TRIAL-EVENT CONDITION"><code>trial-event</code></a>, then
its <a href="#TRY:TRIAL%20%28MGL-PAX:READER%20TRY:TRIAL-EVENT%29" title="TRY:TRIAL (MGL-PAX:READER TRY:TRIAL-EVENT)"><code>trial</code></a> is collected. Furthermore, trials
which collected anything are always collected by their parent.</p>
<p>By default, both implicit and explicit calls to <code>try</code> collect the
<a href="#TRY:UNEXPECTED%20CONDITION" title="TRY:UNEXPECTED CONDITION"><code>unexpected</code></a> (see <a href="#TRY:*COLLECT*%20VARIABLE" title="TRY:*COLLECT* VARIABLE"><code>*collect*</code></a> and <a href="#TRY:*TRY-COLLECT*%20VARIABLE" title="TRY:*TRY-COLLECT* VARIABLE"><code>*try-collect*</code></a>), and consequently all
the enclosing trials.</p>
<p><a id="x-28TRY-3ACHILDREN-20-28MGL-PAX-3AREADER-20TRY-3ATRIAL-29-29"></a>
<a id="TRY:CHILDREN%20%28MGL-PAX:READER%20TRY:TRIAL%29"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/trial.lisp#L80">[reader]</a></span> <span class="reference-object"><a href="#TRY:CHILDREN%20%28MGL-PAX:READER%20TRY:TRIAL%29" >children</a></span></span> <span class="locative-args">trial (:children = nil)</span></span></p>

<p>A list of immediate child <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a>s, <a href="#TRY:RESULT%20CONDITION" title="TRY:RESULT CONDITION"><code>result</code></a>s, and
<a href="#TRY:ERROR*%20CONDITION" title="TRY:ERROR* CONDITION"><code>error*</code></a>s collected in reverse chronological order (see
<a href="#TRY:@TRY%2FCOLLECT%20MGL-PAX:SECTION" title="Collecting Events">Collecting Events</a>). The <code>verdict</code> of this <a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a> is not among <code>children</code>,
but the <code>verdict</code>s of child trials' are.</p></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FRERUN-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FRERUN%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FCOLLECT%20MGL-PAX:SECTION" title="Collecting Events">&#8592;</a> <a href="#TRY:@TRY%2FTESTS%20MGL-PAX:SECTION" title="Tests">&#8593;</a> <a href="#TRY:@TRY%2FREPLAY%20MGL-PAX:SECTION" title="Reprocessing Trials">&#8594;</a> <a href="#TRY:@TRY%2FRERUN%20MGL-PAX:SECTION" title="Rerunning Trials">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/rerun.lisp#L3">&#955;</a></span></span></p>
<h3><a href="#TRY:@TRY%2FRERUN%20MGL-PAX:SECTION">8.6 Rerunning Trials</a></h3>
<p>When a <a href="#TRY:TRIAL%20CLASS" title="TRY:TRIAL CLASS"><code>trial</code></a> is <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_funcal.htm" title="FUNCALL (MGL-PAX:CLHS FUNCTION)"><code>funcall</code></a>ed or passed to <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a>, the <em>test that
created the trial</em> is invoked, and it may be run again in its
entirety or in part. As the test runs, it may invoke other tests.
Any test (including the top-level one) is skipped if it does not
correspond to a <a href="#TRY:@TRY%2FCOLLECT%20MGL-PAX:SECTION" title="Collecting Events">collected</a> trial or its <a href="#TRY:TRIAL-START%20CONDITION" title="TRY:TRIAL-START CONDITION"><code>trial-start</code></a>
event and <a href="#TRY:VERDICT%20CONDITION" title="TRY:VERDICT CONDITION"><code>verdict</code></a> do not match the <code>rerun</code> argument of <code>try</code>. When that
happens, the corresponding function call immediately returns the
<code>trial</code> object.</p>
<ul>
<li><p>A new trial is skipped (as if with <a href="#TRY:SKIP-TRIAL%20FUNCTION" title="TRY:SKIP-TRIAL FUNCTION"><code>skip-trial</code></a>) if <code>rerun</code> is not <code>t</code>
  and</p>

<ul>
<li><p>there is no trial representing the same function call among
  the collected but not yet rerun trials in the trial being
  rerun, or</p></li>
<li><p>the first such trial does not match the <code>rerun</code> type argument of
  <code>try</code> in that neither its <code>trial-start</code>, <code>verdict</code> events match the
  type <code>rerun</code>, nor do any of its collected <a href="#TRY:RESULT%20CONDITION" title="TRY:RESULT CONDITION"><code>result</code></a>s and trials.</p></li>
</ul></li>
<li><p>The <em>test that created the trial</em> is determined as follows.</p>

<ul>
<li><p>If the trial was created by calling a <a href="#TRY:DEFTEST%20MGL-PAX:MACRO" title="TRY:DEFTEST MGL-PAX:MACRO"><code>deftest</code></a> function, then
  the test currently associated with that symbol naming the
  function is called with the arguments of the original function
  call. If the symbol is no longer <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_fbound.htm" title="FBOUNDP (MGL-PAX:CLHS FUNCTION)"><code>fboundp</code></a> (because it was
  <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_fmakun.htm" title="FMAKUNBOUND (MGL-PAX:CLHS FUNCTION)"><code>fmakunbound</code></a>) or it no longer names a <code>deftest</code> (it was redefined
  with <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_defun.htm" title="DEFUN (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>defun</code></a>), then an error is signalled.</p></li>
<li><p>If the trial was created by entering a <a href="#TRY:WITH-TEST%20MGL-PAX:MACRO" title="TRY:WITH-TEST MGL-PAX:MACRO"><code>with-test</code></a> form, then
  its body is executed again in the original lexical but the
  current dynamic environment. Implementationally speaking,
  <code>with-test</code> defines a local function of no arguments (likely a
  closure) that wraps its body, stores the closure in the trial
  object and calls it on a rerun in a <code>with-test</code> of the same
  <code>trial-var</code> and same <code>name</code>.</p></li>
<li><p>If the trial was created by <code>try</code> itself to ensure that all
  events are signalled in a trial (see <a href="#TRY:@TRY%2FEXPLICIT-TRY%20MGL-PAX:SECTION" title="Explicit `try`">Explicit <code>try</code></a>), then
  on a rerun the same <code>testable</code> is run again.</p></li>
</ul>

<p>All three possibilities involve entering <code>deftest</code> or <code>with-test</code>, or
invoking <code>try</code>: the same cases that we have when calling tests
functions (see <a href="#TRY:@TRY%2FIMPLICIT-TRY%20MGL-PAX:SECTION" title="Calling Test Functions">Calling Test Functions</a>). Thus, even if a trial is rerun
with <code>funcall</code>, execution is guaranteed to happen under <code>try</code>.</p></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FREPLAY-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FREPLAY%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FRERUN%20MGL-PAX:SECTION" title="Rerunning Trials">&#8592;</a> <a href="#TRY:@TRY%2FTESTS%20MGL-PAX:SECTION" title="Tests">&#8593;</a> <a href="#TRY:@TRY%2FIMPLEMENTATION-NOTES%20MGL-PAX:SECTION" title="Implementation Notes">&#8594;</a> <a href="#TRY:@TRY%2FREPLAY%20MGL-PAX:SECTION" title="Reprocessing Trials">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/replay.lisp#L5">&#955;</a></span></span></p>
<h3><a href="#TRY:@TRY%2FREPLAY%20MGL-PAX:SECTION">8.7 Reprocessing Trials</a></h3>
<p><a id="x-28TRY-3AREPLAY-EVENTS-20FUNCTION-29"></a>
<a id="TRY:REPLAY-EVENTS%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/replay.lisp#L8">[function]</a></span> <span class="reference-object"><a href="#TRY:REPLAY-EVENTS%20FUNCTION" >replay-events</a></span></span> <span class="locative-args">trial &amp;key (collect *try-collect*) (print *try-print*) (describe *try-describe*) (stream *try-stream*) (printer *try-printer*)</span></span></p>

<p><code>replay-events</code> reprocesses the events collected (see <a href="#TRY:@TRY%2FCOLLECT%20MGL-PAX:SECTION" title="Collecting Events">Collecting Events</a>)
in <code>trial</code>. It takes the same arguments as <a href="#TRY:TRY%20FUNCTION" title="TRY:TRY FUNCTION"><code>try</code></a> except
<code>debug</code>, <code>count</code> and <code>rerun</code>. This is because
<code>replay-events</code> does not run any tests. It simply signals the events
collected in <code>trial</code> again to allow further processing. The values of
<a href="#TRY:*CATEGORIES*%20VARIABLE" title="TRY:*CATEGORIES* VARIABLE"><code>*categories*</code></a> and <a href="#TRY:*COUNT*%20VARIABLE" title="TRY:*COUNT* VARIABLE"><code>*count*</code></a> that were in effect for <code>trial</code> are used, and
their current values are ignored to be able to keep consistent
counts (see <a href="#TRY:@TRY%2FCOUNT%20MGL-PAX:SECTION" title="Counting Events">Counting Events</a>).</p>

<p>Suppose we have run a large test using the default <code>:print 'leaf</code>
<code>:collect 'unexpected</code> arguments for <code>try</code>, and now we have too much
output to look at. Instead of searching for the interesting bits in
the output, we can replay the events and print only the <a href="#TRY:UNEXPECTED%20CONDITION" title="TRY:UNEXPECTED CONDITION"><code>unexpected</code></a>
events:</p>

<pre><code><span class="code"><span class="paren1">(<span class="code">replay-events ! <span class="keyword">:print</span> 'unexpected</span>)</span></span></code></pre>

<p>Or we could tell the printer to just print markers for <code>*categories*</code>
and <code>:describe</code> at the end:</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">let</span></i> <span class="paren2">(<span class="code"><span class="paren3">(<span class="code"><span class="special">*print-parent*</span> nil</span>)</span>
      <span class="paren3">(<span class="code"><span class="special">*print-compactly*</span> t</span>)</span>
      <span class="paren3">(<span class="code"><span class="special">*defer-describe*</span> t</span>)</span>
      <span class="paren3">(<span class="code"><span class="special">*categories*</span> <span class="paren4">(<span class="code">ascii-std-categories</span>)</span></span>)</span></span>)</span>
  <span class="paren2">(<span class="code">replay-events !</span>)</span></span>)</span>
.. ................F................!.....
.. 
.. <span class="comment">;; UNEXPECTED-FAILURE (F) in SOME-TEST INNER-TEST:
</span>.. <span class="paren1">(<span class="code">IS <span class="paren2">(<span class="code">= 5 6</span>)</span></span>)</span>
.. debug info
.. 
.. <span class="comment">;; UNHANDLED-ERROR (!) in SOME-TEST:
</span>.. "my-msg" <span class="paren1">(<span class="code">MY-ERR</span>)</span></span></code></pre></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FIMPLEMENTATION-NOTES-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FIMPLEMENTATION-NOTES%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FREPLAY%20MGL-PAX:SECTION" title="Reprocessing Trials">&#8592;</a> <a href="try-manual.html" title="Try Manual">&#8593;</a> <a href="#TRY:@TRY%2FGLOSSARY%20MGL-PAX:SECTION" title="Glossary">&#8594;</a> <a href="#TRY:@TRY%2FIMPLEMENTATION-NOTES%20MGL-PAX:SECTION" title="Implementation Notes">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/manual.lisp#L469">&#955;</a></span></span></p>
<h2><a href="#TRY:@TRY%2FIMPLEMENTATION-NOTES%20MGL-PAX:SECTION">9 Implementation Notes</a></h2>
<p>Try is supported on ABCL, AllegroCL, CLISP, CCL, CMUCL, ECL and
SBCL.</p>
<ul>
<li><p>Pretty printing is non-existent on CLISP and broken on ABCL. The
  output may look garbled on them.</p></li>
<li><p>Gray streams are broken on ABCL so the output may look even worse
  <a href="https://abcl.org/trac/ticket/373" >https://abcl.org/trac/ticket/373</a>.</p></li>
<li><p>ABCL, CMUCL, and ECL have a bug related to losing
  <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_eql.htm" title="EQL (MGL-PAX:CLHS FUNCTION)"><code>eql</code></a>ness of source literals
  <a href="https://gitlab.com/embeddable-common-lisp/ecl/-/issues/665" >https://gitlab.com/embeddable-common-lisp/ecl/-/issues/665</a>.
  The result is somewhat cosmetic, it may cause multiple captures
  being made for the same thing.</p></li>
</ul>
<p><a id="x-28TRY-3A-40TRY-2FGLOSSARY-20MGL-PAX-3ASECTION-29"></a>
<a id="TRY:@TRY%2FGLOSSARY%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#TRY:@TRY%2FIMPLEMENTATION-NOTES%20MGL-PAX:SECTION" title="Implementation Notes">&#8592;</a> <a href="try-manual.html" title="Try Manual">&#8593;</a> <a href="#TRY:@TRY%2FGLOSSARY%20MGL-PAX:SECTION" title="Glossary">&#8634;</a> <a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/manual.lisp#L487">&#955;</a></span></span></p>
<h2><a href="#TRY:@TRY%2FGLOSSARY%20MGL-PAX:SECTION">10 Glossary</a></h2>
<p><a id="x-28TRY-3A-40FUNCALLABLE-INSTANCE-20MGL-PAX-3AGLOSSARY-TERM-29"></a>
<a id="TRY:@FUNCALLABLE-INSTANCE%20MGL-PAX:GLOSSARY-TERM"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/manual.lisp#L491">[glossary-term]</a></span> <span class="reference-object"><a href="#TRY:@FUNCALLABLE-INSTANCE%20MGL-PAX:GLOSSARY-TERM" >funcallable instance</a></span></span></span></p>

<p>This is a term from the MOP. A funcallable instance is an instance
of a class that's a subclass of <code>mop:funcallable-standard-class</code>. It
is like a normal instance, but it can also be <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_funcal.htm" title="FUNCALL (MGL-PAX:CLHS FUNCTION)"><code>funcall</code></a>ed.</p></li>
</ul>
<p><a id="x-28TRY-3A-40CANCELLED-NLX-20MGL-PAX-3AGLOSSARY-TERM-29"></a>
<a id="TRY:@CANCELLED-NLX%20MGL-PAX:GLOSSARY-TERM"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/melisgl/try/blob/77ef735d25f1ff944e0ae4627ea10d954993ecb3/src/manual.lisp#L496">[glossary-term]</a></span> <span class="reference-object"><a href="#TRY:@CANCELLED-NLX%20MGL-PAX:GLOSSARY-TERM" >cancelled non-local exit</a></span></span></span></p>

<p>This is a term from the Common Lisp ANSI standard. If during the
unwinding of the stack initiated by a <a href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_n.htm#non-local_exit" title="&quot;non-local exit&quot; (MGL-PAX:CLHS MGL-PAX:GLOSSARY-TERM)">non-local exit</a> another
nlx is initiated in, and exits from an <a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_unwind.htm" title="UNWIND-PROTECT (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>unwind-protect</code></a> cleanup form,
then this second nlx is said to have cancelled the first, and the
first nlx will not continue.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">catch</span></i> 'foo
  <span class="paren2">(<span class="code"><i><span class="symbol">catch</span></i> 'bar
    <span class="paren3">(<span class="code"><i><span class="symbol">unwind-protect</span></i>
         <span class="paren4">(<span class="code"><i><span class="symbol">throw</span></i> 'foo 'foo</span>)</span>
      <span class="paren4">(<span class="code"><i><span class="symbol">throw</span></i> 'bar 'bar</span>)</span></span>)</span></span>)</span></span>)</span>
=&gt; BAR</span></code></pre></li>
</ul>
  </div>
</div>
<script>$('#page-toc').toc({'selectors': 'h1,h2,h3,h4'});</script>
</body>
</html>
